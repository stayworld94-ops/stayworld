<!doctype html>
<html lang="en">
<head>
  <!-- META -->
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>STAYWORLD ‚Äî Luxury Global Reach</title>

  <!-- Leaflet (ÏßÄÎèÑ) -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin="anonymous">
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin="anonymous"></script>

  <!-- Tailwind (Ï∂îÏ≤úÏàôÏÜå/Î∞∞ÎÑà Ïä§ÌÉÄÏùºÏóê ÏÇ¨Ïö©) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- ÌÜµÌï© CSS -->
  <style>
    :root{--bg:#0b0f16;--panel:#101018;--text:#e7e9ee;--muted:#cfd6e6;--line:rgba(255,255,255,.08);--chip:#121a26;--gold1:#f4d78c;--gold2:#c9a35b}
    *{box-sizing:border-box}html,body{margin:0;padding:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Inter,Roboto,sans-serif;line-height:1.5}
    a{color:inherit;text-decoration:none}.container{max-width:1120px;margin:0 auto;padding:0 16px}
    img{max-width:100%;display:block}

    /* Header */
    .site-header{position:sticky;top:0;z-index:1000;background:rgba(11,15,22,.85);backdrop-filter:blur(8px);border-bottom:1px solid var(--line)}
    .header-row{display:flex;align-items:center;justify-content:space-between;gap:20px;height:72px}
    .brand{display:flex;align-items:center;gap:10px}.brand-logo{width:36px;height:36px;border-radius:8px;box-shadow:0 4px 18px rgba(0,0,0,.3)}
    .brand-text{font-weight:800;letter-spacing:.6px}
    .main-nav{display:flex;gap:28px;justify-content:center;flex:1}
    .header-cta{display:flex;align-items:center;gap:12px}
    .lang-label{font-size:12px;opacity:.7}
    .lang-select{appearance:none;background:#101826;border:1px solid var(--line);color:var(--text);border-radius:12px;padding:8px 32px 8px 10px}
    .btn{border:0;padding:10px 14px;border-radius:12px;cursor:pointer}
    .btn-ghost{background:transparent;color:#cfcfcf}.btn-ghost:hover{background:rgba(255,255,255,.06)}
    .btn-gold{background:linear-gradient(180deg,var(--gold1),var(--gold2));color:#170f04;font-weight:700;border-radius:14px;padding:12px 18px;box-shadow:0 8px 26px rgba(201,163,91,.35)}
    .btn-chip{background:var(--chip);color:#dfe3ea;border:1px solid var(--line);border-radius:14px;padding:10px 14px}

    /* ---- Host dropdown ---- */
    .nav-item.dropdown{position:relative}
    .nav-link.dropdown-toggle{display:inline-flex;align-items:center;gap:6px;cursor:pointer;padding:6px 0;font-weight:600;opacity:.95}
    .dropdown-panel{
      position:absolute; top:100%; left:50%; transform:translate(-50%, 8px);
      min-width:220px; background:#0f1520; border:1px solid var(--line); border-radius:12px; padding:8px; z-index:30;
      box-shadow:0 16px 40px rgba(0,0,0,.45); visibility:hidden; opacity:0; pointer-events:none;
      transition:opacity .12s ease, transform .12s ease, visibility .12s;
    }
    .nav-item.dropdown:hover .dropdown-panel,
    .nav-item.dropdown:focus-within .dropdown-panel,
    .nav-item.dropdown.open .dropdown-panel{visibility:visible;opacity:1;pointer-events:auto;transform:translate(-50%,0)}
    .dropdown-item{display:block;padding:10px 12px;border-radius:8px;color:#e7e9ee;text-decoration:none;white-space:nowrap}
    .dropdown-item:hover{background:#121a26}
    .dropdown-divider{height:1px;background:var(--line);margin:6px 0}

    /* Hero */
    .hero{padding:48px 0 24px;background:radial-gradient(1200px 500px at 20% -10%,rgba(244,215,140,.12),transparent),radial-gradient(1200px 600px at 100% 0,rgba(78,94,130,.18),transparent)}
    .hero-title{font-size:48px;letter-spacing:.2px;margin:10px 0 8px}.accent{color:#f1cf84}
    .hero-sub{opacity:.85;margin:8px 0 28px}
    .search-bar{display:grid;grid-template-columns:1.2fr .7fr .7fr auto auto;gap:10px;align-items:center}
    .input{background:#0f1621;border:1px solid var(--line);color:var(--text);padding:12px 14px;border-radius:12px}
    .input::placeholder{color:#a7b0bf}
    .search-status{margin-top:8px;color:#cfd6e6;opacity:0;transition:opacity .3s}
    .btn.loading{opacity:.65;pointer-events:none}

    /* Ïπ¥Îìú */
    .features{display:grid;grid-template-columns:repeat(3,1fr);gap:14px;margin-top:28px}
    .card{background:#0f1420;border:1px solid var(--line);border-radius:16px;padding:18px;box-shadow:0 8px 30px rgba(0,0,0,.25)}
    .card h3{margin:0 0 6px}.card p{margin:0;opacity:.85}

    /* Map */
    .map-section{padding:36px 0 60px}
    #map{height:420px;border-radius:16px;border:1px solid var(--line);box-shadow:0 8px 30px rgba(0,0,0,.25);overflow:hidden}
    .leaflet-container,.leaflet-pane,.leaflet-top,.leaflet-bottom{z-index:10 !important}

    /* ÌïÑÌÑ∞ ÎìúÎ°úÏñ¥ (index Ï†ÑÏö©) */
    #filterDrawer{position:fixed;inset:0;display:none;z-index:2147483637;align-items:stretch;justify-content:flex-end}
    #filterDrawer[aria-hidden="false"]{display:flex}
    #filterDrawer .back{position:absolute;inset:0;background:rgba(0,0,0,.45)}
    #filterDrawer .panel{position:relative;margin-left:auto;width:min(780px,92vw);max-height:92vh;overflow:auto;background:var(--panel);border-left:1px solid var(--line);border-top-left-radius:16px;border-bottom-left-radius:16px;display:flex;flex-direction:column}
    #filterDrawer .head,#filterDrawer .foot{display:flex;align-items:center;justify-content:space-between;padding:12px 14px;border-bottom:1px solid var(--line)}
    #filterDrawer .foot{border-bottom:0;border-top:1px solid var(--line)}
    #filterGrid{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:14px;padding:14px}
    #filterDrawer .box{background:#0f1420;border:1px solid var(--line);border-radius:12px;padding:12px}
    #filterDrawer h4{margin:0 0 8px;font-size:14px}
    .sw-badge{position:absolute;top:-8px;right:-8px;background:#ffd36e;color:#1a1205;border-radius:999px;font-size:11px;padding:2px 6px}

    /* Ï±óÎ¥á */
    #chatFab{position:fixed;right:20px;bottom:20px;width:56px;height:56px;border-radius:50%;border:0;cursor:pointer;z-index:2147483639;background:linear-gradient(180deg,var(--gold1),var(--gold2));box-shadow:0 14px 30px rgba(201,163,91,.35);font-size:22px}
    #botPanel{position:fixed;right:20px;bottom:86px;width:min(360px,88vw);height:480px;background:#101018;border:1px solid #23232b;border-radius:16px;z-index:2147483638;display:none;box-shadow:0 20px 60px rgba(0,0,0,.5);color:var(--text)}
    #botPanel .hdr{display:flex;align-items:center;justify-content:space-between;padding:10px 12px;border-bottom:1px solid var(--line)}
    #botPanel .body{height:360px;overflow:auto;padding:10px;display:flex;flex-direction:column;gap:8px}
    #botPanel .row{display:flex;gap:8px;padding:10px;border-top:1px solid var(--line)}
    #botInput{flex:1;background:#0f1621;border:1px solid var(--line);color:var(--text);border-radius:12px;padding:10px 12px}
    #botSend{border:0;border-radius:12px;padding:10px 14px;background:linear-gradient(180deg,var(--gold1),var(--gold2));color:#1a1205;font-weight:700}
    .msg{max-width:80%;padding:10px 12px;border-radius:12px}.me{align-self:flex-end;background:#132132}.ai{align-self:flex-start;background:#121820}

    /* Footer */
    .site-footer{padding:28px 0;border-top:1px solid var(--line);opacity:.8}

    /* Responsive */
    @media (max-width:920px){.main-nav{display:none}.hero-title{font-size:40px}.search-bar{grid-template-columns:1fr 1fr 1fr auto}}
    @media (max-width:640px){.hero-title{font-size:34px}.features{grid-template-columns:1fr}}
  </style>
</head>

<body>
  <!-- HEADER -->
  <header class="site-header">
    <div class="container header-row">
      <a href="/" class="brand">
        <img src="/stayworld-logo.png" alt="StayWorld" class="brand-logo" />
        <span class="brand-text">STAYWORLD</span>
      </a>

      <nav class="main-nav" aria-label="Primary">
        <button class="btn btn-gold" id="btnMyPage">My Page</button>

        <!-- Host Î©îÎâ¥ -->
        <div class="nav-item dropdown" id="hostMenu">
          <button class="nav-link dropdown-toggle" data-i18n="nav_host">Host</button>
          <div class="dropdown-panel">
            <!-- ÎπÑÎ°úÍ∑∏Ïù∏ ÏÉÅÌÉú -->
            <a href="host-login.html"  class="dropdown-item" data-host-visible="signedOut" data-i18n="host_login">Host Login</a>
            <a href="host-register.html" class="dropdown-item" data-host-visible="signedOut" data-i18n="host_signup">Host Sign Up</a>
            <div class="dropdown-divider" data-host-visible="signedOut"></div>
            <!-- Î°úÍ∑∏Ïù∏ ÏÉÅÌÉú -->
            <a href="host-property-new.html" class="dropdown-item" data-host-visible="signedIn" data-i18n="host_register_property">Register Property</a>
            <a href="host-dashboard.html" class="dropdown-item" data-host-visible="signedIn" data-i18n="host_my_listings">My Listings</a>
            <button class="dropdown-item" data-host-visible="signedIn" id="hostLogoutBtn" type="button" data-i18n="host_logout">Logout</button>
          </div>
        </div>

        <!-- Î©§Î≤ÑÏã≠ Î©îÎâ¥(Ï∂îÍ∞Ä) -->
        <a href="membership.html" data-i18n="nav_membership">Membership</a>
        <a href="login.html" id="navAuthLink" data-i18n="nav_login">Login</a>
      </nav>

      <div class="header-cta">
        <label for="lang" class="lang-label" data-i18n="language">Language</label>
        <select id="lang" class="lang-select">
          <option value="EN" selected>EN</option>
          <option value="KO">KO</option>
          <option value="JA">JA</option>
          <option value="ZH">ZH</option>
          <option value="FR">FR</option>
          <option value="ES">ES</option>
          <option value="DE">DE</option>
          <option value="TR">TR</option>
          <option value="AR">AR</option>
          <option value="RU">RU</option>
        </select>
        <a href="signup.html" class="btn btn-gold" data-i18n="nav_signup">Sign Up</a>
        <div id="authArea"></div>
      </div>
    </div>
  </header>

  <!-- Hero ÏÑπÏÖò ÏúÑÎÇò ÏïÑÎûò ÏõêÌïòÎäî ÏúÑÏπò -->
  <div id="welcomeBanner" class="hidden banner bg-white/10 text-white p-4 rounded-xl mb-4">
    <span data-i18n="welcome_prefix">Welcome</span>, 
    <strong data-welcome-name></strong> üéâ
  </div>

  <!-- HERO -->
  <section class="hero">
    <div class="container">
      <h1 class="hero-title"><span data-i18n="hero_luxury">Luxury stays.</span><br><span class="accent" data-i18n="hero_reach">Global reach.</span></h1>
      <p class="hero-sub" data-i18n="hero_sub">Cards, bank transfer & crypto (BTC ¬∑ ETH ¬∑ USDT).</p>

      <div class="search-bar">
        <input class="input" id="searchDestination" type="text" placeholder="Paris, Tokyo, Istanbul‚Ä¶" data-i18n-placeholder="placeholder_city">
        <input class="input" id="checkIn" type="date">
        <input class="input" id="checkOut" type="date">
        <button class="btn btn-chip" id="btnFilters" type="button" data-i18n="filters">Filters</button>
        <button class="btn btn-gold" id="btnSearch" type="button" data-i18n="search">Search</button>
      </div>
      <div id="searchStatus" class="search-status"></div>

      <div class="features">
        <div class="card"><h3 data-i18n="feat_verified">Verified stays</h3><p data-i18n="feat_verified_sub">Top picks near you.</p></div>
        <div class="card"><h3 data-i18n="feat_rewards">StayWorld+ Rewards</h3><p data-i18n="feat_rewards_sub">Earn points on every booking.</p></div>
        <div class="card"><h3 data-i18n="feat_payments">Secure payments</h3><p data-i18n="feat_payments_sub">Visa, Mastercard, Amex & Crypto.</p></div>
      </div>
    </div>
  </section>

  <!-- MAP -->
  <section class="map-section">
    <div class="container">
      <div id="map" aria-label="Map" role="region"></div>
    </div>
  </section>

  <!-- === Featured Listings (ÏßÄÎèÑ ÏïÑÎûò) === -->
  <section id="featured" class="max-w-7xl mx-auto px-4 py-10">
    <div class="flex items-center justify-between mb-4">
      <h2 class="text-xl md:text-2xl font-bold" data-i18n="featured_title">‚ú® Ï∂îÏ≤ú ÏàôÏÜå</h2>
      <a href="/results.html" class="text-sm text-emerald-300 hover:underline" data-i18n="see_all">Î™®Îëê Î≥¥Í∏∞</a>
    </div>

    <!-- Î°úÎî© Ïä§ÏºàÎ†àÌÜ§ -->
    <div id="recosSkeleton" class="grid gap-4 sm:grid-cols-2 lg:grid-cols-3">
      <!-- 6Í∞ú Ïä§ÏºàÎ†àÌÜ§ Ïπ¥Îìú -->
      <div class="rounded-2xl overflow-hidden border border-white/10 bg-white/5">
        <div class="w-full h-40 bg-white/10 animate-pulse"></div>
        <div class="p-4 space-y-2">
          <div class="h-4 w-3/5 bg-white/10 animate-pulse rounded"></div>
          <div class="h-3 w-2/5 bg-white/10 animate-pulse rounded"></div>
          <div class="h-8 w-24 bg-white/10 animate-pulse rounded"></div>
        </div>
      </div>
      <div class="rounded-2xl overflow-hidden border border-white/10 bg-white/5">
        <div class="w-full h-40 bg-white/10 animate-pulse"></div>
        <div class="p-4 space-y-2">
          <div class="h-4 w-3/5 bg-white/10 animate-pulse rounded"></div>
          <div class="h-3 w-2/5 bg-white/10 animate-pulse rounded"></div>
          <div class="h-8 w-24 bg-white/10 animate-pulse rounded"></div>
        </div>
      </div>
      <div class="rounded-2xl overflow-hidden border border-white/10 bg-white/5">
        <div class="w-full h-40 bg-white/10 animate-pulse"></div>
        <div class="p-4 space-y-2">
          <div class="h-4 w-3/5 bg-white/10 animate-pulse rounded"></div>
          <div class="h-3 w-2/5 bg-white/10 animate-pulse rounded"></div>
          <div class="h-8 w-24 bg-white/10 animate-pulse rounded"></div>
        </div>
      </div>
      <div class="rounded-2xl overflow-hidden border border-white/10 bg-white/5">
        <div class="w-full h-40 bg-white/10 animate-pulse"></div>
        <div class="p-4 space-y-2">
          <div class="h-4 w-3/5 bg-white/10 animate-pulse rounded"></div>
          <div class="h-3 w-2/5 bg-white/10 animate-pulse rounded"></div>
          <div class="h-8 w-24 bg-white/10 animate-pulse rounded"></div>
        </div>
      </div>
      <div class="rounded-2xl overflow-hidden border border-white/10 bg-white/5">
        <div class="w-full h-40 bg-white/10 animate-pulse"></div>
        <div class="p-4 space-y-2">
          <div class="h-4 w-3/5 bg-white/10 animate-pulse rounded"></div>
          <div class="h-3 w-2/5 bg-white/10 animate-pulse rounded"></div>
          <div class="h-8 w-24 bg-white/10 animate-pulse rounded"></div>
        </div>
      </div>
      <div class="rounded-2xl overflow-hidden border border-white/10 bg-white/5">
        <div class="w-full h-40 bg-white/10 animate-pulse"></div>
        <div class="p-4 space-y-2">
          <div class="h-4 w-3/5 bg-white/10 animate-pulse rounded"></div>
          <div class="h-3 w-2/5 bg-white/10 animate-pulse rounded"></div>
          <div class="h-8 w-24 bg-white/10 animate-pulse rounded"></div>
        </div>
      </div>
    </div>

    <!-- Ïã§Ï†ú Ïπ¥ÎìúÍ∞Ä Îì§Ïñ¥Í∞à ÏûêÎ¶¨ -->
    <div id="recosGrid" class="grid gap-4 sm:grid-cols-2 lg:grid-cols-3 hidden"></div>
  </section>

  <!-- Í∞ÑÎã® ÌîÑÎ°úÎ™®ÏÖò Î∞∞ÎÑà (ÏÑ†ÌÉù) -->
  <section class="bg-gradient-to-r from-amber-400 to-yellow-300 text-black">
    <div class="max-w-7xl mx-auto px-4 py-8 text-center">
      <h3 class="text-2xl font-extrabold" data-i18n="promo_title">üéâ Ïã†Í∑ú ÌöåÏõê Ï≤´ ÏòàÏïΩ 10% Ìï†Ïù∏</h3>
      <p class="mt-1" data-i18n="promo_desc">Î©§Î≤ÑÏã≠ Í∞ÄÏûÖÌïòÎ©¥ Ìè¨Ïù∏Ìä∏ Ï†ÅÎ¶Ω + ÎèÖÏ†ê ÌòúÌÉù</p>
      <a href="/membership.html" class="inline-block mt-4 px-5 py-2 rounded-xl bg-black text-white" data-i18n="promo_cta">ÏßÄÍ∏à Í∞ÄÏûÖÌïòÍ∏∞</a>
    </div>
  </section>

  <!-- (Î∂ÑÎ¶¨Ìï¥Îëî) MY PAGE ÏÑπÏÖò: ÌïÑÏöî Ïãú indexÏóêÏÑú Î≥¥Ïùº ÎïåÎßå ÏÇ¨Ïö©ÌïòÍ≥†, Í∏∞Î≥∏ÏùÄ Ïà®ÍπÄ -->
  <section id="mypage" class="sw-section" style="display:none">
    <div class="container">
      <h2>My Page ¬∑ Favorites ‚≠ê</h2>
      <div class="mypage-panels">
        <div class="fav-list card">
          <h3>My Favorites</h3>
          <div id="favList"></div>
        </div>
        <div class="fav-map card">
          <div id="favMap"></div>
        </div>
      </div>
    </div>
  </section>

  <!-- FOOTER -->
  <footer class="site-footer">
    <div class="container"><small data-i18n="footer_copy">¬© StayWorld ‚Äî stayworldbooking.com</small></div>
  </footer>

  <!-- ================= I18N (10Í∞úÍµ≠Ïñ¥) ================= -->
  <script>
    const I18N = {
      EN:{nav_home:"Home",nav_membership:"Membership",nav_login:"Login",nav_logout:"Logout",nav_signup:"Sign Up",language:"Language",
        nav_host:"Host",host_login:"Host Login",host_signup:"Host Sign Up",host_register_property:"Register Property",host_my_listings:"My Listings",host_logout:"Logout",
        hero_luxury:"Luxury stays.",hero_reach:"Global reach.",hero_sub:"Cards, bank transfer & crypto (BTC ¬∑ ETH ¬∑ USDT).",
        placeholder_city:"Paris, Tokyo, Istanbul‚Ä¶",filters:"Filters",search:"Search",
        feat_verified:"Verified stays",feat_verified_sub:"Top picks near you.",
        feat_rewards:"StayWorld+ Rewards",feat_rewards_sub:"Earn points on every booking.",
        feat_payments:"Secure payments",feat_payments_sub:"Visa, Mastercard, Amex & Crypto.",
        footer_copy:"¬© StayWorld ‚Äî stayworldbooking.com",
        promo_title:"üéâ First booking 10% OFF",promo_desc:"Join membership to earn points + exclusive perks",promo_cta:"Join now",
        featured_title:"‚ú® Featured stays",see_all:"See all",
        w:{"Parking":"Parking"}
      },
      KO:{nav_home:"Ìôà",nav_membership:"Î©§Î≤ÑÏã≠",nav_login:"Î°úÍ∑∏Ïù∏",nav_logout:"Î°úÍ∑∏ÏïÑÏõÉ",nav_signup:"Í∞ÄÏûÖÌïòÍ∏∞",language:"Ïñ∏Ïñ¥",
        nav_host:"Ìò∏Ïä§Ìä∏",host_login:"Ìò∏Ïä§Ìä∏ Î°úÍ∑∏Ïù∏",host_signup:"Ìò∏Ïä§Ìä∏ Í∞ÄÏûÖ",host_register_property:"ÏàôÏÜå Îì±Î°ù",host_my_listings:"Ìò∏Ïä§Ìä∏ Îì±Î°ùÎ™©Î°ù",host_logout:"Î°úÍ∑∏ÏïÑÏõÉ",
        hero_luxury:"Îü≠ÏÖîÎ¶¨ Ïä§ÌÖåÏù¥.",hero_reach:"Í∏ÄÎ°úÎ≤å Î¶¨Ïπò.",hero_sub:"Ïπ¥Îìú, Í≥ÑÏ¢åÏù¥Ï≤¥ & ÌÅ¨Î¶ΩÌÜ† (BTC ¬∑ ETH ¬∑ USDT).",
        placeholder_city:"ÌååÎ¶¨, ÎèÑÏøÑ, Ïù¥Ïä§ÌÉÑÎ∂à‚Ä¶",filters:"ÌïÑÌÑ∞",search:"Í≤ÄÏÉâ",
        feat_verified:"Í≤ÄÏ¶ùÎêú Ïä§ÌÖåÏù¥",feat_verified_sub:"Í∞ÄÍπåÏö¥ Ï∂îÏ≤ú ÏàôÏÜå.",feat_rewards:"StayWorld+ Î¶¨ÏõåÎìú",feat_rewards_sub:"ÏòàÏïΩÎßàÎã§ Ìè¨Ïù∏Ìä∏ Ï†ÅÎ¶Ω.",
        feat_payments:"ÏïàÏ†ÑÌïú Í≤∞Ï†ú",feat_payments_sub:"VISA, ÎßàÏä§ÌÑ∞, ÏïÑÎ©ïÏä§ & ÌÅ¨Î¶ΩÌÜ†.",
        footer_copy:"¬© Ïä§ÌÖåÏù¥ÏõîÎìú ‚Äî stayworldbooking.com",
        promo_title:"üéâ Ïã†Í∑ú ÌöåÏõê Ï≤´ ÏòàÏïΩ 10% Ìï†Ïù∏",promo_desc:"Î©§Î≤ÑÏã≠ Í∞ÄÏûÖÌïòÎ©¥ Ìè¨Ïù∏Ìä∏ Ï†ÅÎ¶Ω + ÎèÖÏ†ê ÌòúÌÉù",promo_cta:"ÏßÄÍ∏à Í∞ÄÏûÖÌïòÍ∏∞",
        featured_title:"‚ú® Ï∂îÏ≤ú ÏàôÏÜå",see_all:"Î™®Îëê Î≥¥Í∏∞",
        w:{"Parking":"Ï£ºÏ∞®"}
      },
      JA:{nav_home:"„Éõ„Éº„É†",nav_membership:"„É°„É≥„Éê„Éº„Ç∑„ÉÉ„Éó",nav_login:"„É≠„Ç∞„Ç§„É≥",nav_logout:"„É≠„Ç∞„Ç¢„Ç¶„Éà",nav_signup:"ÁôªÈå≤",language:"Ë®ÄË™û",
        nav_host:"„Éõ„Çπ„Éà",host_login:"„Éõ„Çπ„Éà„É≠„Ç∞„Ç§„É≥",host_signup:"„Éõ„Çπ„ÉàÁôªÈå≤",host_register_property:"Áâ©‰ª∂„ÇíÁôªÈå≤",host_my_listings:"„Éû„Ç§„É™„Çπ„ÉÜ„Ç£„É≥„Ç∞",host_logout:"„É≠„Ç∞„Ç¢„Ç¶„Éà",
        hero_luxury:"Ë¥ÖÊ≤¢„Å™ÊªûÂú®„ÄÇ",hero_reach:"‰∏ñÁïå„Å∏Â∫É„Åå„Çã„ÄÇ",hero_sub:"„Ç´„Éº„Éâ„ÄÅÈäÄË°åÊåØËæº„ÄÅÊöóÂè∑Ë≥áÁî£ÔºàBTC„ÉªETH„ÉªUSDTÔºâ„ÄÇ",
        placeholder_city:"„Éë„É™„ÄÅÊù±‰∫¨„ÄÅ„Ç§„Çπ„Çø„É≥„Éñ„Éº„É´‚Ä¶",filters:"„Éï„Ç£„É´„Çø„Éº",search:"Ê§úÁ¥¢",
        feat_verified:"Ê§úË®ºÊ∏à„Åø„ÅÆÂÆø",feat_verified_sub:"Ëøë„Åè„ÅÆ„Åä„Åô„Åô„ÇÅ„ÄÇ",feat_rewards:"StayWorld+ „É™„ÉØ„Éº„Éâ",feat_rewards_sub:"‰∫àÁ¥ÑÊØé„Å´„Éù„Ç§„É≥„Éà„ÄÇ",
        feat_payments:"ÂÆâÂÖ®„Å™ÊîØÊâï„ÅÑ",feat_payments_sub:"VISA, Master, Amex & Crypto„ÄÇ",
        footer_copy:"¬© StayWorld ‚Äî stayworldbooking.com",
        promo_title:"üéâ ÂàùÂõû‰∫àÁ¥Ñ10%Ââ≤Âºï",promo_desc:"‰ºöÂì°ÁôªÈå≤„Åß„Éù„Ç§„É≥„Éà‰ªò‰∏éÔºãÈôêÂÆöÁâπÂÖ∏",promo_cta:"‰ªä„Åô„ÅêÁôªÈå≤",
        featured_title:"‚ú® Ê≥®ÁõÆ„ÅÆÂÆøÊ≥äÂÖà",see_all:"„Åô„Åπ„Å¶Ë°®Á§∫",
        w:{"Parking":"ÈßêËªäÂ†¥"}
      },
      ZH:{nav_home:"È¶ñÈ°µ",nav_membership:"‰ºöÂëò",nav_login:"ÁôªÂΩï",nav_logout:"ÈÄÄÂá∫ÁôªÂΩï",nav_signup:"Ê≥®ÂÜå",language:"ËØ≠Ë®Ä",
        nav_host:"Êàø‰∏ú",host_login:"Êàø‰∏úÁôªÂΩï",host_signup:"Êàø‰∏úÊ≥®ÂÜå",host_register_property:"ÁôªËÆ∞ÊàøÊ∫ê",host_my_listings:"ÊàëÁöÑÊàøÊ∫ê",host_logout:"ÈÄÄÂá∫ÁôªÂΩï",
        hero_luxury:"Â•¢Âçé‰ΩèÂÆø„ÄÇ",hero_reach:"ÂÖ®ÁêÉË¶ÜÁõñ„ÄÇ",hero_sub:"Èì∂Ë°åÂç°„ÄÅËΩ¨Ë¥¶‰∏éÂä†ÂØÜË¥ßÂ∏ÅÔºàBTC ¬∑ ETH ¬∑ USDTÔºâ„ÄÇ",
        placeholder_city:"Â∑¥Èªé„ÄÅ‰∏ú‰∫¨„ÄÅ‰ºäÊñØÂù¶Â∏ÉÂ∞î‚Ä¶",filters:"Á≠õÈÄâ",search:"ÊêúÁ¥¢",
        feat_verified:"Â∑≤È™åËØÅ‰ΩèÂÆø",feat_verified_sub:"ÈôÑËøëÁ≤æÈÄâ„ÄÇ",feat_rewards:"StayWorld+ Â•ñÂä±",feat_rewards_sub:"ÊØèÊ¨°È¢ÑËÆ¢ËµöÁßØÂàÜ„ÄÇ",
        feat_payments:"ÂÆâÂÖ®ÊîØ‰ªò",feat_payments_sub:"Visa„ÄÅMastercard„ÄÅAmex ‰∏éÂä†ÂØÜË¥ßÂ∏Å„ÄÇ",
        footer_copy:"¬© StayWorld ‚Äî stayworldbooking.com",
        promo_title:"üéâ Êñ∞‰ºöÂëòÈ¶ñÂçï9Êäò",promo_desc:"Âä†ÂÖ•‰ºöÂëòËµöÁßØÂàÜ + Áã¨ÂÆ∂Á§ºÈÅá",promo_cta:"Á´ãÂç≥Âä†ÂÖ•",
        featured_title:"‚ú® Êé®Ëçê‰ΩèÂÆø",see_all:"Êü•ÁúãÂÖ®ÈÉ®",
        w:{"Parking":"ÂÅúËΩ¶"}
      },
      FR:{nav_home:"Accueil",nav_membership:"Adh√©sion",nav_login:"Connexion",nav_logout:"D√©connexion",nav_signup:"S‚Äôinscrire",language:"Langue",
        nav_host:"H√¥te",host_login:"Connexion h√¥te",host_signup:"Inscription h√¥te",host_register_property:"Enregistrer un logement",host_my_listings:"Mes annonces",host_logout:"D√©connexion",
        hero_luxury:"S√©jours de luxe.",hero_reach:"Port√©e mondiale.",hero_sub:"Carte, virement & crypto (BTC ¬∑ ETH ¬∑ USDT).",
        placeholder_city:"Paris, Tokyo, Istanbul‚Ä¶",filters:"Filtres",search:"Rechercher",
        feat_verified:"Logements v√©rifi√©s",feat_verified_sub:"Meilleurs choix pr√®s de chez vous.",
        feat_rewards:"R√©compenses StayWorld+",feat_rewards_sub:"Des points √† chaque r√©servation.",
        feat_payments:"Paiements s√©curis√©s",feat_payments_sub:"Visa, Mastercard, Amex & Crypto.",
        footer_copy:"¬© StayWorld ‚Äî stayworldbooking.com",
        promo_title:"üéâ -10% sur la premi√®re r√©servation",promo_desc:"Adh√©rez pour points + avantages exclusifs",promo_cta:"Je m‚Äôinscris",
        featured_title:"‚ú® Logements recommand√©s",see_all:"Tout voir",
        w:{"Parking":"Parking"}
      },
      ES:{nav_home:"Inicio",nav_membership:"Membres√≠a",nav_login:"Ingresar",nav_logout:"Cerrar sesi√≥n",nav_signup:"Reg√≠strate",language:"Idioma",
        nav_host:"Anfitri√≥n",host_login:"Inicio de sesi√≥n de anfitri√≥n",host_signup:"Registro de anfitri√≥n",host_register_property:"Registrar propiedad",host_my_listings:"Mis anuncios",host_logout:"Cerrar sesi√≥n",
        hero_luxury:"Estancias de lujo.",hero_reach:"Alcance global.",hero_sub:"Tarjetas, transferencia bancaria y cripto (BTC ¬∑ ETH ¬∑ USDT).",
        placeholder_city:"Par√≠s, Tokio, Estambul‚Ä¶",filters:"Filtros",search:"Buscar",
        feat_verified:"Alojamientos verificados",feat_verified_sub:"Mejores opciones cerca de ti.",
        feat_rewards:"Recompensas StayWorld+",feat_rewards_sub:"Puntos en cada reserva.",
        feat_payments:"Pagos seguros",feat_payments_sub:"Visa, Mastercard, Amex y Cripto.",
        footer_copy:"¬© StayWorld ‚Äî stayworldbooking.com",
        promo_title:"üéâ 10% en tu primera reserva",promo_desc:"√önete para puntos + beneficios exclusivos",promo_cta:"√önete ahora",
        featured_title:"‚ú® Alojamientos destacados",see_all:"Ver todo",
        w:{"Parking":"Aparcamiento"}
      },
      DE:{nav_home:"Start",nav_membership:"Mitgliedschaft",nav_login:"Login",nav_logout:"Abmelden",nav_signup:"Registrieren",language:"Sprache",
        nav_host:"Gastgeber",host_login:"Gastgeber-Login",host_signup:"Gastgeber-Registrierung",host_register_property:"Unterkunft registrieren",host_my_listings:"Meine Inserate",host_logout:"Abmelden",
        hero_luxury:"Luxuri√∂se Aufenthalte.",hero_reach:"Globale Reichweite.",hero_sub:"Karten, √úberweisung & Krypto (BTC ¬∑ ETH ¬∑ USDT).",
        placeholder_city:"Paris, Tokio, Istanbul‚Ä¶",filters:"Filter",search:"Suchen",
        feat_verified:"Verifizierte Unterk√ºnfte",feat_verified_sub:"Top-Auswahl in deiner N√§he.",
        feat_rewards:"StayWorld+ Pr√§mien",feat_rewards_sub:"Punkte bei jeder Buchung.",
        feat_payments:"Sichere Zahlungen",feat_payments_sub:"Visa, Mastercard, Amex & Krypto.",
        footer_copy:"¬© StayWorld ‚Äî stayworldbooking.com",
        promo_title:"üéâ 10 % Rabatt auf die erste Buchung",promo_desc:"Mitglied werden: Punkte + exklusive Vorteile",promo_cta:"Jetzt beitreten",
        featured_title:"‚ú® Empfohlene Unterk√ºnfte",see_all:"Alle ansehen",
        w:{"Parking":"Parken"}
      },
      TR:{nav_home:"Ana Sayfa",nav_membership:"√úyelik",nav_login:"Giri≈ü",nav_logout:"√áƒ±kƒ±≈ü",nav_signup:"Kaydol",language:"Dil",
        nav_host:"Ev Sahibi",host_login:"Ev Sahibi Giri≈üi",host_signup:"Ev Sahibi Kaydƒ±",host_register_property:"ƒ∞lan Olu≈ütur",host_my_listings:"ƒ∞lanlarƒ±m",host_logout:"√áƒ±kƒ±≈ü",
        hero_luxury:"L√ºks konaklamalar.",hero_reach:"K√ºresel eri≈üim.",hero_sub:"Kart, havale ve kripto (BTC ¬∑ ETH ¬∑ USDT).",
        placeholder_city:"Paris, Tokyo, ƒ∞stanbul‚Ä¶",filters:"Filtreler",search:"Ara",
        feat_verified:"Doƒürulanmƒ±≈ü konaklamalar",feat_verified_sub:"Yakƒ±ndaki en iyi se√ßenekler.",
        feat_rewards:"StayWorld+ √ñd√ºlleri",feat_rewards_sub:"Her rezervasyonda puan kazanƒ±n.",
        feat_payments:"G√ºvenli √∂demeler",feat_payments_sub:"Visa, Mastercard, Amex & Kripto.",
        footer_copy:"¬© StayWorld ‚Äî stayworldbooking.com",
        promo_title:"üéâ ƒ∞lk rezervasyonda %10 indirim",promo_desc:"√úyelikle puan + √∂zel ayrƒ±calƒ±klar",promo_cta:"Hemen katƒ±l",
        featured_title:"‚ú® √ñnerilen konaklamalar",see_all:"T√ºm√ºn√º g√∂r",
        w:{"Parking":"Otopark"}
      },
      AR:{nav_home:"ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©",nav_membership:"ÿßŸÑÿπÿ∂ŸàŸäÿ©",nav_login:"ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ",nav_logout:"ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿÆÿ±Ÿàÿ¨",nav_signup:"ÿ•ŸÜÿ¥ÿßÿ° ÿ≠ÿ≥ÿßÿ®",language:"ÿßŸÑŸÑÿ∫ÿ©",
        nav_host:"ÿßŸÑŸÖÿ∂ŸäŸÅ",host_login:"ÿ™ÿ≥ÿ¨ŸäŸÑ ÿØÿÆŸàŸÑ ÿßŸÑŸÖÿ∂ŸäŸÅ",host_signup:"ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑŸÖÿ∂ŸäŸÅ",host_register_property:"ÿ™ÿ≥ÿ¨ŸäŸÑ ÿπŸÇÿßÿ±",host_my_listings:"ŸÇŸàÿßÿ¶ŸÖŸä",host_logout:"ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿÆÿ±Ÿàÿ¨",
        hero_luxury:"ÿ•ŸÇÿßŸÖÿßÿ™ ŸÅÿßÿÆÿ±ÿ©.",hero_reach:"ÿßŸÜÿ™ÿ¥ÿßÿ± ÿπÿßŸÑŸÖŸä.",hero_sub:"ÿ®ÿ∑ÿßŸÇÿßÿ™ÿå ÿ™ÿ≠ŸàŸäŸÑ ÿ®ŸÜŸÉŸä ŸàÿπŸÖŸÑÿßÿ™ ŸÖÿ¥ŸÅÿ±ÿ© (BTC ¬∑ ETH ¬∑ USDT).",
        placeholder_city:"ÿ®ÿßÿ±Ÿäÿ≥ÿå ÿ∑ŸàŸÉŸäŸàÿå ÿ•ÿ≥ÿ∑ŸÜÿ®ŸàŸÑ‚Ä¶",filters:"ÿßŸÑŸÅŸÑÿßÿ™ÿ±",search:"ÿ®ÿ≠ÿ´",
        feat_verified:"ÿ•ŸÇÿßŸÖÿßÿ™ ŸÖŸàÿ´ŸàŸÇÿ©",feat_verified_sub:"ÿ£ŸÅÿ∂ŸÑ ÿßŸÑÿÆŸäÿßÿ±ÿßÿ™ ÿ®ÿßŸÑŸÇÿ±ÿ® ŸÖŸÜŸÉ.",
        feat_rewards:"ŸÖŸÉÿßŸÅÿ¢ÿ™ StayWorld+",feat_rewards_sub:"ŸÜŸÇÿßÿ∑ ŸÖÿπ ŸÉŸÑ ÿ≠ÿ¨ÿ≤.",
        feat_payments:"ŸÖÿØŸÅŸàÿπÿßÿ™ ÿ¢ŸÖŸÜÿ©",feat_payments_sub:"Visa ŸàMastercard ŸàAmex ŸàÿßŸÑÿπŸÖŸÑÿßÿ™ ÿßŸÑŸÖÿ¥ŸÅÿ±ÿ©.",
        footer_copy:"¬© ÿ≥ÿ™ÿßŸä Ÿàÿ±ŸÑÿØ ‚Äî stayworldbooking.com",
        promo_title:"üéâ ÿÆÿµŸÖ 10% ÿπŸÑŸâ ÿ£ŸàŸÑ ÿ≠ÿ¨ÿ≤",promo_desc:"ÿßŸÜÿ∂ŸÖ ŸÑŸÉÿ≥ÿ® ŸÜŸÇÿßÿ∑ + ŸÖÿ≤ÿßŸäÿß ÿ≠ÿµÿ±Ÿäÿ©",promo_cta:"ÿßŸÜÿ∂ŸÖ ÿßŸÑÿ¢ŸÜ",
        featured_title:"‚ú® ÿßŸÑÿ•ŸÇÿßŸÖÿßÿ™ ÿßŸÑŸÖŸàÿµŸâ ÿ®Ÿáÿß",see_all:"ÿπÿ±ÿ∂ ÿßŸÑŸÉŸÑ",
        w:{"Parking":"ŸÖŸàŸÇŸÅ ÿ≥Ÿäÿßÿ±ÿßÿ™"}
      },
      RU:{nav_home:"–ì–ª–∞–≤–Ω–∞—è",nav_membership:"–ü–æ–¥–ø–∏—Å–∫–∞",nav_login:"–í–æ–π—Ç–∏",nav_logout:"–í—ã–π—Ç–∏",nav_signup:"–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è",language:"–Ø–∑—ã–∫",
        nav_host:"–•–æ—Å—Ç",host_login:"–í—Ö–æ–¥ —Ö–æ—Å—Ç–∞",host_signup:"–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Ö–æ—Å—Ç–∞",host_register_property:"–î–æ–±–∞–≤–∏—Ç—å –æ–±—ä–µ–∫—Ç",host_my_listings:"–ú–æ–∏ –æ–±—ä—è–≤–ª–µ–Ω–∏—è",host_logout:"–í—ã–π—Ç–∏",
        hero_luxury:"–†–æ—Å–∫–æ—à–Ω–æ–µ –ø—Ä–æ–∂–∏–≤–∞–Ω–∏–µ.",hero_reach:"–ì–ª–æ–±–∞–ª—å–Ω—ã–π –æ—Ö–≤–∞—Ç.",hero_sub:"–ö–∞—Ä—Ç—ã, –ø–µ—Ä–µ–≤–æ–¥ –∏ –∫—Ä–∏–ø—Ç–æ (BTC ¬∑ ETH ¬∑ USDT).",
        placeholder_city:"–ü–∞—Ä–∏–∂, –¢–æ–∫–∏–æ, –°—Ç–∞–º–±—É–ª‚Ä¶",filters:"–§–∏–ª—å—Ç—Ä—ã",search:"–ü–æ–∏—Å–∫",
        feat_verified:"–ü—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã",feat_verified_sub:"–õ—É—á—à–∏–µ –º–µ—Å—Ç–∞ —Ä—è–¥–æ–º —Å –≤–∞–º–∏.",
        feat_rewards:"–ë–æ–Ω—É—Å—ã StayWorld+",feat_rewards_sub:"–ë–∞–ª–ª—ã –∑–∞ –∫–∞–∂–¥–æ–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ.",
        feat_payments:"–ë–µ–∑–æ–ø–∞—Å–Ω—ã–µ –ø–ª–∞—Ç–µ–∂–∏",feat_payments_sub:"Visa, Mastercard, Amex –∏ –∫—Ä–∏–ø—Ç–æ.",
        footer_copy:"¬© StayWorld ‚Äî stayworldbooking.com",
        promo_title:"üéâ –°–∫–∏–¥–∫–∞ 10% –Ω–∞ –ø–µ—Ä–≤–æ–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ",promo_desc:"–í—Å—Ç—É–ø–∏—Ç–µ –≤ –ø–æ–¥–ø–∏—Å–∫—É: –±–∞–ª–ª—ã + —ç–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã–µ –ø—Ä–∏–≤–∏–ª–µ–≥–∏–∏",promo_cta:"–ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è",
        featured_title:"‚ú® –†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã",see_all:"–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ",
        w:{"Parking":"–ü–∞—Ä–∫–æ–≤–∫–∞"}
      }
    };

    function applyI18NPage(){
      const sel = document.getElementById('lang');
      const lang = (sel?.value || localStorage.getItem('sw_lang') || 'EN');
      const dict = I18N[lang] || I18N.EN;
      document.querySelectorAll('[data-i18n]').forEach(el=>{
        const k = el.getAttribute('data-i18n'); if(dict[k]) el.textContent = dict[k];
      });
      document.querySelectorAll('[data-i18n-placeholder]').forEach(el=>{
        const k = el.getAttribute('data-i18n-placeholder'); if(dict[k]) el.setAttribute('placeholder', dict[k]);
      });
    }

    document.addEventListener('DOMContentLoaded', ()=>{
      const sel=document.getElementById('lang');
      const saved=localStorage.getItem('sw_lang');
      if(sel && saved && [...sel.options].some(o=>o.value===saved)) sel.value=saved;
      applyI18NPage();
      sel?.addEventListener('change', e=>{ localStorage.setItem('sw_lang', e.target.value); applyI18NPage(); });
    });
  </script>

  <!-- ===== ÌÜµÌôî/Í∞ÄÍ≤© & ÌïÑÌÑ∞ ÎìúÎ°úÏñ¥ ===== -->
  <script>
    const CURRENCIES = {
      USD:{symbol:'$',rate:1,locale:'en-US',name:'USD'},
      EUR:{symbol:'‚Ç¨',rate:0.92,locale:'fr-FR',name:'EUR'},
      KRW:{symbol:'‚Ç©',rate:1300,locale:'ko-KR',name:'KRW'},
      JPY:{symbol:'¬•',rate:155,locale:'ja-JP',name:'JPY'},
      CNY:{symbol:'¬•',rate:7.2,locale:'zh-CN',name:'CNY'},
      TRY:{symbol:'‚Ç∫',rate:33,locale:'tr-TR',name:'TRY'},
      RUB:{symbol:'‚ÇΩ',rate:90,locale:'ru-RU',name:'RUB'},
      GBP:{symbol:'¬£',rate:0.78,locale:'en-GB',name:'GBP'},
      AED:{symbol:'ÿØ.ÿ•',rate:3.67,locale:'ar-AE',name:'AED'},
      CAD:{symbol:'$',rate:1.36,locale:'en-CA',name:'CAD'}
    };
    const LANG_TO_CUR = { EN:'USD', KO:'KRW', JA:'JPY', ZH:'CNY', FR:'EUR', ES:'EUR', DE:'EUR', TR:'TRY', AR:'AED', RU:'RUB' };
    function setCurrencyByLang(lang){
      const curSel=document.getElementById('currencySelect');
      if(!curSel) return;
      const code = LANG_TO_CUR[lang] || 'USD';
      curSel.value = code; updatePriceLabels();
    }
    function fmtMoney(usd){
      const curSel=document.getElementById('currencySelect'); if(!curSel) return '$'+usd.toFixed(0);
      const cur=CURRENCIES[curSel.value]||CURRENCIES.USD;
      const val=usd*cur.rate;
      return new Intl.NumberFormat(cur.locale,{style:'currency',currency:cur.name,maximumFractionDigits:0}).format(val);
    }

    const mutedOverlays=new Set();
    function muteFullscreenOverlays(){
      document.querySelectorAll('body *').forEach(el=>{
        try{
          const cs=getComputedStyle(el); if(cs.position!=='fixed')return;
          const r=el.getBoundingClientRect();
          if(r.width>=innerWidth*0.96 && r.height>=innerHeight*0.96){
            if(el.id==='filterDrawer'||el.id==='botPanel') return;
            if(!mutedOverlays.has(el)){ el.dataset.swPe=cs.pointerEvents; el.style.pointerEvents='none'; mutedOverlays.add(el); }
          }
        }catch(_){}
      });
    }
    function restoreOverlays(){ mutedOverlays.forEach(el=>{ if(el.dataset.swPe!=null){el.style.pointerEvents=el.dataset.swPe; delete el.dataset.swPe;} }); mutedOverlays.clear(); }

    const GROUPS=[
      {t:'f_price', kind:'price'},
      {t:'f_staytype', checks:['Hotel','Motel','Hostel','Apartment','Villa','Ryokan','Guesthouse','B&B']},
      {t:'f_review', radios:['4.5+','4.0+','Any']},
      {t:'f_beds', inputs:[['number','beds',{min:1,value:1}],['number','baths',{min:1,value:1}]]},
      {t:'f_pets', checks:['Allowed']},
      {t:'f_checkin', checks:['Self check-in']},
      {t:'f_amen', checks:['Wi-Fi','Kitchen','Parking','Pool','Air conditioning','Gym','Workspace','Washer','Dryer','Breakfast']},
      {t:'f_booking', checks:['Instant book','Request to book']},
      {t:'f_verify', checks:['Verified listings only','Verified reviews']},
      {t:'f_long', checks:['Show long-stay deals']},
      {t:'f_biz', checks:['B2B-ready','Invoice available']},
      {t:'f_loc', checks:['Near airport','Near station','Near beach','City center']},
      {t:'f_access', checks:['Step-free access','Elevator','Wide doorway','Accessible bathroom']},
      {t:'f_ex', checks:['Nature','Camping','Traditional','Ski-in/out','Wine country']},
      {t:'f_view', checks:['Sea view','City view','Mountain view','Garden']},
      {t:'f_safe', checks:['Carbon monoxide alarm','Smoke alarm','First aid kit']},
      {t:'f_family', checks:['Crib','High chair','Stroller friendly']},
      {t:'f_ent', checks:['TV','Netflix','Game console']},
      {t:'f_out', checks:['BBQ grill','Patio','Private garden']},
      {t:'f_park', checks:['On-site','Street','Paid garage']},
    ];
    function ensureDrawer(){
      let d=document.getElementById('filterDrawer');
      if(!d){
        d=document.createElement('div'); d.id='filterDrawer'; d.setAttribute('aria-hidden','true');
        d.innerHTML=`
          <div class="back"></div>
          <div class="panel">
            <div class="head">
              <strong id="fTitle">Filters</strong>
              <div style="display:flex;gap:8px;align-items:center">
                <label for="currencySelect" id="curLabel" style="font-size:12px;opacity:.8">Currency</label>
                <select id="currencySelect" class="lang-select" style="padding:6px 10px">
                  ${Object.keys(CURRENCIES).map(k=>`<option value="${k}">${k}</option>`).join('')}
                </select>
                <button id="swClose" class="btn btn-ghost">‚úï</button>
              </div>
            </div>
            <div id="filterGrid"></div>
            <div class="foot">
              <button id="swReset" class="btn btn-ghost" style="border:1px solid rgba(255,255,255,.14)">Reset</button>
              <button id="swApply" class="btn btn-gold">Apply</button>
            </div>
          </div>`;
        document.body.appendChild(d);

        const grid=d.querySelector('#filterGrid');
        GROUPS.forEach((g,gi)=>{
          const box=document.createElement('div'); box.className='box';
          box.innerHTML=`<h4 data-title="${g.t}">${g.t}</h4>`;
          if(g.kind==='price'){
            const html=`
              <div style="display:grid;gap:10px">
                <div style="display:flex;justify-content:space-between;font-size:13px">
                  <span>Price per night</span>
                  <span><span id="priceMinVal">‚Äì</span> ~ <span id="priceMaxVal">‚Äì</span></span>
                </div>
                <label style="font-size:12px;opacity:.8">Min</label>
                <input type="range" id="priceMin" min="0" max="1000" step="10" value="100">
                <label style="font-size:12px;opacity:.8">Max</label>
                <input type="range" id="priceMax" min="0" max="5000" step="50" value="800">
              </div>`;
            const wrap=document.createElement('div'); wrap.innerHTML=html; box.appendChild(wrap);
          }
          (g.inputs||[]).forEach(([type,id,attrs])=>{
            const wrap=document.createElement('div'); wrap.style.margin='6px 0';
            wrap.innerHTML=`<label style="font-size:12px">${id}</label><input type="${type}" id="${id}" style="width:100%">`;
            Object.entries(attrs||{}).forEach(([k,v])=>wrap.querySelector('input').setAttribute(k,v));
            box.appendChild(wrap);
          });
          (g.radios||[]).forEach((name,ri)=>{
            const id=`rg_${gi}_${ri}`;
            const lab=document.createElement('label'); lab.style.cssText='display:inline-flex;align-items:center;gap:6px;margin:6px 10px 0 0';
            lab.innerHTML=`<input type="radio" name="rg_${gi}" id="${id}" ${/Any/i.test(name)?'checked':''}> <span data-word="${name}">${name}</span>`;
            box.appendChild(lab);
          });
          (g.checks||[]).forEach((name,ci)=>{
            const id=`ck_${gi}_${ci}`;
            const lab=document.createElement('label'); lab.style.cssText='display:inline-flex;align-items:center;gap:6px;margin:6px 10px 0 0';
            lab.innerHTML=`<input type="checkbox" id="${id}"> <span data-word="${name}">${name}</span>`;
            box.appendChild(lab);
          });
          grid.appendChild(box);
        });

        const back=d.querySelector('.back');
        const close=()=>{d.setAttribute('aria-hidden','true'); restoreOverlays();};
        back.addEventListener('click',close);
        d.querySelector('#swClose').addEventListener('click',close);
        d.querySelector('.panel').addEventListener('click',e=>e.stopPropagation());

        d.querySelector('#swReset').addEventListener('click',()=>{
          d.querySelectorAll('input[type=checkbox]').forEach(i=>i.checked=false);
          d.querySelectorAll('input[type=radio]').forEach(i=>i.checked=/Any/i.test(i.nextSibling?.textContent||'Any'));
          document.getElementById('priceMin').value=100;
          document.getElementById('priceMax').value=800;
          updatePriceLabels();
          setBadge('');
        });
        d.querySelector('#swApply').addEventListener('click',()=>{
          const n=d.querySelectorAll('input[type=checkbox]:checked, input[type=radio]:checked').length;
          setBadge(n?n.toString():''); close();
        });
        document.getElementById('currencySelect').addEventListener('change', updatePriceLabels);
        ['priceMin','priceMax'].forEach(id=>{
          d.querySelector('#'+id).addEventListener('input',()=>{
            const min=+d.querySelector('#priceMin').value;
            const max=+d.querySelector('#priceMax').value;
            if(min>max){ d.querySelector('#priceMin').value=max; }
            updatePriceLabels();
          });
        });

        setCurrencyByLang(document.getElementById('lang')?.value || 'EN');
        updatePriceLabels();
        localizeDrawer();
      }
      return d;
    }
    function updatePriceLabels(){
      const d=document.getElementById('filterDrawer'); if(!d) return;
      const min=+d.querySelector('#priceMin').value||0;
      const max=+d.querySelector('#priceMax').value||0;
      const minEl=d.querySelector('#priceMinVal'); const maxEl=d.querySelector('#priceMaxVal');
      if(minEl) minEl.textContent = fmtMoney(min);
      if(maxEl) maxEl.textContent = fmtMoney(max);
    }
    function localizeDrawer(){
      const d=document.getElementById('filterDrawer'); if(!d) return;
      const sel=document.getElementById('lang');
      const lang=(sel?.value||localStorage.getItem('sw_lang')||'EN');
      const dict=I18N[lang]||I18N.EN;
      const t=(k)=>dict[k]||I18N.EN[k]||k;
      d.querySelector('#fTitle').textContent=t('f_title')||'Filters';
      d.querySelector('#curLabel').textContent=t('f_currency')||'Currency';
      d.querySelector('#swReset').textContent=t('f_reset')||'Reset';
      d.querySelector('#swApply').textContent=t('f_apply')||'Apply';
    }
    function setBadge(n){ /* ÏÑ†ÌÉù Î∞∞ÏßÄ Í∞ØÏàò ÌëúÏãúÎäî ÌïÑÏöî Ïãú Íµ¨ÌòÑ */ }

    // Ïù∏Îç±Ïä§ÏóêÏÑúÎäî ÌïÑÌÑ∞ Î≤ÑÌäº ÌÅ¥Î¶≠ Ïãú hotels.htmlÎ°ú Ïù¥Îèô
    document.getElementById('btnFilters')?.addEventListener('click',(e)=>{
      e.preventDefault();
      location.href = '/hotels.html#filters';
    },{capture:true});
  </script>

  <!-- ===== Ï±óÎ¥á ===== -->
  <script>
    function ensureChat(){
      let fab=document.getElementById('chatFab');
      if(!fab){ fab=document.createElement('button'); fab.id='chatFab'; fab.textContent='üí¨'; document.body.appendChild(fab); }
      let panel=document.getElementById('botPanel');
      if(!panel){
        panel=document.createElement('div'); panel.id='botPanel';
        panel.innerHTML=`<div class="hdr"><strong>AI Concierge</strong><button id="botClose" class="btn btn-ghost">‚úï</button></div>
          <div id="botBody" class="body"><div class="msg ai">Hello! Ask in any language.</div></div>
          <div class="row"><input id="botInput" placeholder="Type a message‚Ä¶"><button id="botSend">Send</button></div>`;
        document.body.appendChild(panel);
      }
      const open=()=>{panel.style.display='block'; muteFullscreenOverlays?.();};
      const close=()=>{panel.style.display='none'; restoreOverlays?.();};
      fab.addEventListener('click',e=>{e.stopPropagation(); open();},{capture:true});
      panel.querySelector('#botClose').addEventListener('click',e=>{e.stopPropagation(); close();});
      document.addEventListener('click',e=>{
        if(panel.style.display!=='block')return;
        const r=panel.getBoundingClientRect(); const inside=e.clientX>=r.left&&e.clientX<=r.right&&e.clientY>=r.top&&e.clientY<=r.bottom;
        if(!inside) close();
      },{capture:true});

      const body=panel.querySelector('#botBody'), input=panel.querySelector('#botInput'), send=panel.querySelector('#botSend');
      const msgs=[];
      const add=(t,me)=>{const d=document.createElement('div'); d.className=`msg ${me?'me':'ai'}`; d.textContent=t; body.appendChild(d); body.scrollTop=body.scrollHeight;};
      async function askAI(message,lang){
        for(const ep of ['/api/chat','/.netlify/functions/sw-chat']){
          try{
            const r=await fetch(ep,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({messages:[...msgs,{role:'user',content:message}],lang})});
            if(r.ok){const d=await r.json(); if(d.reply) return d.reply;}
          }catch(_){}
        }
        return '(Backend not found. Check your function URL.)';
      }
      async function sendIt(){
        const v=(input.value||'').trim(); if(!v) return; input.value='';
        add(v,true); msgs.push({role:'user',content:v}); add('‚Ä¶',false); const dots=body.lastChild;
        try{ const reply=await askAI(v,(document.getElementById('lang')?.value||'EN').toLowerCase()); dots.remove(); add(reply,false); msgs.push({role:'assistant',content:reply}); }
        catch(_){ dots.remove(); add('Assistant is unavailable.',false); }
      }
      send.addEventListener('click',sendIt); input.addEventListener('keydown',e=>{if(e.key==='Enter') sendIt();});
    }
    ensureChat();
  </script>

  <!-- ===== ÏßÄÎèÑ Ï¥àÍ∏∞Ìôî + Í≤ÄÏÉâ ===== -->
  <script>
    let map, marker;
    function initMap(){
      map=L.map('map',{scrollWheelZoom:true}).setView([48.8566,2.3522],12); // Paris
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{attribution:'&copy; OpenStreetMap'}).addTo(map);
    }
    initMap();

    const statusEl=document.getElementById('searchStatus');
    function setStatus(msg){ statusEl.textContent=msg||''; statusEl.style.opacity=msg?1:0; if(msg){clearTimeout(statusEl._t); statusEl._t=setTimeout(()=>statusEl.style.opacity=0,3000);} }
    function setLoading(on){ const b=document.getElementById('btnSearch'); const lang=document.getElementById('lang')?.value||'EN'; const w=(I18N[lang]||I18N.EN).search||'Search'; b.disabled=on; b.classList.toggle('loading',on); b.textContent=on?'‚Ä¶':w;}

    async function geocodeAny(q){
      const prov=[q=>`https://nominatim.openstreetmap.org/search?format=json&limit=1&q=${encodeURIComponent(q)}`,q=>`https://photon.komoot.io/api/?limit=1&q=${encodeURIComponent(q)}`];
      for(const make of prov){
        try{
          const r=await fetch(make(q),{headers:{'Accept':'application/json'}}); if(!r.ok) continue; const data=await r.json();
          if(Array.isArray(data)&&data[0]) return {lat:+data[0].lat,lon:+data[0].lon,label:data[0].display_name||q};
          if(data?.features?.[0]){const f=data.features[0];return {lat:f.geometry.coordinates[1],lon:f.geometry.coordinates[0],label:f.properties.name||f.properties.city||f.properties.country||q};}
        }catch(_){}
      }
      throw new Error('no_results');
    }
    function goTo(lat,lon,label){ if(marker) marker.remove(); marker=L.marker([lat,lon]).addTo(map).bindPopup(label||'').openPopup(); map.setView([lat,lon],13,{animate:true}); document.getElementById('map').scrollIntoView({behavior:'smooth',block:'start'}); }

    async function runSearch(){
      const q=(document.getElementById('searchDestination').value||'').trim(); if(!q){document.getElementById('searchDestination').focus(); return;}
      try{ setLoading(true); setStatus('Searching‚Ä¶'); const {lat,lon,label}=await geocodeAny(q); goTo(lat,lon,label); setStatus(`Found: ${label}`);}
      catch(_){ setStatus('No results. Try another place.'); alert('Í≤ÄÏÉâ Í≤∞Í≥ºÍ∞Ä ÏóÜÏäµÎãàÎã§. Îã§Î•∏ ÎèÑÏãúÎ•º ÏûÖÎ†•Ìï¥Î≥¥ÏÑ∏Ïöî.'); }
      finally{ setLoading(false); }
    }
    document.getElementById('btnSearch').addEventListener('click',runSearch,{capture:true});
    ['searchDestination','checkIn','checkOut'].forEach(id=>{const el=document.getElementById(id); el&&el.addEventListener('keydown',e=>{if(e.key==='Enter') runSearch();});});
  </script>

  <!-- ===== Notifications (ÌÜ†Í∏Ä/Î∞∞ÏßÄ/Î†åÎçî/API) ===== -->
  <script>
    (function () {
      // Ïõ∞Ïª¥ Î∞î & ÏïåÎ¶º UI (ÌïÑÏöî Ïãú ÏÉÅÎã®Ïóê HTML Ï∂îÍ∞Ä Í∞ÄÎä•)
      // Ïõ∞Ïª¥/ÏïåÎ¶º Î≤ÑÌäº DOMÏùÄ ÌîÑÎ°úÏ†ùÌä∏Ïóê Îî∞Îùº Ï°¥Ïû¨ÌïòÏßÄ ÏïäÏùÑ Ïàò ÏûàÏúºÎãà ÏòàÏô∏ Ï≤òÎ¶¨
      const btn        = document.getElementById('notifBtn');
      const panel      = document.getElementById('notifPanel');
      const badge      = document.getElementById('notifBadge');
      const list       = document.getElementById('notifList');
      const markAllBtn = document.getElementById('markAllReadBtn');
      let state = [];

      if (!btn || !panel) return;

      btn.addEventListener('click', (e) => {
        e.stopPropagation();
        const hidden = panel.hasAttribute('hidden');
        document.querySelectorAll('.notif-panel').forEach(p => p.setAttribute('hidden',''));
        if (hidden) panel.removeAttribute('hidden');
        else panel.setAttribute('hidden','');
      });

      document.addEventListener('click', (e) => {
        if (!panel.contains(e.target) && e.target !== btn) {
          panel.setAttribute('hidden','');
        }
      });
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') panel.setAttribute('hidden','');
      });

      function escapeHtml(s) {
        return String(s)
          .replace(/&/g,'&amp;')
          .replace(/</g,'&lt;')
          .replace(/>/g,'&gt;')
          .replace(/"/g,'&quot;')
          .replace(/'/g,'&#39;');
      }

      function render(items) {
        const unread = items.filter(x => !x.read).length;
        if (unread > 0) {
          badge.textContent = unread > 99 ? '99+' : String(unread);
          badge.removeAttribute('hidden');
        } else {
          badge.setAttribute('hidden','');
        }

        list.innerHTML = items.map(item => `
          <li class="notif-item" data-id="${item.id}">
            <span class="notif-dot" style="${item.read ? 'opacity:.25' : ''}"></span>
            <div>
              <div class="notif-title">${escapeHtml(item.title)}</div>
              <div class="notif-desc">${escapeHtml(item.desc || '')}</div>
            </div>
            <div class="notif-time">${escapeHtml(item.time || '')}</div>
          </li>
        `).join('') || `
          <li class="notif-item"><div class="notif-desc">No notifications</div></li>
        `;
      }

      function fetchNotifications() {
        fetch('/api/notifications', { credentials: 'include' })
          .then(r => r.json())
          .then(items => {
            state = items;
            render(state);
          })
          .catch(err => {
            console.error("ÏïåÎ¶º Î∂àÎü¨Ïò§Í∏∞ Ïã§Ìå®:", err);
            state = [
              { id: 1, title: 'Booking confirmed', desc: 'Istanbul ‚Ä¢ 2‚Äì5 Sep', time: '2m ago', read: false },
              { id: 2, title: 'Level progress', desc: 'GOLD ‚Üí 78% reached', time: '1h ago', read: false },
              { id: 3, title: 'Promo', desc: 'Autumn deal unlocked', time: 'Yesterday', read: true }
            ];
            render(state);
          });
      }

      markAllBtn?.addEventListener('click', () => {
        fetch('/api/notifications/mark-all-read', {
          method: 'POST',
          credentials: 'include'
        })
          .then(() => {
            state = state.map(it => ({...it, read: true}));
            render(state);
          })
          .catch(err => console.error("Ï†ÑÏ≤¥ ÏùΩÏùå Ïã§Ìå®:", err));
      });

      fetchNotifications();
      setInterval(fetchNotifications, 30000);
    })();
  </script>

  <!-- ===== ÎÑ§ÎπÑ Ïù∏Ï¶ù ÏÉÅÌÉú ÌÜ†Í∏Ä (Login/Logout) ===== -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const link = document.getElementById("navAuthLink");
      if (!link) return;

      function toLoginUI() {
        link.setAttribute("data-i18n", "nav_login");
        link.textContent = "Login";
        link.href = "login.html";
        link.onclick = null;
        applyI18NPage?.();
      }

      function toLogoutUI() {
        link.setAttribute("data-i18n", "nav_logout");
        link.textContent = "Logout";
        link.href = "#";
        link.onclick = (e) => {
          e.preventDefault();
          localStorage.removeItem("sw_logged_in");
          alert("Î°úÍ∑∏ÏïÑÏõÉ ÎêòÏóàÏäµÎãàÎã§.");
          toLoginUI();
          updateHostMenu();
          location.href = "/";
        };
        applyI18NPage?.();
      }

      window.markLoggedIn = function () {
        localStorage.setItem("sw_logged_in", "true");
        toLogoutUI();
        updateHostMenu();
      };
      window.markLoggedOut = function () {
        localStorage.removeItem("sw_logged_in");
        toLoginUI();
        updateHostMenu();
      };

      if (localStorage.getItem("sw_logged_in") === "true") toLogoutUI();
      else toLoginUI();

      function updateHostMenu(){
        const panel = document.querySelector('#hostMenu .dropdown-panel');
        if(!panel) return;
        const signedIn = localStorage.getItem('sw_logged_in') === 'true';
        panel.querySelectorAll('[data-host-visible]').forEach(el=>el.style.display='none');
        panel.querySelectorAll(`[data-host-visible="${signedIn?'signedIn':'signedOut'}"]`).forEach(el=>el.style.display='block');
      }
      window.updateHostMenu = updateHostMenu;
      updateHostMenu();

      const hostLogout = document.getElementById('hostLogoutBtn');
      hostLogout?.addEventListener('click', (e)=>{
        e.preventDefault();
        localStorage.removeItem('sw_logged_in');
        alert('Î°úÍ∑∏ÏïÑÏõÉ ÎêòÏóàÏäµÎãàÎã§.');
        toLoginUI();
        updateHostMenu();
        location.href = '/';
      });

      // My Page Î≤ÑÌäº
      document.getElementById('btnMyPage')?.addEventListener('click', ()=>{
        const loggedIn = localStorage.getItem('sw_logged_in') === 'true';
        location.href = loggedIn ? '/mypage.html' : '/login.html';
      });

      // Host ÎìúÎ°≠Îã§Ïö¥ (Î™®Î∞îÏùº ÌÜ†Í∏Ä)
      const hostMenu = document.getElementById('hostMenu');
      if (hostMenu) {
        const toggle = hostMenu.querySelector('.dropdown-toggle');
        let hideTimer;
        toggle?.addEventListener('click', (e)=>{
          e.preventDefault();
          hostMenu.classList.toggle('open');
        });
        hostMenu.addEventListener('mouseleave', ()=>{
          hideTimer = setTimeout(()=>hostMenu.classList.remove('open'), 180);
        });
        hostMenu.addEventListener('mouseenter', ()=> clearTimeout(hideTimer));
      }
    });
  </script>

  <!-- Ïô∏Î∂Ä Ïä§ÌÅ¨Î¶ΩÌä∏(ÏûàÎäî ÌîÑÎ°úÏ†ùÌä∏Îßå) -->
  <script src="/assets/login-modal.js"></script>
  <script src="/assets/auth-bridge.js"></script>
  <script defer src="/concierge.js"></script>
  <script defer src="https://stayworld-notify-chat.netlify.app/concierge.js"></script>

  <!-- Ï∂îÏ≤ú ÏàôÏÜå Î°úÎî© ÏÉòÌîå (ÌååÏù¥Ïñ¥Ïä§ÌÜ†Ïñ¥ ÏÇ¨Ïö© Ïãú) -->
  <script type="module">
    // ÌïÑÏöî Ïãú /scripts/firebase.js ÏÖãÏóÖ ÌõÑ ÏÇ¨Ïö©
    // import { db, collection, query, where, orderBy, limit, getDocs } from '/scripts/firebase.js';

    const grid = document.getElementById('recosGrid');
    const skel = document.getElementById('recosSkeleton');
    const fallbackImg = 'https://images.unsplash.com/photo-1505691938895-1758d7feb511?q=80&w=1200&auto=format&fit=crop';

    function cardTemplate(item){
      const firstPhoto = Array.isArray(item?.photos) && item.photos.length ? item.photos[0] : fallbackImg;
      const price = typeof item?.price === 'number' ? item.price : 0;
      const title = item?.title || 'Untitled stay';
      const address = item?.address || '';
      const id = item?.id || '0';

      return `
        <a href="/results.html?listing=${id}" class="rounded-2xl overflow-hidden border border-white/10 bg-white/5 hover:bg-white/10 transition block">
          <img src="${firstPhoto}" alt="${title}" class="w-full h-48 object-cover">
          <div class="p-4">
            <div class="flex items-start justify-between gap-3">
              <h3 class="font-semibold line-clamp-1">${title}</h3>
              <div class="text-right shrink-0">
                <div class="font-bold">$${price}</div>
                <div class="text-xs text-white/60">/ night</div>
              </div>
            </div>
            <div class="text-sm text-white/60 mt-1 line-clamp-1">${address}</div>
            <div class="mt-3">
              <span class="inline-flex items-center gap-2 px-3 py-1 rounded-xl bg-white text-black text-sm font-semibold">
                ÏòàÏïΩÌïòÍ∏∞
              </span>
            </div>
          </div>
        </a>
      `;
    }

    async function loadFeatured(){
      try{
        // ÌååÏù¥Ïñ¥Ïä§ÌÜ†Ïñ¥Í∞Ä ÏóÜÏúºÎ©¥ ÎçîÎØ∏ Îç∞Ïù¥ÌÑ∞Î°ú ÌëúÏãú
        // const qref = query(collection(db, 'listings'), where('status','==','Active'), orderBy('createdAt','desc'), limit(6));
        // const snap = await getDocs(qref);
        // const items = snap.docs.map(d => ({ id: d.id, ...d.data() }));
        const items = [
          { id:'1', title:'Seine River View Suite', price:320, address:'Paris, France', photos:[fallbackImg]},
          { id:'2', title:'Shibuya Sky Apartment', price:280, address:'Tokyo, Japan', photos:[fallbackImg]},
          { id:'3', title:'Bosporus Luxury Loft', price:350, address:'Istanbul, T√ºrkiye', photos:[fallbackImg]},
          { id:'4', title:'Alps Chalet Retreat', price:420, address:'Zermatt, Switzerland', photos:[fallbackImg]},
          { id:'5', title:'Desert Mirage Villa', price:390, address:'Dubai, UAE', photos:[fallbackImg]},
          { id:'6', title:'Old Town Maisonette', price:260, address:'Barcelona, Spain', photos:[fallbackImg]},
        ];
        if (!items.length){
          skel.innerHTML = '<div class="text-white/60">ÌëúÏãúÌï† ÏàôÏÜåÍ∞Ä ÏóÜÏäµÎãàÎã§.</div>';
          return;
        }
        grid.innerHTML = items.map(cardTemplate).join('');
        skel.classList.add('hidden');
        grid.classList.remove('hidden');
      }catch(err){
        console.error('loadFeatured error', err);
        skel.innerHTML = '<div class="text-red-300">Ï∂îÏ≤ú ÏàôÏÜåÎ•º Î∂àÎü¨Ïò§ÏßÄ Î™ªÌñàÏäµÎãàÎã§.</div>';
      }
    }
    loadFeatured();
  </script>
</body>
</html>

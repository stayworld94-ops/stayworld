<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>STAYWORLD ‚Äî Luxury Global Reach</title>
  <link rel="stylesheet" href="style.css" />
  <!-- Leaflet (ÏßÄÎèÑ) -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="anonymous">
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin="anonymous"></script>
</head>
<body>
  <!-- ================= HEADER ================= -->
  <header class="site-header">
    <div class="container header-row">
      <a href="/" class="brand">
        <img src="stayworld-logo.png" alt="StayWorld" class="brand-logo" />
        <span class="brand-text">STAYWORLD</span>
      </a>

      <nav class="main-nav" aria-label="Primary">
        <a href="index.html" data-i18n="nav_home">Home</a>
        <a href="membership.html" data-i18n="nav_membership">Membership</a>
        <a href="login.html" data-i18n="nav_login">Login</a>
      </nav>

      <div class="header-cta">
        <div class="lang-wrap">
          <label for="lang" class="lang-label" data-i18n="language">Language</label>
          <select id="lang" class="lang-select" aria-label="Language">
            <option value="EN" selected>EN</option>
            <option value="KO">KO</option>
            <option value="JA">JA</option>
            <option value="ZH">ZH</option>
            <option value="FR">FR</option>
            <option value="ES">ES</option>
            <option value="DE">DE</option>
            <option value="TR">TR</option>
            <option value="AR">AR</option>
            <option value="RU">RU</option>
          </select>
        </div>
        <a href="signup.html" class="btn btn-primary" data-i18n="nav_signup">Sign Up</a>
      </div>
    </div>
  </header>

  <!-- ================= HERO ================= -->
  <section class="hero">
    <div class="container">
      <h1 class="hero-title">
        <span data-i18n="hero_luxury">Luxury stays.</span><br />
        <span class="accent" data-i18n="hero_reach">Global reach.</span>
      </h1>
      <p class="hero-sub" data-i18n="hero_sub">Cards, bank transfer & crypto (BTC ¬∑ ETH ¬∑ USDT).</p>

      <div class="search-bar" id="searchBar">
        <input type="text" class="input" id="searchDestination" placeholder="Paris, Tokyo, Istanbul‚Ä¶" data-i18n-placeholder="placeholder_city" />
        <input type="date" class="input" id="checkIn" />
        <input type="date" class="input" id="checkOut" />
        <button class="btn btn-chip" id="btnFilters" type="button" data-i18n="filters">Filters</button>
        <button class="btn btn-gold" id="btnSearch" type="button" data-i18n="search">Search</button>
      </div>

      <div class="features">
        <div class="card">
          <h3 data-i18n="feat_verified">Verified stays</h3>
          <p data-i18n="feat_verified_sub">Top picks near you.</p>
        </div>
        <div class="card">
          <h3 data-i18n="feat_rewards">StayWorld+ Rewards</h3>
          <p data-i18n="feat_rewards_sub">Earn points on every booking.</p>
        </div>
        <div class="card">
          <h3 data-i18n="feat_payments">Secure payments</h3>
          <p data-i18n="feat_payments_sub">Visa, Mastercard, Amex & Crypto.</p>
        </div>
      </div>
    </div>
  </section>

  <!-- ================= MAP ================= -->
  <section class="map-section">
    <div class="container">
      <div id="map" aria-label="Map" role="region"></div>
    </div>
  </section>

  <!-- ================= FILTER MODAL ================= -->
  <div id="filterModal" class="modal" aria-hidden="true">
    <div class="filter-dialog" role="dialog" aria-modal="true" aria-labelledby="filterTitle">
      <div class="filter-head">
        <div id="filterTitle" class="filter-title" data-i18n="filters">Filters</div>
        <button id="filterClose" class="btn btn-ghost" aria-label="Close">‚úï</button>
      </div>
      <div class="filter-body">
        <div class="filters-grid" id="filtersGrid"></div>
      </div>
      <div class="filter-foot">
        <button id="filterClear" class="btn btn-ghost" data-i18n="clear">Clear</button>
        <button id="filterApply" class="btn btn-primary" data-i18n="apply">Apply</button>
      </div>
    </div>
  </div>

  <!-- ================= CHATBOT ================= -->
  <div id="chatWidget" class="chat">
    <button id="chatToggle" class="chat-fab" aria-label="Open AI Chat">üí¨</button>
    <div class="chat-panel" aria-live="polite" aria-label="StayWorld AI">
      <div class="chat-head">
        <div class="chat-title">StayWorld AI</div>
        <button id="chatClose" class="btn btn-ghost" aria-label="Close">‚úï</button>
      </div>
      <div id="chatLog" class="chat-log"></div>
      <div class="chat-input-row">
        <input id="chatInput" class="chat-input" type="text" placeholder="Ask about stays, dates, or payments‚Ä¶" data-i18n-placeholder="chat_placeholder" />
        <button id="chatSend" class="btn btn-gold" data-i18n="send">Send</button>
      </div>
    </div>
  </div>

  <footer class="site-footer">
    <div class="container">
      <small>¬© StayWorld ‚Äî stayworldbooking.com</small>
    </div>
  </footer>

  <!-- ================= SCRIPTS ================= -->
  <script>
/* ---------------- I18N (10Í∞ú Ïñ∏Ïñ¥) ---------------- */
const I18N = {
  EN:{nav_home:"Home",nav_membership:"Membership",nav_login:"Login",nav_signup:"Sign Up",language:"Language",
      hero_luxury:"Luxury stays.",hero_reach:"Global reach.",hero_sub:"Cards, bank transfer & crypto (BTC ¬∑ ETH ¬∑ USDT).",
      placeholder_city:"Paris, Tokyo, Istanbul‚Ä¶",filters:"Filters",search:"Search",
      feat_verified:"Verified stays",feat_verified_sub:"Top picks near you.",
      feat_rewards:"StayWorld+ Rewards",feat_rewards_sub:"Earn points on every booking.",
      feat_payments:"Secure payments",feat_payments_sub:"Visa, Mastercard, Amex & Crypto.",
      clear:"Clear",apply:"Apply",send:"Send",chat_placeholder:"Ask about stays, dates, or payments‚Ä¶"},
  KO:{nav_home:"Home",nav_membership:"Membership",nav_login:"Login",nav_signup:"Sign Up",language:"Language",
      hero_luxury:"Îü≠ÏÖîÎ¶¨ Ïä§ÌÖåÏù¥.",hero_reach:"Í∏ÄÎ°úÎ≤å Î¶¨Ïπò.",hero_sub:"Ïπ¥Îìú, Í≥ÑÏ¢åÏù¥Ï≤¥ & ÌÅ¨Î¶ΩÌÜ† (BTC ¬∑ ETH ¬∑ USDT).",
      placeholder_city:"ÌååÎ¶¨, ÎèÑÏøÑ, Ïù¥Ïä§ÌÉÑÎ∂à‚Ä¶",filters:"ÌïÑÌÑ∞",search:"Í≤ÄÏÉâ",
      feat_verified:"Í≤ÄÏ¶ùÎêú Ïä§ÌÖåÏù¥",feat_verified_sub:"Í∞ÄÍπåÏö¥ Ï∂îÏ≤ú ÏàôÏÜå.",feat_rewards:"StayWorld+ Î¶¨ÏõåÎìú",feat_rewards_sub:"ÏòàÏïΩÎßàÎã§ Ìè¨Ïù∏Ìä∏ Ï†ÅÎ¶Ω.",
      feat_payments:"ÏïàÏ†ÑÌïú Í≤∞Ï†ú",feat_payments_sub:"VISA, ÎßàÏä§ÌÑ∞, ÏïÑÎ©ïÏä§ & ÌÅ¨Î¶ΩÌÜ†.",
      clear:"ÏßÄÏö∞Í∏∞",apply:"Ï†ÅÏö©",send:"Ï†ÑÏÜ°",chat_placeholder:"ÏàôÏÜå/ÎÇ†Ïßú/Í≤∞Ï†úÏóê ÎåÄÌï¥ Î¨ºÏñ¥Î≥¥ÏÑ∏Ïöî‚Ä¶"},
  JA:{nav_home:"Home",nav_membership:"Membership",nav_login:"Login",nav_signup:"Sign Up",language:"Language",
      hero_luxury:"Ë¥ÖÊ≤¢„Å™ÊªûÂú®„ÄÇ",hero_reach:"„Ç∞„É≠„Éº„Éê„É´„Å´„ÄÇ",hero_sub:"„Ç´„Éº„Éâ„ÄÅÈäÄË°åÊåØËæº„ÄÅÊöóÂè∑Ë≥áÁî£ÔºàBTC„ÉªETH„ÉªUSDTÔºâ„ÄÇ",
      placeholder_city:"„Éë„É™„ÄÅÊù±‰∫¨„ÄÅ„Ç§„Çπ„Çø„É≥„Éñ„Éº„É´‚Ä¶",filters:"„Éï„Ç£„É´„Çø„Éº",search:"Ê§úÁ¥¢",
      feat_verified:"Ê§úË®ºÊ∏à„Åø„ÅÆÂÆø",feat_verified_sub:"Ëøë„Åè„ÅÆ„Åä„Åô„Åô„ÇÅ„ÄÇ",feat_rewards:"StayWorld+ „É™„ÉØ„Éº„Éâ",feat_rewards_sub:"‰∫àÁ¥ÑÊØé„Å´„Éù„Ç§„É≥„Éà„ÄÇ",
      feat_payments:"ÂÆâÂÖ®„Å™ÊîØÊâï„ÅÑ",feat_payments_sub:"VISA, Master, Amex & Crypto„ÄÇ",
      clear:"„ÇØ„É™„Ç¢",apply:"ÈÅ©Áî®",send:"ÈÄÅ‰ø°",chat_placeholder:"ÂÆø„ÉªÊó•Á®ã„ÉªÊîØÊâï„ÅÑ„Å´„Å§„ÅÑ„Å¶Ë≥™Âïè‚Ä¶"},
  ZH:{nav_home:"È¶ñÈ°µ",nav_membership:"‰ºöÂëò",nav_login:"ÁôªÂΩï",nav_signup:"Ê≥®ÂÜå",language:"ËØ≠Ë®Ä",
      hero_luxury:"Â•¢Âçé‰ΩèÂÆø„ÄÇ",hero_reach:"ÂÖ®ÁêÉË¶ÜÁõñ„ÄÇ",hero_sub:"Èì∂Ë°åÂç°„ÄÅËΩ¨Ë¥¶‰∏éÂä†ÂØÜË¥ßÂ∏ÅÔºàBTC ¬∑ ETH ¬∑ USDTÔºâ„ÄÇ",
      placeholder_city:"Â∑¥Èªé„ÄÅ‰∏ú‰∫¨„ÄÅ‰ºäÊñØÂù¶Â∏ÉÂ∞î‚Ä¶",filters:"Á≠õÈÄâ",search:"ÊêúÁ¥¢",
      feat_verified:"Â∑≤È™åËØÅ‰ΩèÂÆø",feat_verified_sub:"ÈôÑËøëÁ≤æÈÄâ„ÄÇ",feat_rewards:"StayWorld+ Â•ñÂä±",feat_rewards_sub:"ÊØèÊ¨°È¢ÑËÆ¢ËµöÁßØÂàÜ„ÄÇ",
      feat_payments:"ÂÆâÂÖ®ÊîØ‰ªò",feat_payments_sub:"Visa„ÄÅMastercard„ÄÅAmex ‰∏éÂä†ÂØÜË¥ßÂ∏Å„ÄÇ",
      clear:"Ê∏ÖÈô§",apply:"Â∫îÁî®",send:"ÂèëÈÄÅ",chat_placeholder:"ËØ¢ÈóÆ‰ΩèÂÆø„ÄÅÊó•ÊúüÊàñÊîØ‰ªò‚Ä¶"},
  FR:{nav_home:"Accueil",nav_membership:"Adh√©sion",nav_login:"Connexion",nav_signup:"S‚Äôinscrire",language:"Langue",
      hero_luxury:"S√©jours de luxe.",hero_reach:"Port√©e mondiale.",hero_sub:"Carte, virement & crypto (BTC ¬∑ ETH ¬∑ USDT).",
      placeholder_city:"Paris, Tokyo, Istanbul‚Ä¶",filters:"Filtres",search:"Rechercher",
      feat_verified:"Logements v√©rifi√©s",feat_verified_sub:"Meilleurs choix pr√®s de chez vous.",
      feat_rewards:"R√©compenses StayWorld+",feat_rewards_sub:"Des points √† chaque r√©servation.",
      feat_payments:"Paiements s√©curis√©s",feat_payments_sub:"Visa, Mastercard, Amex & Crypto.",
      clear:"Effacer",apply:"Appliquer",send:"Envoyer",chat_placeholder:"Questions sur les s√©jours, dates ou paiements‚Ä¶"},
  ES:{nav_home:"Inicio",nav_membership:"Membres√≠a",nav_login:"Ingresar",nav_signup:"Reg√≠strate",language:"Idioma",
      hero_luxury:"Estancias de lujo.",hero_reach:"Alcance global.",hero_sub:"Tarjetas, transferencia bancaria y cripto (BTC ¬∑ ETH ¬∑ USDT).",
      placeholder_city:"Par√≠s, Tokio, Estambul‚Ä¶",filters:"Filtros",search:"Buscar",
      feat_verified:"Alojamientos verificados",feat_verified_sub:"Mejores opciones cerca de ti.",
      feat_rewards:"Recompensas StayWorld+",feat_rewards_sub:"Puntos en cada reserva.",
      feat_payments:"Pagos seguros",feat_payments_sub:"Visa, Mastercard, Amex y Cripto.",
      clear:"Borrar",apply:"Aplicar",send:"Enviar",chat_placeholder:"Pregunta sobre estancias, fechas o pagos‚Ä¶"},
  DE:{nav_home:"Start",nav_membership:"Mitgliedschaft",nav_login:"Login",nav_signup:"Registrieren",language:"Sprache",
      hero_luxury:"Luxuri√∂se Aufenthalte.",hero_reach:"Globale Reichweite.",hero_sub:"Karten, √úberweisung & Krypto (BTC ¬∑ ETH ¬∑ USDT).",
      placeholder_city:"Paris, Tokio, Istanbul‚Ä¶",filters:"Filter",search:"Suchen",
      feat_verified:"Verifizierte Unterk√ºnfte",feat_verified_sub:"Top-Auswahl in deiner N√§he.",
      feat_rewards:"StayWorld+ Pr√§mien",feat_rewards_sub:"Punkte bei jeder Buchung.",
      feat_payments:"Sichere Zahlungen",feat_payments_sub:"Visa, Mastercard, Amex & Krypto.",
      clear:"L√∂schen",apply:"Anwenden",send:"Senden",chat_placeholder:"Fragen zu Aufenthalt, Daten oder Zahlung‚Ä¶"},
  TR:{nav_home:"Ana Sayfa",nav_membership:"√úyelik",nav_login:"Giri≈ü",nav_signup:"Kaydol",language:"Dil",
      hero_luxury:"L√ºks konaklamalar.",hero_reach:"K√ºresel eri≈üim.",hero_sub:"Kart, havale ve kripto (BTC ¬∑ ETH ¬∑ USDT).",
      placeholder_city:"Paris, Tokyo, ƒ∞stanbul‚Ä¶",filters:"Filtreler",search:"Ara",
      feat_verified:"Doƒürulanmƒ±≈ü konaklamalar",feat_verified_sub:"Yakƒ±nƒ±nƒ±zdaki en iyi se√ßenekler.",
      feat_rewards:"StayWorld+ √ñd√ºlleri",feat_rewards_sub:"Her rezervasyonda puan kazanƒ±n.",
      feat_payments:"G√ºvenli √∂demeler",feat_payments_sub:"Visa, Mastercard, Amex & Kripto.",
      clear:"Temizle",apply:"Uygula",send:"G√∂nder",chat_placeholder:"Konaklama, tarihler veya √∂demeleri sorun‚Ä¶"},
  AR:{nav_home:"ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©",nav_membership:"ÿßŸÑÿπÿ∂ŸàŸäÿ©",nav_login:"ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ",nav_signup:"ÿ•ŸÜÿ¥ÿßÿ° ÿ≠ÿ≥ÿßÿ®",language:"ÿßŸÑŸÑÿ∫ÿ©",
      hero_luxury:"ÿ•ŸÇÿßŸÖÿßÿ™ ŸÅÿßÿÆÿ±ÿ©.",hero_reach:"ÿßŸÜÿ™ÿ¥ÿßÿ± ÿπÿßŸÑŸÖŸä.",hero_sub:"ÿ®ÿ∑ÿßŸÇÿßÿ™ÿå ÿ™ÿ≠ŸàŸäŸÑ ÿ®ŸÜŸÉŸä ŸàÿπŸÖŸÑÿßÿ™ ŸÖÿ¥ŸÅÿ±ÿ© (BTC ¬∑ ETH ¬∑ USDT).",
      placeholder_city:"ÿ®ÿßÿ±Ÿäÿ≥ÿå ÿ∑ŸàŸÉŸäŸàÿå ÿ•ÿ≥ÿ∑ŸÜÿ®ŸàŸÑ‚Ä¶",filters:"ÿßŸÑŸÅŸÑÿßÿ™ÿ±",search:"ÿ®ÿ≠ÿ´",
      feat_verified:"ÿ•ŸÇÿßŸÖÿßÿ™ ŸÖŸàÿ´ŸàŸÇÿ©",feat_verified_sub:"ÿ£ŸÅÿ∂ŸÑ ÿßŸÑÿÆŸäÿßÿ±ÿßÿ™ ÿ®ÿßŸÑŸÇÿ±ÿ® ŸÖŸÜŸÉ.",
      feat_rewards:"ŸÖŸÉÿßŸÅÿ¢ÿ™ StayWorld+",feat_rewards_sub:"ÿßŸÉÿ≥ÿ® ŸÜŸÇÿßÿ∑Ÿãÿß ŸÖÿπ ŸÉŸÑ ÿ≠ÿ¨ÿ≤.",
      feat_payments:"ŸÖÿØŸÅŸàÿπÿßÿ™ ÿ¢ŸÖŸÜÿ©",feat_payments_sub:"Visa ŸàMastercard ŸàAmex ŸàÿßŸÑÿπŸÖŸÑÿßÿ™ ÿßŸÑŸÖÿ¥ŸÅÿ±ÿ©.",
      clear:"ŸÖÿ≥ÿ≠",apply:"ÿ™ÿ∑ÿ®ŸäŸÇ",send:"ÿ•ÿ±ÿ≥ÿßŸÑ",chat_placeholder:"ÿßÿ≥ÿ£ŸÑ ÿπŸÜ ÿßŸÑÿ•ŸÇÿßŸÖÿßÿ™ ÿ£Ÿà ÿßŸÑÿ™Ÿàÿßÿ±ŸäÿÆ ÿ£Ÿà ÿßŸÑŸÖÿØŸÅŸàÿπÿßÿ™‚Ä¶"},
  RU:{nav_home:"–ì–ª–∞–≤–Ω–∞—è",nav_membership:"–ü–æ–¥–ø–∏—Å–∫–∞",nav_login:"–í–æ–π—Ç–∏",nav_signup:"–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è",language:"–Ø–∑—ã–∫",
      hero_luxury:"–†–æ—Å–∫–æ—à–Ω–æ–µ –ø—Ä–æ–∂–∏–≤–∞–Ω–∏–µ.",hero_reach:"–ì–ª–æ–±–∞–ª—å–Ω—ã–π –æ—Ö–≤–∞—Ç.",hero_sub:"–ö–∞—Ä—Ç—ã, –ø–µ—Ä–µ–≤–æ–¥ –∏ –∫—Ä–∏–ø—Ç–æ (BTC ¬∑ ETH ¬∑ USDT).",
      placeholder_city:"–ü–∞—Ä–∏–∂, –¢–æ–∫–∏–æ, –°—Ç–∞–º–±—É–ª‚Ä¶",filters:"–§–∏–ª—å—Ç—Ä—ã",search:"–ü–æ–∏—Å–∫",
      feat_verified:"–ü—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã",feat_verified_sub:"–õ—É—á—à–∏–µ –º–µ—Å—Ç–∞ —Ä—è–¥–æ–º —Å –≤–∞–º–∏.",
      feat_rewards:"–ë–æ–Ω—É—Å—ã StayWorld+",feat_rewards_sub:"–ë–∞–ª–ª—ã –∑–∞ –∫–∞–∂–¥–æ–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ.",
      feat_payments:"–ë–µ–∑–æ–ø–∞—Å–Ω—ã–µ –ø–ª–∞—Ç–µ–∂–∏",feat_payments_sub:"Visa, Mastercard, Amex –∏ –∫—Ä–∏–ø—Ç–æ.",
      clear:"–û—á–∏—Å—Ç–∏—Ç—å",apply:"–ü—Ä–∏–º–µ–Ω–∏—Ç—å",send:"–û—Ç–ø—Ä–∞–≤–∏—Ç—å",chat_placeholder:"–°–ø—Ä–æ—Å–∏—Ç–µ –æ –ø—Ä–æ–∂–∏–≤–∞–Ω–∏–∏, –¥–∞—Ç–∞—Ö –∏–ª–∏ –æ–ø–ª–∞—Ç–µ‚Ä¶"},
};

function applyI18N(lang){
  const dict = I18N[lang] || I18N.EN;
  // text nodes
  document.querySelectorAll('[data-i18n]').forEach(el=>{
    const k = el.getAttribute('data-i18n'); if(dict[k]) el.textContent = dict[k];
  });
  // placeholders
  document.querySelectorAll('[data-i18n-placeholder]').forEach(el=>{
    const k = el.getAttribute('data-i18n-placeholder'); if(dict[k]) el.setAttribute('placeholder', dict[k]);
  });
}
document.getElementById('lang').addEventListener('change', e=>{
  applyI18N(e.target.value);
});
applyI18N('EN');

/* ---------------- Filters (Ïπ¥ÌÖåÍ≥†Î¶¨ Î†åÎçî) ---------------- */
const FILTER_SETS = [
  { title:'Amenities', items:['Wi-Fi','Pool','Spa','Gym','Kitchen','Balcony','Hot tub','Sauna','Air conditioning','Breakfast']},
  { title:'Property type', items:['Hotel','Apartment','Villa','Hostel','B&B']},
  { title:'Views & Outdoors', items:['Sea view','City view','Mountain view','Garden']},
  { title:'Payments & Policies', items:['Crypto','Cards','Bank transfer','Free cancellation','Late checkout','Non-smoking']},
  { title:'Accessibility', items:['Accessible','Step-free access','Elevator','Family-friendly','24h check-in','Airport shuttle']},
  { title:'Pets', items:['Pet-friendly']},
];

(function buildFilters(){
  const grid = document.getElementById('filtersGrid');
  grid.innerHTML = '';
  FILTER_SETS.forEach((col,i)=>{
    const colEl = document.createElement('div');
    colEl.className = 'filters-col';
    const list = col.items.map((name,idx)=>{
      const id = `f_${i}_${idx}_${name.replace(/[^a-z0-9]+/gi,'_')}`;
      return `<li class="filter-item">
        <input class="filter-check" type="checkbox" id="${id}" data-name="${name}">
        <label class="filter-label" for="${id}">${name}</label>
      </li>`;
    }).join('');
    colEl.innerHTML = `<h4 class="filters-col-title">${col.title}</h4><ul class="filters-list">${list}</ul>`;
    grid.appendChild(colEl);
  });
})();

const modal = document.getElementById('filterModal');
const btnFilters = document.getElementById('btnFilters');
const btnApply = document.getElementById('filterApply');
const btnClear = document.getElementById('filterClear');
const btnClose = document.getElementById('filterClose');

function selectedCount(){ return modal.querySelectorAll('.filter-check:checked').length; }
function openFilters(){ modal.classList.add('open'); document.documentElement.classList.add('modal-open'); modal.setAttribute('aria-hidden','false'); }
function closeFilters(){ modal.classList.remove('open'); document.documentElement.classList.remove('modal-open'); modal.setAttribute('aria-hidden','true'); updateBadge(); }
function updateBadge(){
  const n = selectedCount();
  if(n>0){ btnFilters.classList.add('badge'); btnFilters.dataset.badge = n; }
  else { btnFilters.classList.remove('badge'); delete btnFilters.dataset.badge; }
}
btnFilters.addEventListener('click', e=>{ e.preventDefault(); e.stopPropagation(); openFilters(); });
btnClose.addEventListener('click', e=>{ e.preventDefault(); closeFilters(); });
modal.addEventListener('click', e=>{ if(e.target===modal) closeFilters(); });
btnClear.addEventListener('click', ()=>{ modal.querySelectorAll('.filter-check:checked').forEach(el=>el.checked=false); updateBadge(); });
btnApply.addEventListener('click', ()=>{ closeFilters(); console.log('Filters:', Array.from(modal.querySelectorAll('.filter-check:checked')).map(x=>x.dataset.name)); });
modal.addEventListener('change', e=>{ if(e.target.classList.contains('filter-check')) updateBadge(); });

/* ---------------- ÏßÄÎèÑ (Leaflet + Nominatim) ---------------- */
let map, marker;
function initMap(){
  map = L.map('map', { scrollWheelZoom: true }).setView([48.8566, 2.3522], 12); // Paris default
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; OpenStreetMap'
  }).addTo(map);
}
initMap();

async function geocodeAndGo(q){
  if(!q) return;
  try{
    const url = `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(q)}&limit=1&addressdetails=0`;
    const res = await fetch(url, { headers: { 'Accept-Language': document.getElementById('lang').value }});
    const data = await res.json();
    if(data && data[0]){
      const { lat, lon } = data[0];
      const latf = parseFloat(lat), lonf = parseFloat(lon);
      if(marker) marker.remove();
      marker = L.marker([latf, lonf]).addTo(map);
      map.setView([latf, lonf], 13);
    } else {
      alert('No results for that destination.');
    }
  }catch(e){
    console.error(e);
    alert('Map lookup failed.');
  }
}
document.getElementById('btnSearch').addEventListener('click', ()=>{
  geocodeAndGo(document.getElementById('searchDestination').value);
});

/* ---------------- Ï±óÎ¥á ---------------- */
const chat = {
  elLog: document.getElementById('chatLog'),
  elPanel: document.querySelector('.chat-panel'),
  elToggle: document.getElementById('chatToggle'),
  elClose: document.getElementById('chatClose'),
  elInput: document.getElementById('chatInput'),
  elSend: document.getElementById('chatSend'),
  msgs: []
};

function addMsg(role, text){
  const wrap = document.createElement('div');
  wrap.className = 'msg ' + (role==='user' ? 'me' : 'ai');
  wrap.textContent = text;
  chat.elLog.appendChild(wrap);
  chat.elLog.scrollTop = chat.elLog.scrollHeight;
}
function toggleChat(open){
  if(open){ chat.elPanel.classList.add('open'); }
  else { chat.elPanel.classList.remove('open'); }
}
chat.elToggle.addEventListener('click', e=>{ e.stopPropagation(); toggleChat(true); });
chat.elClose.addEventListener('click', e=>{ e.stopPropagation(); toggleChat(false); });
document.addEventListener('click', e=>{
  // Ìå®ÎÑê Î∞ñ ÌÅ¥Î¶≠ Ïãú Îã´Í∏∞ (FAB, ÏûÖÎ†•ÏòÅÏó≠ Ï†úÏô∏)
  if(!e.target.closest('.chat-panel') && !e.target.closest('#chatToggle')){
    toggleChat(false);
  }
});
// Ïù¥Î≤§Ìä∏ Ï†ÑÌååÎ°ú Îã§Î•∏ Î≤ÑÌäºÏù¥ Ï£ΩÏßÄ ÏïäÎèÑÎ°ù
['btnFilters','btnSearch','chatToggle','chatClose','chatSend'].forEach(id=>{
  const b = document.getElementById(id);
  if(b) b.addEventListener('click', ev=>ev.stopPropagation(), {capture:true});
});

async function callAssistant(userText){
  // Ìò∏Ï∂ú Í∞ÄÎä•Ìïú ÏóîÎìúÌè¨Ïù∏Ìä∏ ÏûêÎèô ÌÉêÏÉâ (Netlify/Vercel/Generic)
  const endpoints = ['/api/chat', '/.netlify/functions/chat', '/api/openai'];
  let endpoint = null;
  for(const ep of endpoints){
    try{
      const ping = await fetch(ep, { method:'OPTIONS' });
      if (ping.ok || ping.status===405 || ping.status===404) { endpoint = ep; break; }
    }catch(_){}
  }
  if(!endpoint){ throw new Error('No backend endpoint found.'); }

  const payload = {
    model: 'gpt-4.1',
    messages: [
      ...chat.msgs,
      { role:'user', content: userText }
    ],
    // ÏÑ†ÌÉù Ïñ∏Ïñ¥ ÌûåÌä∏
    metadata: { lang: document.getElementById('lang').value }
  };

  const res = await fetch(endpoint, {
    method: 'POST',
    headers: {'Content-Type':'application/json'},
    body: JSON.stringify(payload)
  });
  if(!res.ok) throw new Error('Assistant error');
  const data = await res.json();
  return (data.reply || data.content || '').toString();
}

async function sendChat(){
  const text = chat.elInput.value.trim();
  if(!text) return;
  chat.elInput.value = '';
  addMsg('user', text);
  chat.msgs.push({role:'user', content:text});
  addMsg('assistant', '‚Ä¶');

  try{
    const reply = await callAssistant(text);
    chat.elLog.lastChild.textContent = reply || '(no content)';
    chat.msgs.push({role:'assistant', content: reply});
  }catch(e){
    console.error(e);
    chat.elLog.lastChild.textContent = 'Assistant is unavailable. Please add the backend function and OPENAI_API_KEY.';
  }
}
chat.elSend.addEventListener('click', sendChat);
chat.elInput.addEventListener('keydown', e=>{ if(e.key==='Enter') sendChat(); });

/* ---------------- Ï¥àÍ∏∞ ÏÉÅÌÉú ---------------- */
updateBadge();
  </script>
</body>
</html>

</html>

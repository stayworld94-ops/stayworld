<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>STAYWORLD — Luxury Global Reach</title>

  <!-- Leaflet (지도) -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin="anonymous">
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin="anonymous"></script>

  <!-- 통합 CSS -->
  <link rel="stylesheet" href="/assets/style.css" />
</head>

<body>
  <!-- HEADER -->
  <header class="site-header">
    <div class="container header-row">
      <a href="/" class="brand">
        <img src="/stayworld-logo.png" alt="StayWorld" class="brand-logo" />
        <span class="brand-text">STAYWORLD</span>
      </a>

      <nav class="main-nav" aria-label="Primary">
        <!-- [ADD] My Page 버튼 (로그인 시 노출) -->
        <button class="btn btn-gold" id="btnMyPage" data-goto="mypage" style="display:none">My Page</button>

        <a href="index.html" data-i18n="nav_home">Home</a>
        <a href="membership.html" data-i18n="nav_membership">Membership</a>

        <!-- ===== Host 메뉴 ===== -->
        <div class="nav-item dropdown" id="hostMenu">
          <button class="nav-link dropdown-toggle" data-i18n="nav_host">Host</button>
          <div class="dropdown-panel">
            <!-- 비로그인 상태 -->
            <a href="host-login.html"  class="dropdown-item" data-host-visible="signedOut" data-i18n="host_login">Host Login</a>
            <a href="host-register.html" class="dropdown-item" data-host-visible="signedOut" data-i18n="host_signup">Host Sign Up</a>
            <div class="dropdown-divider" data-host-visible="signedOut"></div>
            <!-- 호스트 로그인 상태 -->
            <a href="host-property-new.html" class="dropdown-item" data-host-visible="hostOnly" data-i18n="host_register_property">Register Property</a>
            <a href="host-dashboard.html" class="dropdown-item" data-host-visible="hostOnly" data-i18n="host_my_listings">My Listings</a>
            <button class="dropdown-item" data-host-visible="hostOnly" id="hostLogoutBtn" type="button" data-i18n="host_logout">Logout</button>
          </div>
        </div>

        <!-- ===== Admin 메뉴 ===== -->
        <div class="nav-item dropdown" id="adminMenu" style="display:none">
          <button class="nav-link dropdown-toggle">Admin</button>
          <div class="dropdown-panel">
            <a href="admin-dashboard.html" class="dropdown-item">Dashboard</a>
            <a href="admin-users.html" class="dropdown-item">Users</a>
            <a href="admin-settings.html" class="dropdown-item">Settings</a>
          </div>
        </div>

        <!-- Auth 링크 -->
        <a href="login.html" id="navAuthLink" data-i18n="nav_login">Login</a>
      </nav>

      <div class="header-cta">
        <label for="lang" class="lang-label" data-i18n="language">Language</label>
        <select id="lang" class="lang-select">
          <option value="EN" selected>EN</option>
          <option value="KO">KO</option>
          <option value="JA">JA</option>
          <option value="ZH">ZH</option>
          <option value="FR">FR</option>
          <option value="ES">ES</option>
          <option value="DE">DE</option>
          <option value="TR">TR</option>
          <option value="AR">AR</option>
          <option value="RU">RU</option>
        </select>
        <a href="signup.html" class="btn btn-gold" data-i18n="nav_signup">Sign Up</a>
      </div>
    </div>
  </header>

  <!-- HERO -->
  <section class="hero">
    <div class="container">
      <h1 class="hero-title"><span data-i18n="hero_luxury">Luxury stays.</span><br><span class="accent" data-i18n="hero_reach">Global reach.</span></h1>
      <p class="hero-sub" data-i18n="hero_sub">Cards, bank transfer & crypto (BTC · ETH · USDT).</p>

      <div class="search-bar">
        <input class="input" id="searchDestination" type="text" placeholder="Paris, Tokyo, Istanbul…" data-i18n-placeholder="placeholder_city">
        <input class="input" id="checkIn" type="date">
        <input class="input" id="checkOut" type="date">
        <button class="btn btn-chip" id="btnFilters" type="button" data-i18n="filters">Filters</button>
        <button class="btn btn-gold" id="btnSearch" type="button" data-i18n="search">Search</button>
      </div>
      <div id="searchStatus" class="search-status"></div>

      <div class="features">
        <div class="card"><h3 data-i18n="feat_verified">Verified stays</h3><p data-i18n="feat_verified_sub">Top picks near you.</p></div>
        <div class="card"><h3 data-i18n="feat_rewards">StayWorld+ Rewards</h3><p data-i18n="feat_rewards_sub">Earn points on every booking.</p></div>
        <div class="card"><h3 data-i18n="feat_payments">Secure payments</h3><p data-i18n="feat_payments_sub">Visa, Mastercard, Amex & Crypto.</p></div>
      </div>
    </div>
  </section>

  <!-- MAP -->
  <section class="map-section">
    <div class="container"><div id="map" aria-label="Map" role="region"></div></div>
  </section>

  <!-- My Page -->
  <section id="mypage" class="sw-section" style="display:none">
    <div class="container">
      <h2>My Page · Favorites ⭐</h2>
      <div class="mypage-panels">
        <div class="fav-list card"><h3>My Favorites</h3><div id="favList"></div></div>
        <div class="fav-map card"><div id="favMap"></div></div>
      </div>
    </div>
  </section>

  <!-- Footer -->
  <footer class="site-footer">
    <div class="container"><small data-i18n="footer_copy">© StayWorld — stayworldbooking.com</small></div>
  </footer>

  <!-- ===== SCRIPTS: 번역 / 필터 / 지도 / 챗봇 / Auth ===== -->
  <script src="/assets/index-app.js"></script>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const link = document.getElementById("navAuthLink");
      const myPageBtn = document.getElementById("btnMyPage");
      const adminMenu = document.getElementById("adminMenu");

      function toLoginUI() {
        link.setAttribute("data-i18n", "nav_login");
        link.textContent = "Login";
        link.href = "login.html";
        link.onclick = null;
        myPageBtn.style.display="none";
        applyI18NPage?.();
      }

      function toLogoutUI() {
        link.setAttribute("data-i18n", "nav_logout");
        link.textContent = "Logout";
        link.href = "#";
        link.onclick = (e) => {
          e.preventDefault();
          localStorage.clear();
          alert("로그아웃 되었습니다.");
          toLoginUI();
          updateRoleMenus();
          location.href = "/";
        };
        myPageBtn.style.display="inline-block";
        applyI18NPage?.();
      }

      // ✅ 로그인 성공 시 호출 (role: user/host/admin)
      window.markLoggedIn = function (role="user") {
        localStorage.setItem("sw_logged_in", "true");
        localStorage.setItem("sw_user_role", role);
        toLogoutUI();
        updateRoleMenus();
        alert("환영합니다! 로그인되었습니다.");
      };

      window.markLoggedOut = function () {
        localStorage.clear();
        toLoginUI();
        updateRoleMenus();
      };

      // --- Host & Admin 메뉴 제어 ---
      function updateRoleMenus() {
        const role = localStorage.getItem("sw_user_role");
        const signedIn = localStorage.getItem("sw_logged_in") === "true";

        // Host 메뉴
        const hostPanel = document.querySelector("#hostMenu .dropdown-panel");
        if (hostPanel) {
          hostPanel.querySelectorAll("[data-host-visible]").forEach(el => el.style.display="none");
          if (!signedIn) {
            hostPanel.querySelectorAll('[data-host-visible="signedOut"]').forEach(el=>el.style.display="block");
          } else if (role === "host") {
            hostPanel.querySelectorAll('[data-host-visible="hostOnly"]').forEach(el=>el.style.display="block");
          }
        }

        // Admin 메뉴
        if (adminMenu) {
          adminMenu.style.display = (role==="admin") ? "block" : "none";
        }
      }
      window.updateRoleMenus = updateRoleMenus;

      // 초기 상태 반영
      if (localStorage.getItem("sw_logged_in") === "true") toLogoutUI();
      else toLoginUI();
      updateRoleMenus();

      // Host 로그아웃 버튼
      const hostLogout = document.getElementById("hostLogoutBtn");
      hostLogout?.addEventListener("click", (e)=>{
        e.preventDefault();
        localStorage.clear();
        alert("호스트 로그아웃 되었습니다.");
        toLoginUI();
        updateRoleMenus();
        location.href = "/";
      });
    });
  </script>
</body>
</html>

<!-- 웰컴 바 -->
<div class="welcome-bar" id="welcomeBar">
  <span class="welcome-text">Welcome, <strong>GIJUN YOON</strong> 🎉</span>

  <!-- 알림 버튼 -->
  <button class="notif-btn" id="notifBtn" aria-label="Notifications" title="Notifications">
    <!-- 벨 아이콘 (SVG) -->
    <svg viewBox="0 0 24 24" width="22" height="22" aria-hidden="true">
      <path d="M12 22a2.5 2.5 0 0 0 2.45-2h-4.9A2.5 2.5 0 0 0 12 22Zm7-6V11a7 7 0 0 0-5-6.71V4a2 2 0 1 0-4 0v.29A7 7 0 0 0 5 11v5l-1.8 1.8A1 1 0 0 0 3.8 20h16.4a1 1 0 0 0 .7-1.7L19 16Z" fill="currentColor"/>
    </svg>
    <span class="notif-badge" id="notifBadge" hidden>0</span>
  </button>

  <!-- 알림 드롭다운 -->
  <div class="notif-panel" id="notifPanel" hidden>
    <div class="notif-header">
      <span>Notifications</span>
      <button id="markAllReadBtn" class="mark-read">Mark all read</button>
    </div>
    <ul id="notifList" class="notif-list"></ul>
    <div class="notif-footer">
      <a href="/notifications.html">View all</a>
    </div>
  </div>
</div>
 <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>STAYWORLD — Luxury Global Reach</title>

  <!-- Leaflet (지도) -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin="anonymous">
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin="anonymous"></script>

  <!-- 통합 CSS -->
  <style>
    :root{--bg:#0b0f16;--panel:#101018;--text:#e7e9ee;--muted:#cfd6e6;--line:rgba(255,255,255,.08);--chip:#121a26;--gold1:#f4d78c;--gold2:#c9a35b}
    *{box-sizing:border-box}html,body{margin:0;padding:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Inter,Roboto,sans-serif;line-height:1.5}
    a{color:inherit;text-decoration:none}.container{max-width:1120px;margin:0 auto;padding:0 16px}
    img{max-width:100%;display:block}

    /* Header */
    .site-header{position:sticky;top:0;z-index:1000;background:rgba(11,15,22,.85);backdrop-filter:blur(8px);border-bottom:1px solid var(--line)}
    .header-row{display:flex;align-items:center;justify-content:space-between;gap:20px;height:72px}
    .brand{display:flex;align-items:center;gap:10px}.brand-logo{width:36px;height:36px;border-radius:8px;box-shadow:0 4px 18px rgba(0,0,0,.3)}
    .brand-text{font-weight:800;letter-spacing:.6px}
    .main-nav{display:flex;gap:28px;justify-content:center;flex:1}
    .header-cta{display:flex;align-items:center;gap:12px}
    .lang-label{font-size:12px;opacity:.7}
    .lang-select{appearance:none;background:#101826;border:1px solid var(--line);color:var(--text);border-radius:12px;padding:8px 32px 8px 10px}
    .btn{border:0;padding:10px 14px;border-radius:12px;cursor:pointer}
    .btn-ghost{background:transparent;color:#cfcfcf}.btn-ghost:hover{background:rgba(255,255,255,.06)}
    .btn-gold{background:linear-gradient(180deg,var(--gold1),var(--gold2));color:#170f04;font-weight:700;border-radius:14px;padding:12px 18px;box-shadow:0 8px 26px rgba(201,163,91,.35)}
    .btn-chip{background:var(--chip);color:#dfe3ea;border:1px solid var(--line);border-radius:14px;padding:10px 14px}

    /* ---- Host dropdown ---- */
    .nav-item.dropdown{position:relative}
    .nav-link.dropdown-toggle{display:inline-flex;align-items:center;gap:6px;cursor:pointer;padding:6px 0;font-weight:600;opacity:.95}
    .dropdown-panel{
      position:absolute; top:100%; left:50%; transform:translate(-50%, 8px);
      min-width:220px; background:#0f1520; border:1px solid var(--line); border-radius:12px; padding:8px; z-index:30;
      box-shadow:0 16px 40px rgba(0,0,0,.45); visibility:hidden; opacity:0; pointer-events:none;
      transition:opacity .12s ease, transform .12s ease, visibility .12s;
    }
    .nav-item.dropdown:hover .dropdown-panel,
    .nav-item.dropdown:focus-within .dropdown-panel,
    .nav-item.dropdown.open .dropdown-panel{visibility:visible;opacity:1;pointer-events:auto;transform:translate(-50%,0)}
    .dropdown-item{display:block;padding:10px 12px;border-radius:8px;color:#e7e9ee;text-decoration:none;white-space:nowrap}
    .dropdown-item:hover{background:#121a26}
    .dropdown-divider{height:1px;background:var(--line);margin:6px 0}

    /* Hero */
    .hero{padding:48px 0 24px;background:radial-gradient(1200px 500px at 20% -10%,rgba(244,215,140,.12),transparent),radial-gradient(1200px 600px at 100% 0,rgba(78,94,130,.18),transparent)}
    .hero-title{font-size:48px;letter-spacing:.2px;margin:10px 0 8px}.accent{color:#f1cf84}
    .hero-sub{opacity:.85;margin:8px 0 28px}
    .search-bar{display:grid;grid-template-columns:1.2fr .7fr .7fr auto auto;gap:10px;align-items:center}
    .input{background:#0f1621;border:1px solid var(--line);color:var(--text);padding:12px 14px;border-radius:12px}
    .input::placeholder{color:#a7b0bf}
    .search-status{margin-top:8px;color:#cfd6e6;opacity:0;transition:opacity .3s}
    .btn.loading{opacity:.65;pointer-events:none}

    /* 카드 */
    .features{display:grid;grid-template-columns:repeat(3,1fr);gap:14px;margin-top:28px}
    .card{background:#0f1420;border:1px solid var(--line);border-radius:16px;padding:18px;box-shadow:0 8px 30px rgba(0,0,0,.25)}
    .card h3{margin:0 0 6px}.card p{margin:0;opacity:.85}

    /* Map */
    .map-section{padding:36px 0 60px}
    #map{height:420px;border-radius:16px;border:1px solid var(--line);box-shadow:0 8px 30px rgba(0,0,0,.25);overflow:hidden}
    .leaflet-container,.leaflet-pane,.leaflet-top,.leaflet-bottom{z-index:10 !important}

    /* 필터 드로어 (index 전용) */
    #filterDrawer{position:fixed;inset:0;display:none;z-index:2147483637;align-items:stretch;justify-content:flex-end}
    #filterDrawer[aria-hidden="false"]{display:flex}
    #filterDrawer .back{position:absolute;inset:0;background:rgba(0,0,0,.45)}
    #filterDrawer .panel{position:relative;margin-left:auto;width:min(780px,92vw);max-height:92vh;overflow:auto;background:var(--panel);border-left:1px solid var(--line);border-top-left-radius:16px;border-bottom-left-radius:16px;display:flex;flex-direction:column}
    #filterDrawer .head,#filterDrawer .foot{display:flex;align-items:center;justify-content:space-between;padding:12px 14px;border-bottom:1px solid var(--line)}
    #filterDrawer .foot{border-bottom:0;border-top:1px solid var(--line)}
    #filterGrid{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:14px;padding:14px}
    #filterDrawer .box{background:#0f1420;border:1px solid var(--line);border-radius:12px;padding:12px}
    #filterDrawer h4{margin:0 0 8px;font-size:14px}
    .sw-badge{position:absolute;top:-8px;right:-8px;background:#ffd36e;color:#1a1205;border-radius:999px;font-size:11px;padding:2px 6px}

    /* 챗봇 */
    #chatFab{position:fixed;right:20px;bottom:20px;width:56px;height:56px;border-radius:50%;border:0;cursor:pointer;z-index:2147483639;background:linear-gradient(180deg,var(--gold1),var(--gold2));box-shadow:0 14px 30px rgba(201,163,91,.35);font-size:22px}
    #botPanel{position:fixed;right:20px;bottom:86px;width:min(360px,88vw);height:480px;background:#101018;border:1px solid #23232b;border-radius:16px;z-index:2147483638;display:none;box-shadow:0 20px 60px rgba(0,0,0,.5);color:var(--text)}
    #botPanel .hdr{display:flex;align-items:center;justify-content:space-between;padding:10px 12px;border-bottom:1px solid var(--line)}
    #botPanel .body{height:360px;overflow:auto;padding:10px;display:flex;flex-direction:column;gap:8px}
    #botPanel .row{display:flex;gap:8px;padding:10px;border-top:1px solid var(--line)}
    #botInput{flex:1;background:#0f1621;border:1px solid var(--line);color:var(--text);border-radius:12px;padding:10px 12px}
    #botSend{border:0;border-radius:12px;padding:10px 14px;background:linear-gradient(180deg,var(--gold1),var(--gold2));color:#1a1205;font-weight:700}
    .msg{max-width:80%;padding:10px 12px;border-radius:12px}.me{align-self:flex-end;background:#132132}.ai{align-self:flex-start;background:#121820}

    /* Footer */
    .site-footer{padding:28px 0;border-top:1px solid var(--line);opacity:.8}

    /* Responsive */
    @media (max-width:920px){.main-nav{display:none}.hero-title{font-size:40px}.search-bar{grid-template-columns:1fr 1fr 1fr auto}}
    @media (max-width:640px){.hero-title{font-size:34px}.features{grid-template-columns:1fr}}
  </style>
</head>

<body>
  <!-- HEADER -->
 <header class="site-header">
  <div class="container flex-between">
    <!-- 로고 -->
    <div class="logo">
      <a href="/"><img src="/assets/img/logo-stayworld.png" alt="StayWorld Logo" /></a>
    </div>

    <!-- 내비게이션 -->
    <nav class="main-nav">
      <a href="/" id="t_nav_home" data-i18n="nav.home">Home</a>
      <a href="/membership" id="t_nav_membership" data-i18n="nav.membership">Membership</a>
    </nav>

    <!-- 언어 선택 -->
    <div class="lang-select">
      <select id="langSelect">
        <option value="en">EN</option>
        <option value="ko">KO</option>
        <option value="fr">FR</option>
        <option value="ja">JA</option>
        <option value="de">DE</option>
        <option value="es">ES</option>
        <option value="it">IT</option>
        <option value="tr">TR</option>
        <option value="zh">ZH</option>
        <option value="ru">RU</option>
      </select>
    </div>

    <!-- 인증 영역 -->
    <div class="auth-area">
      <!-- 로그인 전만 보임 -->
      <a href="/login" class="btn" data-auth="login-btn">Login</a>

      <!-- 로그인 후만 보임 -->
      <button class="btn" data-auth="logout-btn" style="display:none">Logout</button>

      <!-- 로그인 후 사용자 표시 -->
      <span class="user-info" data-auth="user-only" style="display:none">
        <span class="avatar" data-auth="avatar-initial"></span>
        <b data-auth="profile-name"></b>
      </span>

      <!-- 게스트 전용 메시지 -->
      <span class="guest-msg" data-auth="guest-only">Welcome, Guest</span>
    </div>
  </div>
</header>
  <!-- Hero 섹션 위나 아래 원하는 위치 -->
<div id="welcomeBanner" class="hidden banner bg-white/10 text-white p-4 rounded-xl mb-4">
  <span data-i18n="welcome_prefix">Welcome</span>, 
  <strong data-welcome-name></strong> 🎉
</div>


  <!-- HERO -->
  <section class="hero">
    <div class="container">
      <h1 class="hero-title"><span data-i18n="hero_luxury">Luxury stays.</span><br><span class="accent" data-i18n="hero_reach">Global reach.</span></h1>
      <p class="hero-sub" data-i18n="hero_sub">Cards, bank transfer & crypto (BTC · ETH · USDT).</p>

      <div class="search-bar">
        <input class="input" id="searchDestination" type="text" placeholder="Paris, Tokyo, Istanbul…" data-i18n-placeholder="placeholder_city">
        <input class="input" id="checkIn" type="date">
        <input class="input" id="checkOut" type="date">
        <button class="btn btn-chip" id="btnFilters" type="button" data-i18n="filters">Filters</button>
        <button class="btn btn-gold" id="btnSearch" type="button" data-i18n="search">Search</button>
      </div>
      <div id="searchStatus" class="search-status"></div>

      <div class="features">
        <div class="card"><h3 data-i18n="feat_verified">Verified stays</h3><p data-i18n="feat_verified_sub">Top picks near you.</p></div>
        <div class="card"><h3 data-i18n="feat_rewards">StayWorld+ Rewards</h3><p data-i18n="feat_rewards_sub">Earn points on every booking.</p></div>
        <div class="card"><h3 data-i18n="feat_payments">Secure payments</h3><p data-i18n="feat_payments_sub">Visa, Mastercard, Amex & Crypto.</p></div>
      </div>
    </div>
  </section>



  <!-- (분리해둔) MY PAGE 섹션: 필요 시 index에서 보일 때만 사용하고, 기본은 숨김 -->
  <section id="mypage" class="sw-section" style="display:none">
    <div class="container">
      <h2>My Page · Favorites ⭐</h2>
      <div class="mypage-panels">
        <div class="fav-list card">
          <h3>My Favorites</h3>
          <div id="favList"></div>
        </div>
        <div class="fav-map card">
          <div id="favMap"></div>
        </div>
      </div>
    </div>
  </section>
<!-- === Featured Listings (지도 아래) === -->
<section id="featured" class="max-w-7xl mx-auto px-4 py-10">
  <div class="flex items-center justify-between mb-4">
    <h2 class="text-xl md:text-2xl font-bold">✨ 추천 숙소</h2>
    <a href="/results.html" class="text-sm text-emerald-300 hover:underline">모두 보기</a>
  </div>

  <!-- 로딩 스켈레톤 -->
  <div id="recosSkeleton" class="grid gap-4 sm:grid-cols-2 lg:grid-cols-3">
    <!-- 6개 스켈레톤 카드 -->
    ${Array.from({length:6}).map(()=>`
      <div class="rounded-2xl overflow-hidden border border-white/10 bg-white/5">
        <div class="w-full h-40 bg-white/10 animate-pulse"></div>
        <div class="p-4 space-y-2">
          <div class="h-4 w-3/5 bg-white/10 animate-pulse rounded"></div>
          <div class="h-3 w-2/5 bg-white/10 animate-pulse rounded"></div>
          <div class="h-8 w-24 bg-white/10 animate-pulse rounded"></div>
        </div>
      </div>
    `).join('')}
  </div>

  <!-- 실제 카드가 들어갈 자리 -->
  <div id="recosGrid" class="grid gap-4 sm:grid-cols-2 lg:grid-cols-3 hidden"></div>
</section>

<!-- 간단 프로모션 배너 (선택) -->
<section class="bg-gradient-to-r from-amber-400 to-yellow-300 text-black">
  <div class="max-w-7xl mx-auto px-4 py-8 text-center">
    <h3 class="text-2xl font-extrabold">🎉 신규 회원 첫 예약 10% 할인</h3>
    <p class="mt-1">멤버십 가입하면 포인트 적립 + 독점 혜택</p>
    <a href="/membership.html" class="inline-block mt-4 px-5 py-2 rounded-xl bg-black text-white">지금 가입하기</a>
  </div>
</section>

  <!-- ====== SCRIPT: I18N + 드로어/지도/챗봇 ====== -->
  <script>
  /* ------------------ I18N 사전 ------------------ */
  const I18N = {
    EN:{nav_home:"Home",nav_membership:"Membership",nav_login:"Login",nav_logout:"Logout",nav_signup:"Sign Up",language:"Language",
      nav_host:"Host",host_login:"Host Login",host_signup:"Host Sign Up",host_register_property:"Register Property",host_my_listings:"My Listings",host_logout:"Logout",
      hero_luxury:"Luxury stays.",hero_reach:"Global reach.",hero_sub:"Cards, bank transfer & crypto (BTC · ETH · USDT).",
      placeholder_city:"Paris, Tokyo, Istanbul…",filters:"Filters",search:"Search",
      feat_verified:"Verified stays",feat_verified_sub:"Top picks near you.",
      feat_rewards:"StayWorld+ Rewards",feat_rewards_sub:"Earn points on every booking.",
      feat_payments:"Secure payments",feat_payments_sub:"Visa, Mastercard, Amex & Crypto.",
      f_title:"Filters", f_reset:"Reset", f_apply:"Apply", f_currency:"Currency", f_price:"Price per night",
      f_staytype:"Stay type", f_review:"Review score", f_beds:"Beds & Baths", f_pets:"Pets", f_checkin:"Check-in",
      f_amen:"Amenities", f_booking:"Booking", f_verify:"Verification", f_long:"Long-stay", f_biz:"Business",
      f_loc:"Location", f_access:"Accessibility", f_ex:"Experiences", f_view:"View", f_safe:"Safety",
      f_family:"Family", f_ent:"Entertainment", f_out:"Outdoor", f_park:"Parking",
      footer_copy:"© StayWorld — stayworldbooking.com",
      w:{
        "Wi-Fi":"Wi-Fi","Pool":"Pool","Spa":"Spa","Gym":"Gym","Kitchen":"Kitchen","Balcony":"Balcony","Hot tub":"Hot tub","Sauna":"Sauna","Air conditioning":"Air conditioning","Breakfast":"Breakfast",
        "Hotel":"Hotel","Motel":"Motel","Hostel":"Hostel","Apartment":"Apartment","Villa":"Villa","Ryokan":"Ryokan","Guesthouse":"Guesthouse","B&B":"B&B",
        "Sea view":"Sea view","City view":"City view","Mountain view":"Mountain view","Garden":"Garden",
        "Crypto":"Crypto","Cards":"Cards","Bank transfer":"Bank transfer","Free cancellation":"Free cancellation","Late checkout":"Late checkout","Non-smoking":"Non-smoking",
        "Accessible":"Accessible","Step-free access":"Step-free access","Elevator":"Elevator","Family-friendly":"Family-friendly","24h check-in":"24h check-in","Airport shuttle":"Airport shuttle",
        "Allowed":"Allowed","Self check-in":"Self check-in",
        "Near airport":"Near airport","Near station":"Near station","Near beach":"Near beach","City center":"City center",
        "Workspace":"Workspace","Washer":"Washer","Dryer":"Dryer","Instant book":"Instant book","Request to book":"Request to book",
        "Verified listings only":"Verified listings only","Verified reviews":"Verified reviews","Show long-stay deals":"Show long-stay deals","B2B-ready":"B2B-ready","Invoice available":"Invoice available",
        "Wide doorway":"Wide doorway","Accessible bathroom":"Accessible bathroom","Nature":"Nature","Camping":"Camping","Traditional":"Traditional",
        "Ski-in/out":"Ski-in/out","Wine country":"Wine country","TV":"TV","Netflix":"Netflix","Game console":"Game console",
        "BBQ grill":"BBQ grill","Patio":"Patio","Private garden":"Private garden","On-site":"On-site","Street":"Street","Paid garage":"Paid garage",
        "Parking":"Parking",
        "4.5+":"4.5+","4.0+":"4.0+","Any":"Any","beds":"beds","baths":"baths"
      }},
    KO:{nav_home:"홈",nav_membership:"멤버십",nav_login:"로그인",nav_logout:"로그아웃",nav_signup:"가입하기",language:"언어",
      nav_host:"호스트",host_login:"호스트 로그인",host_signup:"호스트 가입",host_register_property:"숙소 등록",host_my_listings:"호스트 등록목록",host_logout:"로그아웃",
      hero_luxury:"럭셔리 스테이.",hero_reach:"글로벌 리치.",hero_sub:"카드, 계좌이체 & 크립토 (BTC · ETH · USDT).",
      placeholder_city:"파리, 도쿄, 이스탄불…",filters:"필터",search:"검색",
      feat_verified:"검증된 스테이",feat_verified_sub:"가까운 추천 숙소.",feat_rewards:"StayWorld+ 리워드",feat_rewards_sub:"예약마다 포인트 적립.",
      feat_payments:"안전한 결제",feat_payments_sub:"VISA, 마스터, 아멕스 & 크립토.",
      f_title:"필터", f_reset:"초기화", f_apply:"적용", f_currency:"통화", f_price:"1박 가격",
      f_staytype:"숙소 유형", f_review:"후기 점수", f_beds:"침대&욕실", f_pets:"반려동물", f_checkin:"체크인",
      f_amen:"편의시설", f_booking:"예약 방식", f_verify:"검증", f_long:"장기 숙박", f_biz:"비즈니스",
      f_loc:"위치", f_access:"접근성", f_ex:"체험", f_view:"전망", f_safe:"안전",
      f_family:"가족", f_ent:"엔터테인먼트", f_out:"야외", f_park:"주차",
      footer_copy:"© 스테이월드 — stayworldbooking.com",
      w:{
        "Wi-Fi":"와이파이","Pool":"수영장","Spa":"스파","Gym":"헬스장","Kitchen":"주방","Balcony":"발코니","Hot tub":"온수 욕조","Sauna":"사우나","Air conditioning":"에어컨","Breakfast":"조식",
        "Hotel":"호텔","Motel":"모텔","Hostel":"호스텔","Apartment":"아파트","Villa":"빌라","Ryokan":"료칸","Guesthouse":"게스트하우스","B&B":"B&B",
        "Sea view":"바다 전망","City view":"도시 전망","Mountain view":"산 전망","Garden":"정원",
        "Crypto":"암호화폐","Cards":"카드","Bank transfer":"계좌이체","Free cancellation":"무료 취소","Late checkout":"레이트 체크아웃","Non-smoking":"금연",
        "Accessible":"접근성","Step-free access":"무계단 출입","Elevator":"엘리베이터","Family-friendly":"가족 친화","24h check-in":"24시간 체크인","Airport shuttle":"공항 셔틀",
        "Allowed":"허용","Self check-in":"셀프 체크인",
        "Near airport":"공항 인근","Near station":"역 인근","Near beach":"해변 인근","City center":"도심",
        "Workspace":"업무 공간","Washer":"세탁기","Dryer":"건조기","Instant book":"즉시 예약","Request to book":"요청 예약",
        "Verified listings only":"검증된 매물만","Verified reviews":"검증된 리뷰","Show long-stay deals":"장기 특가 보기","B2B-ready":"B2B 대응","Invoice available":"세금계산서 가능",
        "Wide doorway":"넓은 출입구","Accessible bathroom":"장애인 화장실","Nature":"자연","Camping":"캠핑","Traditional":"전통",
        "Ski-in/out":"스키 인/아웃","Wine country":"와인 산지","TV":"TV","Netflix":"넷플릭스","Game console":"게임 콘솔",
        "BBQ grill":"바비큐 그릴","Patio":"파티오","Private garden":"개인 정원","On-site":"부지 내","Street":"노상","Paid garage":"유료 차고",
        "Parking":"주차",
        "4.5+":"4.5+","4.0+":"4.0+","Any":"무관","beds":"침대","baths":"욕실"
      }},
    JA:{nav_home:"Home",nav_membership:"Membership",nav_login:"Login",nav_logout:"ログアウト",nav_signup:"Sign Up",language:"Language",
      nav_host:"ホスト",host_login:"ホストログイン",host_signup:"ホスト登録",host_register_property:"物件を登録",host_my_listings:"マイリスティング",host_logout:"ログアウト",
      hero_luxury:"贅沢な滞在。",hero_reach:"グローバルに。",hero_sub:"カード、銀行振込、暗号資産（BTC・ETH・USDT）。",
      placeholder_city:"パリ、東京、イスタンブール…",filters:"フィルター",search:"検索",
      feat_verified:"検証済みの宿",feat_verified_sub:"近くのおすすめ。",feat_rewards:"StayWorld+ リワード",feat_rewards_sub:"予約毎にポイント。",
      feat_payments:"安全な支払い",feat_payments_sub:"VISA, Master, Amex & Crypto。",
      f_title:"フィルター", f_reset:"リセット", f_apply:"適用", f_currency:"通貨", f_price:"1泊の価格",
      f_staytype:"宿タイプ", f_review:"レビュー評価", f_beds:"ベッド&バス", f_pets:"ペット", f_checkin:"チェックイン",
      f_amen:"アメニティ", f_booking:"予約方法", f_verify:"認証", f_long:"長期滞在", f_biz:"ビジネス",
      f_loc:"場所", f_access:"アクセシビリティ", f_ex:"体験", f_view:"眺望", f_safe:"安全",
      f_family:"家族向け", f_ent:"エンタメ", f_out:"屋外", f_park:"駐車",
      footer_copy:"© StayWorld — stayworldbooking.com",
      w:{"Parking":"駐車場"}
    },
    ZH:{nav_home:"首页",nav_membership:"会员",nav_login:"登录",nav_logout:"退出登录",nav_signup:"注册",language:"语言",
      nav_host:"房东",host_login:"房东登录",host_signup:"房东注册",host_register_property:"登记房源",host_my_listings:"我的房源",host_logout:"退出登录",
      hero_luxury:"奢华住宿。",hero_reach:"全球覆盖。",hero_sub:"银行卡、转账与加密货币（BTC · ETH · USDT）。",
      placeholder_city:"巴黎、东京、伊斯坦布尔…",filters:"筛选",search:"搜索",
      feat_verified:"已验证住宿",feat_verified_sub:"附近精选。",feat_rewards:"StayWorld+ 奖励",feat_rewards_sub:"每次预订赚积分。",
      feat_payments:"安全支付",feat_payments_sub:"Visa、Mastercard、Amex 与加密货币。",
      f_title:"筛选", f_reset:"重置", f_apply:"应用", f_currency:"货币", f_price:"每晚价格",
      f_staytype:"房源类型", f_review:"评分", f_beds:"床&浴室", f_pets:"宠物", f_checkin:"入住",
      f_amen:"设施", f_booking:"预订方式", f_verify:"认证", f_long:"长住", f_biz:"商务",
      f_loc:"位置", f_access:"无障碍", f_ex:"体验", f_view:"景观", f_safe:"安全",
      f_family:"亲子", f_ent:"娱乐", f_out:"户外", f_park:"停车",
      footer_copy:"© StayWorld — stayworldbooking.com",
      w:{"Parking":"停车"}
    },
    FR:{nav_home:"Accueil",nav_membership:"Adhésion",nav_login:"Connexion",nav_logout:"Déconnexion",nav_signup:"S’inscrire",language:"Langue",
      nav_host:"Hôte",host_login:"Connexion hôte",host_signup:"Inscription hôte",host_register_property:"Enregistrer un logement",host_my_listings:"Mes annonces",host_logout:"Déconnexion",
      hero_luxury:"Séjours de luxe.",hero_reach:"Portée mondiale.",hero_sub:"Carte, virement & crypto (BTC · ETH · USDT).",
      placeholder_city:"Paris, Tokyo, Istanbul…",filters:"Filtres",search:"Rechercher",
      feat_verified:"Logements vérifiés",feat_verified_sub:"Meilleurs choix près de chez vous.",
      feat_rewards:"Récompenses StayWorld+",feat_rewards_sub:"Des points à chaque réservation.",
      feat_payments:"Paiements sécurisés",feat_payments_sub:"Visa, Mastercard, Amex & Crypto.",
      f_title:"Filtres", f_reset:"Réinitialiser", f_apply:"Appliquer", f_currency:"Devise", f_price:"Prix par nuit",
      f_staytype:"Type d’hébergement", f_review:"Note", f_beds:"Lits & Salles de bain", f_pets:"Animaux", f_checkin:"Arrivée",
      f_amen:"Équipements", f_booking:"Réservation", f_verify:"Vérification", f_long:"Long séjour", f_biz:"Affaires",
      f_loc:"Emplacement", f_access:"Accessibilité", f_ex:"Expériences", f_view:"Vue", f_safe:"Sécurité",
      f_family:"Famille", f_ent:"Divertissement", f_out:"Extérieur", f_park:"Parking",
      footer_copy:"© StayWorld — stayworldbooking.com",
      w:{"Parking":"Parking"}
    },
    ES:{nav_home:"Inicio",nav_membership:"Membresía",nav_login:"Ingresar",nav_logout:"Cerrar sesión",nav_signup:"Regístrate",language:"Idioma",
      nav_host:"Anfitrión",host_login:"Inicio de sesión de anfitrión",host_signup:"Registro de anfitrión",host_register_property:"Registrar propiedad",host_my_listings:"Mis anuncios",host_logout:"Cerrar sesión",
      hero_luxury:"Estancias de lujo.",hero_reach:"Alcance global.",hero_sub:"Tarjetas, transferencia bancaria y cripto (BTC · ETH · USDT).",
      placeholder_city:"París, Tokio, Estambul…",filters:"Filtros",search:"Buscar",
      feat_verified:"Alojamientos verificados",feat_verified_sub:"Mejores opciones cerca de ti.",
      feat_rewards:"Recompensas StayWorld+",feat_rewards_sub:"Puntos en cada reserva.",
      feat_payments:"Pagos seguros",feat_payments_sub:"Visa, Mastercard, Amex y Cripto.",
      f_title:"Filtros", f_reset:"Limpiar", f_apply:"Aplicar", f_currency:"Moneda", f_price:"Precio por noche",
      f_staytype:"Tipo de alojamiento", f_review:"Puntuación", f_beds:"Camas y baños", f_pets:"Mascotas", f_checkin:"Check-in",
      f_amen:"Servicios", f_booking:"Reserva", f_verify:"Verificación", f_long:"Larga estancia", f_biz:"Negocios",
      f_loc:"Ubicación", f_access:"Accesibilidad", f_ex:"Experiencias", f_view:"Vista", f_safe:"Seguridad",
      f_family:"Familia", f_ent:"Entretenimiento", f_out:"Exterior", f_park:"Aparcamiento",
      footer_copy:"© StayWorld — stayworldbooking.com",
      w:{"Parking":"Aparcamiento"}
    },
    DE:{nav_home:"Start",nav_membership:"Mitgliedschaft",nav_login:"Login",nav_logout:"Abmelden",nav_signup:"Registrieren",language:"Sprache",
      nav_host:"Gastgeber",host_login:"Gastgeber-Login",host_signup:"Gastgeber-Registrierung",host_register_property:"Unterkunft registrieren",host_my_listings:"Meine Inserate",host_logout:"Abmelden",
      hero_luxury:"Luxuriöse Aufenthalte.",hero_reach:"Globale Reichweite.",hero_sub:"Karten, Überweisung & Krypto (BTC · ETH · USDT).",
      placeholder_city:"Paris, Tokio, Istanbul…",filters:"Filter",search:"Suchen",
      feat_verified:"Verifizierte Unterkünfte",feat_verified_sub:"Top-Auswahl in deiner Nähe.",
      feat_rewards:"StayWorld+ Prämien",feat_rewards_sub:"Punkte bei jeder Buchung.",
      feat_payments:"Sichere Zahlungen",feat_payments_sub:"Visa, Mastercard, Amex & Krypto.",
      f_title:"Filter", f_reset:"Zurücksetzen", f_apply:"Anwenden", f_currency:"Währung", f_price:"Preis pro Nacht",
      f_staytype:"Unterkunftstyp", f_review:"Bewertung", f_beds:"Betten & Bäder", f_pets:"Haustiere", f_checkin:"Check-in",
      f_amen:"Ausstattung", f_booking:"Buchung", f_verify:"Verifizierung", f_long:"Langzeit", f_biz:"Geschäft",
      f_loc:"Lage", f_access:"Barrierefreiheit", f_ex:"Erlebnisse", f_view:"Aussicht", f_safe:"Sicherheit",
      f_family:"Familie", f_ent:"Entertainment", f_out:"Außenbereich", f_park:"Parken",
      footer_copy:"© StayWorld — stayworldbooking.com",
      w:{"Parking":"Parken"}
    },
    TR:{nav_home:"Ana Sayfa",nav_membership:"Üyelik",nav_login:"Giriş",nav_logout:"Çıkış",nav_signup:"Kaydol",language:"Dil",
      nav_host:"Ev Sahibi",host_login:"Ev Sahibi Girişi",host_signup:"Ev Sahibi Kaydı",host_register_property:"İlan Oluştur",host_my_listings:"İlanlarım",host_logout:"Çıkış",
      hero_luxury:"Lüks konaklamalar.",hero_reach:"Küresel erişim.",hero_sub:"Kart, havale ve kripto (BTC · ETH · USDT).",
      placeholder_city:"Paris, Tokyo, İstanbul…",filters:"Filtreler",search:"Ara",
      feat_verified:"Doğrulanmış konaklamalar",feat_rewards_sub:"Her rezervasyonda puan kazanın.",
      feat_rewards:"StayWorld+ Ödülleri",
      feat_payments:"Güvenli ödemeler",feat_payments_sub:"Visa, Mastercard, Amex & Kripto.",
      f_title:"Filtreler", f_reset:"Sıfırla", f_apply:"Uygula", f_currency:"Para birimi", f_price:"Gecelik fiyat",
      f_staytype:"Konaklama türü", f_review:"Puan", f_beds:"Yatak & Banyo", f_pets:"Evcil", f_checkin:"Giriş",
      f_amen:"Olanaklar", f_booking:"Rezervasyon", f_verify:"Doğrulama", f_long:"Uzun konaklama", f_biz:"İş",
      f_loc:"Konum", f_access:"Erişilebilirlik", f_ex:"Deneyimler", f_view:"Manzara", f_safe:"Güvenlik",
      f_family:"Aile", f_ent:"Eğlence", f_out:"Açık alan", f_park:"Otopark",
      footer_copy:"© StayWorld — stayworldbooking.com",
      w:{"Parking":"Otopark"}
    },
    AR:{nav_home:"الرئيسية",nav_membership:"العضوية",nav_login:"تسجيل الدخول",nav_logout:"تسجيل الخروج",nav_signup:"إنشاء حساب",language:"اللغة",
      nav_host:"المضيف",host_login:"تسجيل دخول المضيف",host_signup:"تسجيل المضيف",host_register_property:"تسجيل عقار",host_my_listings:"قوائمي",host_logout:"تسجيل الخروج",
      hero_luxury:"إقامات فاخرة.",hero_reach:"انتشار عالمي.",hero_sub:"بطاقات، تحويل بنكي وعملات مشفرة (BTC · ETH · USDT).",
      placeholder_city:"باريس، طوكيو، إسطنبول…",filters:"الفلاتر",search:"بحث",
      feat_verified:"إقامات موثوقة",feat_verified_sub:"أفضل الخيارات بالقرب منك.",
      feat_rewards:"مكافآت StayWorld+",feat_rewards_sub:"نقاط مع كل حجز.",
      feat_payments:"مدفوعات آمنة",feat_payments_sub:"Visa وMastercard وAmex والعملات المشفرة.",
      f_title:"الفلاتر", f_reset:"إعادة ضبط", f_apply:"تطبيق", f_currency:"العملة", f_price:"السعر لليلة",
      f_staytype:"نوع الإقامة", f_review:"التقييم", f_beds:"الأسرة والحمامات", f_pets:"الحيوانات الأليفة", f_checkin:"تسجيل الوصول",
      f_amen:"المرافق", f_booking:"الحجز", f_verify:"التحقق", f_long:"إقامة طويلة", f_biz:"أعمال",
      f_loc:"الموقع", f_access:"إمكانية الوصول", f_ex:"الخبرات", f_view:"الإطلالة", f_safe:"السلامة",
      f_family:"العائلة", f_ent:"الترفيه", f_out:"خارجي", f_park:"موقف سيارات",
      footer_copy:"© ستاي ورلد — stayworldbooking.com",
      w:{"Parking":"موقف سيارات"}
    },
    RU:{nav_home:"Главная",nav_membership:"Подписка",nav_login:"Войти",nav_logout:"Выйти",nav_signup:"Регистрация",language:"Язык",
      nav_host:"Хост",host_login:"Вход хоста",host_signup:"Регистрация хоста",host_register_property:"Добавить объект",host_my_listings:"Мои объявления",host_logout:"Выйти",
      hero_luxury:"Роскошное проживание.",hero_reach:"Глобальный охват.",hero_sub:"Карты, перевод и крипто (BTC · ETH · USDT).",
      placeholder_city:"Париж, Токио, Стамбул…",filters:"Фильтры",search:"Поиск",
      feat_verified:"Проверенные варианты",feat_verified_sub:"Лучшие места рядом с вами.",
      feat_rewards:"Бонусы StayWorld+",feat_rewards_sub:"Баллы за каждое бронирование.",
      feat_payments:"Безопасные платежи",feat_payments_sub:"Visa, Mastercard, Amex и крипто.",
      f_title:"Фильтры", f_reset:"Сбросить", f_apply:"Применить", f_currency:"Валюта", f_price:"Цена за ночь",
      f_staytype:"Тип жилья", f_review:"Оценка", f_beds:"Кровати и ванные", f_pets:"Питомцы", f_checkin:"Заезд",
      f_amen:"Удобства", f_booking:"Бронирование", f_verify:"Проверка", f_long:"Длительное проживание", f_biz:"Бизнес",
      f_loc:"Расположение", f_access:"Доступность", f_ex:"Впечатления", f_view:"Вид", f_safe:"Безопасность",
      f_family:"Семья", f_ent:"Развлечения", f_out:"На улице", f_park:"Парковка",
      footer_copy:"© StayWorld — stayworldbooking.com",
      w:{"Parking":"Парковка"}
    }
  };

  function tkey(k){const lang=(document.getElementById('lang')?.value||localStorage.getItem('sw_lang')||'EN');return (I18N[lang]||I18N.EN)[k]||I18N.EN[k]||k;}
  function wkey(word){const lang=(document.getElementById('lang')?.value||localStorage.getItem('sw_lang')||'EN');const dict=(I18N[lang]||I18N.EN).w||{};return dict[word]||word;}

  function applyI18NPage(){
    const lang=(document.getElementById('lang')?.value||'EN');
    const dict=I18N[lang]||I18N.EN;
    document.querySelectorAll('[data-i18n]').forEach(el=>{const k=el.getAttribute('data-i18n'); if(dict[k]) el.textContent=dict[k];});
    document.querySelectorAll('[data-i18n-placeholder]').forEach(el=>{const k=el.getAttribute('data-i18n-placeholder'); if(dict[k]) el.setAttribute('placeholder', dict[k]);});
    if(typeof localizeDrawer==='function'){try{localizeDrawer();}catch(_){}} 
    document.querySelectorAll('[data-i18n],[data-i18n-placeholder]').forEach(el=>{
      const k=el.getAttribute('data-i18n')||el.getAttribute('data-i18n-placeholder');
      if(!(k in dict) && !(k in (I18N.EN||{}))) console.warn('[i18n] Missing key:',k);
    });
  }

  document.addEventListener('DOMContentLoaded', ()=>{
    const sel=document.getElementById('lang');
    const saved=localStorage.getItem('sw_lang');
    if(sel && saved && [...sel.options].some(o=>o.value===saved)) sel.value=saved;
    applyI18NPage();
    sel?.addEventListener('change', e=>{ localStorage.setItem('sw_lang', e.target.value); applyI18NPage(); setCurrencyByLang(e.target.value); });
  });

  /* ------------------ 통화 & 가격 ------------------ */
  const CURRENCIES = {
    USD:{symbol:'$',rate:1,locale:'en-US',name:'USD'},
    EUR:{symbol:'€',rate:0.92,locale:'fr-FR',name:'EUR'},
    KRW:{symbol:'₩',rate:1300,locale:'ko-KR',name:'KRW'},
    JPY:{symbol:'¥',rate:155,locale:'ja-JP',name:'JPY'},
    CNY:{symbol:'¥',rate:7.2,locale:'zh-CN',name:'CNY'},
    TRY:{symbol:'₺',rate:33,locale:'tr-TR',name:'TRY'},
    RUB:{symbol:'₽',rate:90,locale:'ru-RU',name:'RUB'},
    GBP:{symbol:'£',rate:0.78,locale:'en-GB',name:'GBP'},
    AED:{symbol:'د.إ',rate:3.67,locale:'ar-AE',name:'AED'},
    CAD:{symbol:'$',rate:1.36,locale:'en-CA',name:'CAD'}
  };
  const LANG_TO_CUR = { EN:'USD', KO:'KRW', JA:'JPY', ZH:'CNY', FR:'EUR', ES:'EUR', DE:'EUR', TR:'TRY', AR:'AED', RU:'RUB' };
  function setCurrencyByLang(lang){
    const curSel=document.getElementById('currencySelect');
    if(!curSel) return;
    const code = LANG_TO_CUR[lang] || 'USD';
    curSel.value = code; updatePriceLabels();
  }
  function fmtMoney(usd){
    const curSel=document.getElementById('currencySelect'); if(!curSel) return '$'+usd.toFixed(0);
    const cur=CURRENCIES[curSel.value]||CURRENCIES.USD;
    const val=usd*cur.rate;
    return new Intl.NumberFormat(cur.locale,{style:'currency',currency:cur.name,maximumFractionDigits:(cur.name==='JPY'||cur.name==='KRW')?0:0}).format(val);
  }

  /* ------------------ 오버레이 가드 ------------------ */
  const mutedOverlays=new Set();
  function muteFullscreenOverlays(){
    document.querySelectorAll('body *').forEach(el=>{
      try{
        const cs=getComputedStyle(el); if(cs.position!=='fixed')return;
        const r=el.getBoundingClientRect();
        if(r.width>=innerWidth*0.96 && r.height>=innerHeight*0.96){
          if(el.id==='filterDrawer'||el.id==='botPanel') return;
          if(!mutedOverlays.has(el)){ el.dataset.swPe=cs.pointerEvents; el.style.pointerEvents='none'; mutedOverlays.add(el); }
        }
      }catch(_){}
    });
  }
  function restoreOverlays(){ mutedOverlays.forEach(el=>{ if(el.dataset.swPe!=null){el.style.pointerEvents=el.dataset.swPe; delete el.dataset.swPe;} }); mutedOverlays.clear(); }

  /* ------------------ 필터 드로어 + 렌더 ------------------ */
  const GROUPS=[
    {t:'f_price', kind:'price'},
    {t:'f_staytype', checks:['Hotel','Motel','Hostel','Apartment','Villa','Ryokan','Guesthouse','B&B']},
    {t:'f_review', radios:['4.5+','4.0+','Any']},
    {t:'f_beds', inputs:[['number','beds',{min:1,value:1}],['number','baths',{min:1,value:1}]]},
    {t:'f_pets', checks:['Allowed']},
    {t:'f_checkin', checks:['Self check-in']},
    {t:'f_amen', checks:['Wi-Fi','Kitchen','Parking','Pool','Air conditioning','Gym','Workspace','Washer','Dryer','Breakfast']},
    {t:'f_booking', checks:['Instant book','Request to book']},
    {t:'f_verify', checks:['Verified listings only','Verified reviews']},
    {t:'f_long', checks:['Show long-stay deals']},
    {t:'f_biz', checks:['B2B-ready','Invoice available']},
    {t:'f_loc', checks:['Near airport','Near station','Near beach','City center']},
    {t:'f_access', checks:['Step-free access','Elevator','Wide doorway','Accessible bathroom']},
    {t:'f_ex', checks:['Nature','Camping','Traditional','Ski-in/out','Wine country']},
    {t:'f_view', checks:['Sea view','City view','Mountain view','Garden']},
    {t:'f_safe', checks:['Carbon monoxide alarm','Smoke alarm','First aid kit']},
    {t:'f_family', checks:['Crib','High chair','Stroller friendly']},
    {t:'f_ent', checks:['TV','Netflix','Game console']},
    {t:'f_out', checks:['BBQ grill','Patio','Private garden']},
    {t:'f_park', checks:['On-site','Street','Paid garage']},
  ];
  function ensureDrawer(){
    let d=document.getElementById('filterDrawer');
    if(!d){
      d=document.createElement('div'); d.id='filterDrawer'; d.setAttribute('aria-hidden','true');
      d.innerHTML=`
        <div class="back"></div>
        <div class="panel">
          <div class="head">
            <strong id="fTitle">${tkey('f_title')}</strong>
            <div style="display:flex;gap:8px;align-items:center">
              <label for="currencySelect" id="curLabel" style="font-size:12px;opacity:.8">${tkey('f_currency')}</label>
              <select id="currencySelect" class="lang-select" style="padding:6px 10px">
                ${Object.keys(CURRENCIES).map(k=>`<option value="${k}">${k}</option>`).join('')}
              </select>
              <button id="swClose" class="btn btn-ghost">✕</button>
            </div>
          </div>
          <div id="filterGrid"></div>
          <div class="foot">
            <button id="swReset" class="btn btn-ghost" style="border:1px solid rgba(255,255,255,.14)">${tkey('f_reset')}</button>
            <button id="swApply" class="btn btn-gold">${tkey('f_apply')}</button>
          </div>
        </div>`;
      document.body.appendChild(d);

      const grid=d.querySelector('#filterGrid');
      GROUPS.forEach((g,gi)=>{
        const box=document.createElement('div'); box.className='box';
        box.innerHTML=`<h4 data-title="${g.t}">${tkey(g.t)}</h4>`;
        if(g.kind==='price'){
          const html=`
            <div style="display:grid;gap:10px">
              <div style="display:flex;justify-content:space-between;font-size:13px">
                <span>${tkey('f_price')}</span>
                <span><span id="priceMinVal">–</span> ~ <span id="priceMaxVal">–</span></span>
              </div>
              <label style="font-size:12px;opacity:.8">Min</label>
              <input type="range" id="priceMin" min="0" max="1000" step="10" value="100">
              <label style="font-size:12px;opacity:.8">Max</label>
              <input type="range" id="priceMax" min="0" max="5000" step="50" value="800">
            </div>`;
          const wrap=document.createElement('div'); wrap.innerHTML=html; box.appendChild(wrap);
        }
        (g.inputs||[]).forEach(([type,id,attrs])=>{
          const wrap=document.createElement('div'); wrap.style.margin='6px 0';
          wrap.innerHTML=`<label style="font-size:12px">${wkey(id)}</label><input type="${type}" id="${id}" style="width:100%">`;
          Object.entries(attrs||{}).forEach(([k,v])=>wrap.querySelector('input').setAttribute(k,v));
          box.appendChild(wrap);
        });
        (g.radios||[]).forEach((name,ri)=>{
          const id=`rg_${gi}_${ri}`;
          const lab=document.createElement('label'); lab.style.cssText='display:inline-flex;align-items:center;gap:6px;margin:6px 10px 0 0';
          lab.innerHTML=`<input type="radio" name="rg_${gi}" id="${id}" ${/Any/i.test(name)?'checked':''}> <span data-word="${name}">${wkey(name)}</span>`;
          box.appendChild(lab);
        });
        (g.checks||[]).forEach((name,ci)=>{
          const id=`ck_${gi}_${ci}`;
          const lab=document.createElement('label'); lab.style.cssText='display:inline-flex;align-items:center;gap:6px;margin:6px 10px 0 0';
          lab.innerHTML=`<input type="checkbox" id="${id}"> <span data-word="${name}">${wkey(name)}</span>`;
          box.appendChild(lab);
        });
        grid.appendChild(box);
      });

      const back=d.querySelector('.back');
      const close=()=>{d.setAttribute('aria-hidden','true'); restoreOverlays();};
      back.addEventListener('click',close);
      d.querySelector('#swClose').addEventListener('click',close);
      d.querySelector('.panel').addEventListener('click',e=>e.stopPropagation());

      d.querySelector('#swReset').addEventListener('click',()=>{
        d.querySelectorAll('input[type=checkbox]').forEach(i=>i.checked=false);
        d.querySelectorAll('input[type=radio]').forEach(i=>i.checked=/Any/i.test(i.nextSibling?.textContent||'Any'));
        document.getElementById('priceMin').value=100;
        document.getElementById('priceMax').value=800;
        updatePriceLabels();
        setBadge('');
      });
      d.querySelector('#swApply').addEventListener('click',()=>{
        const n=d.querySelectorAll('input[type=checkbox]:checked, input[type=radio]:checked').length;
        setBadge(n?n.toString():''); close();
      });
      document.getElementById('currencySelect').addEventListener('change', updatePriceLabels);
      ['priceMin','priceMax'].forEach(id=>{
        d.querySelector('#'+id).addEventListener('input',()=>{
          const min=+d.querySelector('#priceMin').value;
          const max=+d.querySelector('#priceMax').value;
          if(min>max){ d.querySelector('#priceMin').value=max; }
          updatePriceLabels();
        });
      });

      setCurrencyByLang(document.getElementById('lang').value || 'EN');
      updatePriceLabels();
    }
    return d;
  }
  function updatePriceLabels(){
    const d=document.getElementById('filterDrawer'); if(!d) return;
    const min=+d.querySelector('#priceMin').value||0;
    const max=+d.querySelector('#priceMax').value||0;
    const minEl=d.querySelector('#priceMinVal'); const maxEl=d.querySelector('#priceMaxVal');
    if(minEl) minEl.textContent = fmtMoney(min);
    if(maxEl) maxEl.textContent = fmtMoney(max);
  }
  function localizeDrawer(){
    const d=document.getElementById('filterDrawer'); if(!d) return;
    d.querySelector('#fTitle').textContent=tkey('f_title');
    d.querySelector('#curLabel').textContent=tkey('f_currency');
    d.querySelector('#swReset').textContent=tkey('f_reset');
    d.querySelector('#swApply').textContent=tkey('f_apply');
    d.querySelectorAll('[data-title]').forEach(el=>{ el.textContent=tkey(el.getAttribute('data-title')); });
    d.querySelectorAll('[data-word]').forEach(el=>{ el.textContent=wkey(el.getAttribute('data-word')); });
    const priceBox = Array.from(d.querySelectorAll('h4')).find(h=>h.getAttribute('data-title')==='f_price');
    if(priceBox) priceBox.textContent = tkey('f_price');
    updatePriceLabels();
  }

  // ✅ 메인 Filters 버튼: hotels.html#filters 로 이동 (인덱스에선 드로어 대신 이동)
  document.getElementById('btnFilters')?.addEventListener('click',(e)=>{
    e.preventDefault();
    location.href = '/hotels.html#filters';
  },{capture:true});

  /* ------------------ 챗봇 ------------------ */
  function ensureChat(){
    let fab=document.getElementById('chatFab');
    if(!fab){ fab=document.createElement('button'); fab.id='chatFab'; fab.textContent='💬'; document.body.appendChild(fab); }
    let panel=document.getElementById('botPanel');
    if(!panel){
      panel=document.createElement('div'); panel.id='botPanel';
      panel.innerHTML=`<div class="hdr"><strong>AI Concierge</strong><button id="botClose" class="btn btn-ghost">✕</button></div>
        <div id="botBody" class="body"><div class="msg ai">Hello! Ask in any language.</div></div>
        <div class="row"><input id="botInput" placeholder="Type a message…"><button id="botSend">Send</button></div>`;
      document.body.appendChild(panel);
    }
    const open=()=>{panel.style.display='block'; muteFullscreenOverlays();};
    const close=()=>{panel.style.display='none'; restoreOverlays();};
    fab.addEventListener('click',e=>{e.stopPropagation(); open();},{capture:true});
    panel.querySelector('#botClose').addEventListener('click',e=>{e.stopPropagation(); close();});
    document.addEventListener('click',e=>{
      if(panel.style.display!=='block')return;
      const r=panel.getBoundingClientRect(); const inside=e.clientX>=r.left&&e.clientX<=r.right&&e.clientY>=r.top&&e.clientY<=r.bottom;
      if(!inside) close();
    },{capture:true});

    const body=panel.querySelector('#botBody'), input=panel.querySelector('#botInput'), send=panel.querySelector('#botSend');
    const msgs=[];
    const add=(t,me)=>{const d=document.createElement('div'); d.className=`msg ${me?'me':'ai'}`; d.textContent=t; body.appendChild(d); body.scrollTop=body.scrollHeight;};
    async function askAI(message,lang){
      for(const ep of ['/api/chat','/.netlify/functions/sw-chat']){
        try{
          const r=await fetch(ep,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({messages:[...msgs,{role:'user',content:message}],lang})});
          if(r.ok){const d=await r.json(); if(d.reply) return d.reply;}
        }catch(_){}
      }
      return '(Backend not found. Check your function URL.)';
    }
    async function sendIt(){
      const v=(input.value||'').trim(); if(!v) return; input.value='';
      add(v,true); msgs.push({role:'user',content:v}); add('…',false); const dots=body.lastChild;
      try{ const reply=await askAI(v,(document.getElementById('lang').value||'EN').toLowerCase()); dots.remove(); add(reply,false); msgs.push({role:'assistant',content:reply}); }
      catch(_){ dots.remove(); add('Assistant is unavailable.',false); }
    }
    send.addEventListener('click',sendIt); input.addEventListener('keydown',e=>{if(e.key==='Enter') sendIt();});
  }
  ensureChat();

  /* ------------------ 지도 + 검색 ------------------ */
  let map, marker;
  function initMap(){
    map=L.map('map',{scrollWheelZoom:true}).setView([48.8566,2.3522],12); // Paris
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{attribution:'&copy; OpenStreetMap'}).addTo(map);
  }
  initMap();

  const statusEl=document.getElementById('searchStatus');
  function setStatus(msg){ statusEl.textContent=msg||''; statusEl.style.opacity=msg?1:0; if(msg){clearTimeout(statusEl._t); statusEl._t=setTimeout(()=>statusEl.style.opacity=0,3000);} }
  function setLoading(on){ const b=document.getElementById('btnSearch'); const lang=document.getElementById('lang').value; const w=(I18N[lang]||I18N.EN).search||'Search'; b.disabled=on; b.classList.toggle('loading',on); b.textContent=on?'…':w;}

  async function geocodeAny(q){
    const prov=[q=>`https://nominatim.openstreetmap.org/search?format=json&limit=1&q=${encodeURIComponent(q)}`,q=>`https://photon.komoot.io/api/?limit=1&q=${encodeURIComponent(q)}`];
    for(const make of prov){
      try{
        const r=await fetch(make(q),{headers:{'Accept':'application/json'}}); if(!r.ok) continue; const data=await r.json();
        if(Array.isArray(data)&&data[0]) return {lat:+data[0].lat,lon:+data[0].lon,label:data[0].display_name||q};
        if(data?.features?.[0]){const f=data.features[0];return {lat:f.geometry.coordinates[1],lon:f.geometry.coordinates[0],label:f.properties.name||f.properties.city||f.properties.country||q};}
      }catch(_){}
    }
    throw new Error('no_results');
  }
  function goTo(lat,lon,label){ if(marker) marker.remove(); marker=L.marker([lat,lon]).addTo(map).bindPopup(label||'').openPopup(); map.setView([lat,lon],13,{animate:true}); document.getElementById('map').scrollIntoView({behavior:'smooth',block:'start'}); }

  async function runSearch(){
    const q=(document.getElementById('searchDestination').value||'').trim(); if(!q){document.getElementById('searchDestination').focus(); return;}
    try{ setLoading(true); setStatus('Searching…'); const {lat,lon,label}=await geocodeAny(q); goTo(lat,lon,label); setStatus(`Found: ${label}`);}
    catch(_){ setStatus('No results. Try another place.'); alert('검색 결과가 없습니다. 다른 도시를 입력해보세요.'); }
    finally{ setLoading(false); }
  }
  document.getElementById('btnSearch').addEventListener('click',runSearch,{capture:true});
  ['searchDestination','checkIn','checkOut'].forEach(id=>{const el=document.getElementById(id); el&&el.addEventListener('keydown',e=>{if(e.key==='Enter') runSearch();});});
  </script>
<!-- Explore 섹션 추가 -->
<section class="sw-explore">
  ... (추천 숙소 / 도시 카드 코드) ...
</section>
<!-- /Explore 섹션 끝 -->
<!-- Explore 섹션 추가 -->
<section class="sw-explore">
  <div class="sw-wrap">
    <!-- 제목 -->
    <header class="sw-explore-head">
      <h2 data-i18n="explore.unique_title">한 번쯤 묵어보고 싶은 숙소</h2>
      <p data-i18n="explore.unique_sub">캐빈, 빌라, 샬레 등 특별한 숙소를 찾아보세요</p>
    </header>

    <!-- 유니크 스테이 (가로 스크롤 카드) -->
    <div class="sw-row">
      <button class="sw-nav prev" aria-label="prev">‹</button>
      <div class="sw-track" data-track="unique">
        <!-- 카드 1 -->
        <article class="sw-card">
          <div class="sw-card-media" style="background-image:url('/assets/unique/cabin.jpg')">
            <button class="sw-like" aria-label="favorite">♡</button>
            <span class="sw-badge">9.6</span>
          </div>
          <div class="sw-card-body">
            <h3>Forest Cabin</h3>
            <p class="sw-meta">폴란드, 자코파네 • <span data-i18n="explore.exceptional">평점 훌륭함</span></p>
          </div>
        </article>

        <!-- 카드 2 -->
        <article class="sw-card">
          <div class="sw-card-media" style="background-image:url('/assets/unique/chalet.jpg')">
            <button class="sw-like" aria-label="favorite">♡</button>
            <span class="sw-badge">9.5</span>
          </div>
          <div class="sw-card-body">
            <h3>Alpine Chalet</h3>
            <p class="sw-meta">독일, 트리어 • <span data-i18n="explore.exceptional">평점 훌륭함</span></p>
          </div>
        </article>

        <!-- 카드 3 -->
        <article class="sw-card">
          <div class="sw-card-media" style="background-image:url('/assets/unique/tinyhouse.jpg')">
            <button class="sw-like" aria-label="favorite">♡</button>
            <span class="sw-badge">9.4</span>
          </div>
          <div class="sw-card-body">
            <h3>Tiny House</h3>
            <p class="sw-meta">폴란드, 키스크보 • <span data-i18n="explore.exceptional">평점 훌륭함</span></p>
          </div>
        </article>
      </div>
      <button class="sw-nav next" aria-label="next">›</button>
    </div>

    <!-- 인기 목적지 -->
    <div class="sw-tabs">
      <button class="is-active" data-filter="city" data-i18n="explore.tab_city">도시</button>
      <button data-filter="beach" data-i18n="explore.tab_beach">바다</button>
      <button data-filter="outdoor" data-i18n="explore.tab_outdoor">자연</button>
      <button data-filter="romance" data-i18n="explore.tab_romance">로맨스</button>
      <button data-filter="food" data-i18n="explore.tab_food">맛집</button>
    </div>

    <div class="sw-grid" data-grid="destinations">
      <a class="sw-spot" data-type="city" style="background-image:url('/assets/dest/athens.jpg')">
        <span class="sw-spot-title">Athens 🇬🇷</span>
      </a>
      <a class="sw-spot" data-type="city" style="background-image:url('/assets/dest/dubai.jpg')">
        <span class="sw-spot-title">Dubai 🇦🇪</span>
      </a>
      <a class="sw-spot" data-type="city" style="background-image:url('/assets/dest/amsterdam.jpg')">
        <span class="sw-spot-title">Amsterdam 🇳🇱</span>
      </a>
      <a class="sw-spot" data-type="beach" style="background-image:url('/assets/dest/antalya.jpg')">
        <span class="sw-spot-title">Antalya 🏖️</span>
      </a>
      <a class="sw-spot" data-type="outdoor" style="background-image:url('/assets/dest/cappadocia.jpg')">
        <span class="sw-spot-title">Cappadocia ⛰️</span>
      </a>
    </div>
  </div>
</section>
<!-- /Explore 섹션 끝 -->

  <!-- FOOTER -->
<footer class="site-footer">
  <div class="container">
    <small data-i18n="footer_copy">© StayWorld - stayworldbooking.com</small>
  </div>
</footer>

  <!-- AUTH UI: 네비의 Login/Logout 전환 -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const link = document.getElementById("navAuthLink");
      if (!link) return;

      function toLoginUI() {
        link.setAttribute("data-i18n", "nav_login");
        link.textContent = "Login";
        link.href = "login.html";
        link.onclick = null;
        applyI18NPage?.();
      }

      function toLogoutUI() {
        link.setAttribute("data-i18n", "nav_logout");
        link.textContent = "Logout";
        link.href = "#";
        link.onclick = (e) => {
          e.preventDefault();
          localStorage.removeItem("sw_logged_in");
          alert("로그아웃 되었습니다.");
          toLoginUI();
          updateHostMenu();
          location.href = "/";
        };
        applyI18NPage?.();
      }

      window.markLoggedIn = function () {
        localStorage.setItem("sw_logged_in", "true");
        toLogoutUI();
        updateHostMenu();
      };
      window.markLoggedOut = function () {
        localStorage.removeItem("sw_logged_in");
        toLoginUI();
        updateHostMenu();
      };

      if (localStorage.getItem("sw_logged_in") === "true") toLogoutUI();
      else toLoginUI();

      function updateHostMenu(){
        const panel = document.querySelector('#hostMenu .dropdown-panel');
        if(!panel) return;
        const signedIn = localStorage.getItem('sw_logged_in') === 'true';
        panel.querySelectorAll('[data-host-visible]').forEach(el=>el.style.display='none');
        panel.querySelectorAll(`[data-host-visible="${signedIn?'signedIn':'signedOut'}"]`).forEach(el=>el.style.display='block');
      }
      window.updateHostMenu = updateHostMenu;
      updateHostMenu();

      const hostLogout = document.getElementById('hostLogoutBtn');
      hostLogout?.addEventListener('click', (e)=>{
        e.preventDefault();
        localStorage.removeItem('sw_logged_in');
        alert('로그아웃 되었습니다.');
        toLoginUI();
        updateHostMenu();
        location.href = '/';
      });

      // ✅ My Page 버튼: 로그인 여부로 분기 (초기 상단 스크립트 덮어쓰는 안전버전)
      document.getElementById('btnMyPage')?.addEventListener('click', ()=>{
        const loggedIn = localStorage.getItem('sw_logged_in') === 'true';
        location.href = loggedIn ? '/mypage.html' : '/login.html';
      });
    });
  </script>

  <!-- 로그인 모달(있다면) -->
  <script src="/assets/login-modal.js"></script>
  <script>
    // 호스트 드롭다운 클릭 토글 (모바일용)
    const hostMenu = document.getElementById('hostMenu');
    if (hostMenu) {
      const toggle = hostMenu.querySelector('.dropdown-toggle');
      let hideTimer;
      toggle?.addEventListener('click', (e)=>{
        e.preventDefault();
        hostMenu.classList.toggle('open');
      });
      hostMenu.addEventListener('mouseleave', ()=>{
        hideTimer = setTimeout(()=>hostMenu.classList.remove('open'), 180);
      });
      hostMenu.addEventListener('mouseenter', ()=> clearTimeout(hideTimer));
    }
  </script>

  <!-- 사이트 공통 인증 브리지 -->
  <script src="/assets/auth-bridge.js"></script>
  <script defer src="/concierge.js"></script>
  <script defer src="https://stayworld-notify-chat.netlify.app/concierge.js"></script>
<!doctype html>
<html lang="en" class="dark">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>StayWorld — Home</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    header{position:sticky;top:0;z-index:50}
    .overlay,.hero-cover{pointer-events:none}
  </style>
</head>
<body class="bg-[#0b0f16] text-white min-h-screen">
  <header class="backdrop-blur bg-black/40 border-b border-white/10">
    <div class="max-w-7xl mx-auto px-4 py-3 flex items-center justify-between">
      <a href="/" class="font-semibold">STAYWORLD</a>
      <nav class="hidden md:flex gap-3">
        <a href="/membership.html" class="px-3 py-2 rounded-xl hover:bg-white/10">Membership</a>
        <a href="/mypage.html" class="px-3 py-2 rounded-xl hover:bg-white/10">My Page</a>
      </nav>
      <div id="authArea"></div>
    </div>
  </header>

  <!-- 로그인 성공 시에만 노출되는 배너 -->
  <section id="welcomeBanner" class="hidden">
    <div class="max-w-7xl mx-auto px-4">
      <div class="mt-4 rounded-2xl border border-emerald-400/30 bg-emerald-500/10 p-4">
        <p class="text-emerald-300 font-semibold">
          환영합니다, <span data-welcome-name>Guest</span>님! 🎉
        </p>
        <p class="text-white/70 text-sm">즐거운 여행 준비를 시작해 보세요.</p>
      </div>
    </div>
  </section>

  <!-- 나머지 홈 콘텐츠 ... -->

  <!-- 공통 UI 스크립트 (반드시 body 종료 직전) -->
  <script type="module" src="/scripts/auth-ui.js"></script>
</body>
</html>
<script type="module">
  import {
    db, collection, query, where, orderBy, limit, getDocs
  } from '/scripts/firebase.js';

  const grid = document.getElementById('recosGrid');
  const skel = document.getElementById('recosSkeleton');

  const fallbackImg = 'https://images.unsplash.com/photo-1505691938895-1758d7feb511?q=80&w=1200&auto=format&fit=crop';

  function cardTemplate(item){
    const firstPhoto = Array.isArray(item.photos) && item.photos.length ? item.photos[0] : fallbackImg;
    const price = typeof item.price === 'number' ? item.price : 0;
    const title = item.title || 'Untitled stay';
    const address = item.address || '';
    const id = item.id;

    return `
      <a href="/results.html?listing=${id}" class="rounded-2xl overflow-hidden border border-white/10 bg-white/5 hover:bg-white/10 transition block">
        <img src="${firstPhoto}" alt="${title}" class="w-full h-48 object-cover">
        <div class="p-4">
          <div class="flex items-start justify-between gap-3">
            <h3 class="font-semibold line-clamp-1">${title}</h3>
            <div class="text-right shrink-0">
              <div class="font-bold">$${price}</div>
              <div class="text-xs text-white/60">/ night</div>
            </div>
          </div>
          <div class="text-sm text-white/60 mt-1 line-clamp-1">${address}</div>
          <div class="mt-3">
            <span class="inline-flex items-center gap-2 px-3 py-1 rounded-xl bg-white text-black text-sm font-semibold">
              예약하기
            </span>
          </div>
        </div>
      </a>
    `;
  }

  async function loadFeatured(){
    try{
      // 활성 숙소 최신순 6개
      const qref = query(
        collection(db, 'listings'),
        where('status', '==', 'Active'),
        orderBy('createdAt', 'desc'),
        limit(6)
      );
      const snap = await getDocs(qref);
      const items = snap.docs.map(d => ({ id: d.id, ...d.data() }));
      if (!items.length){
        skel.innerHTML = '<div class="text-white/60">표시할 숙소가 없습니다.</div>';
        return;
      }
      grid.innerHTML = items.map(cardTemplate).join('');
      skel.classList.add('hidden');
      grid.classList.remove('hidden');
    }catch(err){
      console.error('loadFeatured error', err);
      skel.innerHTML = '<div class="text-red-300">추천 숙소를 불러오지 못했습니다.</div>';
    }
  }

  loadFeatured();
</script>

<script type="module" src="/scripts/auth-ui.js"></script>
<script>
/* ==== Notifications (toggle, badge, render, API) ==== */
(function () {
  const btn        = document.getElementById('notifBtn');
  const panel      = document.getElementById('notifPanel');
  const badge      = document.getElementById('notifBadge');
  const list       = document.getElementById('notifList');
  const markAllBtn = document.getElementById('markAllReadBtn');
  let state = [];

  if (!btn || !panel) return;

  // 패널 토글
  btn.addEventListener('click', (e) => {
    e.stopPropagation();
    const hidden = panel.hasAttribute('hidden');
    document.querySelectorAll('.notif-panel').forEach(p => p.setAttribute('hidden',''));
    if (hidden) panel.removeAttribute('hidden');
    else panel.setAttribute('hidden','');
  });

  // 바깥 클릭/ESC 닫기
  document.addEventListener('click', (e) => {
    if (!panel.contains(e.target) && e.target !== btn) {
      panel.setAttribute('hidden','');
    }
  });
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') panel.setAttribute('hidden','');
  });

  // HTML escape
  function escapeHtml(s) {
    return String(s)
      .replace(/&/g,'&amp;')
      .replace(/</g,'&lt;')
      .replace(/>/g,'&gt;')
      .replace(/"/g,'&quot;')
      .replace(/'/g,'&#39;');
  }

  // 리스트/배지 렌더링
  function render(items) {
    const unread = items.filter(x => !x.read).length;
    if (unread > 0) {
      badge.textContent = unread > 99 ? '99+' : String(unread);
      badge.removeAttribute('hidden');
    } else {
      badge.setAttribute('hidden','');
    }

    list.innerHTML = items.map(item => `
      <li class="notif-item" data-id="${item.id}">
        <span class="notif-dot" style="${item.read ? 'opacity:.25' : ''}"></span>
        <div>
          <div class="notif-title">${escapeHtml(item.title)}</div>
          <div class="notif-desc">${escapeHtml(item.desc || '')}</div>
        </div>
        <div class="notif-time">${escapeHtml(item.time || '')}</div>
      </li>
    `).join('') || `
      <li class="notif-item"><div class="notif-desc">No notifications</div></li>
    `;
  }

  // 알림 가져오기
  function fetchNotifications() {
    fetch('/api/notifications', { credentials: 'include' })
      .then(r => r.json())
      .then(items => {
        state = items;
        render(state);
      })
      .catch(err => {
        console.error("알림 불러오기 실패:", err);
        // 샘플 데이터 fallback
        state = [
          { id: 1, title: 'Booking confirmed', desc: 'Istanbul • 2–5 Sep', time: '2m ago', read: false },
          { id: 2, title: 'Level progress', desc: 'GOLD → 78% reached', time: '1h ago', read: false },
          { id: 3, title: 'Promo', desc: 'Autumn deal unlocked', time: 'Yesterday', read: true }
        ];
        render(state);
      });
  }

  // 전체 읽음 처리
  markAllBtn?.addEventListener('click', () => {
    fetch('/api/notifications/mark-all-read', {
      method: 'POST',
      credentials: 'include'
    })
      .then(() => {
        state = state.map(it => ({...it, read: true}));
        render(state);
      })
      .catch(err => console.error("전체 읽음 실패:", err));
  });

  // 초기 호출
  fetchNotifications();

  // 주기적으로 새로고침 (예: 30초마다)
  setInterval(fetchNotifications, 30000);
})();
</script>
<script>
/**
 * 로그인 시 localStorage.sw_user 를 기준으로
 * - 게스트용 버튼/링크(Login, Sign up, data-auth="guest") 숨김
 * - 유저용 UI(My Page, Logout, data-auth="user") 표시
 * - Logout 클릭 동작 연결
 */
(function () {
  const user = JSON.parse(localStorage.getItem('sw_user') || 'null');

  const show = (sel) => document.querySelectorAll(sel).forEach(el => el.style.display = '');
  const hide = (sel) => document.querySelectorAll(sel).forEach(el => el.style.display = 'none');

  if (user) {
    // 로그인 상태: 게스트용 숨기고 유저용 보여주기
    hide('a[href="/login.html"], a[href="/signup.html"], [data-auth="guest"]');
    show('[data-auth="user"]');

    // 환영 문구 갱신(있을 때만)
    const welcomeEl = document.getElementById('welcomeUser');
    if (welcomeEl) welcomeEl.textContent = `Welcome, ${user.name} 🎉`;
  } else {
    // 비로그인: 게스트용 보이고 유저용 숨기기
    show('a[href="/login.html"], a[href="/signup.html"], [data-auth="guest"]');
    hide('[data-auth="user"]');
  }

  // 로그아웃 버튼 동작(여러 아이디/속성 지원)
  document.querySelectorAll('#logoutBtn, [data-logout]').forEach(btn => {
    btn.addEventListener('click', (e) => {
      e.preventDefault();
      localStorage.removeItem('sw_user');
      location.href = '/index.html';
    });
  });
})();
</script>
<script src="/auth-visibility.js"></script>
</body>
</html>

</body>
</html> 

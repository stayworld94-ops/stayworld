<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>STAYWORLD — Hotels</title>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin="anonymous">
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin="anonymous"></script>

  <style>
    :root{ --bg:#0b0f16;--panel:#101018;--panel-2:#0f131c;--text:#e7e9ee;--muted:#aeb6c8;--line:rgba(255,255,255,.08);
      --chip:#121a26;--gold1:#f4d78c;--gold2:#c9a35b;--accent:#1e5bd8;--green:#2ecc71;--danger:#ff5a5f; --header-h:64px; }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:var(--bg);color:var(--text);font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif}

    /* Header */
    .sw-header{position:sticky;top:0;z-index:100;background:rgba(10,14,20,.85);backdrop-filter:blur(10px);border-bottom:1px solid var(--line)}
    .sw-header-inner{max-width:1200px;margin:0 auto;display:flex;align-items:center;gap:16px;padding:10px 16px;height:var(--header-h)}
    .sw-brand{display:flex;align-items:center;gap:10px;color:var(--text);text-decoration:none}
    .sw-logo{width:30px;height:30px;border-radius:50%;background:radial-gradient(circle at 30% 30%,#fff8dd 0,#f4d78c 45%,#c9a35b 70%,#8a6d33 100%)}
    .sw-nav{margin-left:auto;display:flex;gap:14px}
    .sw-nav a{color:var(--muted);text-decoration:none;padding:8px 10px;border-radius:10px}
    .sw-nav a:hover{background:var(--chip);color:var(--text)}
    .sw-nav a.active{color:var(--gold1);border:1px solid var(--line);background:linear-gradient(180deg,rgba(27,27,36,.6),rgba(27,27,36,.2))}
    .sw-cta{display:flex;gap:10px;margin-left:8px}
    .btn{display:inline-flex;align-items:center;gap:8px;padding:10px 14px;border-radius:12px;text-decoration:none;border:1px solid var(--line);color:var(--text);cursor:pointer}
    .btn.gold{background:linear-gradient(180deg,#f4d78c,#c9a35b);color:#121212;border:none;font-weight:800}
    .btn.ghost:hover{background:var(--chip)}
    .btn.yellow{background:linear-gradient(180deg,#f4d78c,#c9a35b);color:#111;border:none;font-weight:800}
    .btn.yellow:hover{filter:brightness(.95)}
    @media(max-width:880px){.sw-nav,.sw-cta{display:none}}

    /* Top controls */
    .controls{display:flex;gap:10px;flex-wrap:wrap;align-items:center;padding:12px 14px;border-bottom:1px solid var(--line);background:linear-gradient(180deg,rgba(16,16,24,.7),rgba(16,16,24,0))}
    .chip{display:inline-flex;gap:8px;align-items:center;padding:9px 12px;background:var(--chip);border:1px solid var(--line);border-radius:12px;color:var(--text);cursor:pointer}
    .chip:hover{background:#152033}
    .select{padding:8px 10px;border-radius:10px;background:var(--panel);border:1px solid var(--line);color:var(--text)}
    .hint{color:var(--muted);font-size:12px;margin-left:8px}

    /* Layout */
    .wrap{display:grid;grid-template-columns:1.15fr .85fr;gap:16px;padding:14px}
    @media(max-width:1024px){.wrap{grid-template-columns:1fr}}

    /* Cards */
    .card{background:var(--panel);border:1px solid var(--line);border-radius:16px;overflow:hidden;box-shadow:0 10px 30px rgba(0,0,0,.25);margin-bottom:14px}
    .card-media{position:relative}
    .card-media img{width:100%;height:210px;object-fit:cover;display:block}
    .badge-row{position:absolute;top:10px;left:10px;display:flex;gap:8px}
    .badge{background:rgba(0,0,0,.6);backdrop-filter:blur(6px);border:1px solid var(--line);color:#fff;padding:6px 8px;border-radius:10px;font-size:12px}
    .fav{position:absolute;right:12px;top:12px;width:36px;height:36px;border-radius:12px;background:rgba(0,0,0,.5);display:grid;place-items:center;border:1px solid var(--line);cursor:pointer}
    .fav svg{fill:transparent;stroke:#fff;stroke-width:1.6}
    .fav.active svg{fill:var(--danger);stroke:var(--danger)}
    .card-body{display:grid;grid-template-columns:1fr auto;gap:12px;padding:12px 14px 16px}
    .title{font-weight:700;font-size:18px}
    .rating{justify-self:end;align-self:start;background:#2b6bed;border:1px solid rgba(255,255,255,.15);color:#fff;padding:6px 10px;border-radius:10px;font-weight:700}
    .meta{display:flex;gap:10px;align-items:center;color:var(--muted);font-size:14px}
    .payline{margin-top:6px;display:flex;gap:10px;align-items:baseline}
    .price{font-size:20px;font-weight:800;color:var(--gold1)}
    .tax{color:var(--muted);font-size:12px}
    .cancel{margin-top:4px;color:var(--green);font-size:14px}
    .card .book{margin-top:10px;display:inline-flex}

    /* Map (inline) */
    #map{height:520px;border:1px solid var(--line);border-radius:16px;overflow:hidden}
    #map,.leaflet-container,.leaflet-pane,.leaflet-control-container{z-index:0!important}
    #filterPanel,.filter-panel,.filter-backdrop{z-index:1100}

    /* Footer */
    footer.sw-footer{margin-top:24px;border-top:1px solid var(--line);background:linear-gradient(180deg,rgba(16,16,24,.7),rgba(16,16,24,0));padding:24px 16px}
    .sw-footer-inner{max-width:1200px;margin:0 auto;display:grid;grid-template-columns:1fr 1fr 1fr;gap:16px}
    .sw-foot-col h4{margin:0 0 10px 0;color:var(--gold1)}
    .sw-foot-col a{display:block;color:var(--muted);text-decoration:none;margin:6px 0}
    .sw-foot-col a:hover{color:var(--text)}
    .sw-copy{max-width:1200px;margin:6px auto 0 auto;color:var(--muted);font-size:12px}

    /* Filter drawer */
    .filter-backdrop{position:fixed;inset:0;background:rgba(0,0,0,.5);backdrop-filter:blur(2px);display:none}
    .filter-panel{position:fixed;right:0;top:0;bottom:0;width:380px;max-width:92vw;background:var(--panel);border-left:1px solid var(--line);box-shadow:-10px 0 30px rgba(0,0,0,.4);transform:translateX(100%);transition:transform .25s ease}
    .filter-open .filter-panel{transform:translateX(0)}
    .filter-open .filter-backdrop{display:block}
    .filter-head{display:flex;align-items:center;justify-content:space-between;gap:8px;padding:14px;border-bottom:1px solid var(--line)}
    .filter-body{padding:14px;display:grid;gap:16px;overflow:auto;height:calc(100% - 150px)}
    .filter-row{display:grid;gap:8px}
    .filter-row label{color:var(--muted);font-size:13px}
    .range{display:flex;gap:10px;align-items:center}
    .range input[type=range]{width:100%}
    .filter-actions{display:flex;gap:10px;padding:12px;border-top:1px solid var(--line);background:linear-gradient(180deg,rgba(16,16,24,.6),rgba(16,16,24,0))}
    .btn.small{padding:8px 10px;border-radius:10px}
    .btn.reset{background:transparent;color:var(--muted)}
    .checks{display:flex;flex-wrap:wrap;gap:8px}
    .checks label{display:inline-flex;align-items:center;gap:6px;background:var(--chip);border:1px solid var(--line);padding:6px 8px;border-radius:10px}

    /* Map Drawer */
    .map-drawer{position:fixed;top:var(--header-h);right:0;height:calc(100vh - var(--header-h));width:min(520px,92vw);background:#0d0f15;border-left:1px solid var(--line);transform:translateX(110%);transition:transform .25s ease;z-index:1200;display:grid;grid-template-rows:auto 1fr;box-shadow:-14px 0 28px rgba(0,0,0,.35)}
    .map-drawer.open{transform:translateX(0)}
    .map-drawer__head{display:flex;align-items:center;justify-content:space-between;gap:8px;padding:10px 12px;background:rgba(255,255,255,.04);border-bottom:1px solid var(--line)}
    .map-drawer__body{width:100%;height:100%}
    #drawerMap{width:100%;height:100%}

    /* Marker */
    .hotel-marker{transform:translateY(-8px)}
    .hotel-marker .wrap{display:inline-flex;align-items:center;gap:6px;background:rgba(17,19,25,.9);border:1px solid rgba(255,255,255,.15);padding:4px 8px;border-radius:14px;backdrop-filter:blur(6px);box-shadow:0 6px 14px rgba(0,0,0,.35);font-weight:700;font-size:13px;color:#fff;white-space:nowrap}
    .hotel-marker .emoji{font-size:16px}
    .hotel-marker .price{background:var(--gold1);color:#111;border-radius:10px;padding:2px 6px;font-weight:800;font-size:12px}

    /* Dim while drawer open */
    .dim .wrap{filter:brightness(.9);pointer-events:none}
    .dim .controls,.dim .sw-header,.dim #mapDrawer{pointer-events:auto;filter:none}
  </style>
<!-- 공용 UI + i18n/통화 + 권한/알림 컨트롤 -->
<script defer src="/assets/sw-core.js"></script>
<script defer src="/assets/sw-auth-ui.js"></script>
</head>
<body>
  <!-- Header -->
 <header class="site-header">
  <div class="container flex-between">
    <!-- 로고 -->
    <a href="/" class="logo">
      <img src="/assets/img/logo-stayworld.png" alt="StayWorld Logo" height="28">
      <strong>STAYWORLD</strong>
    </a>

    <!-- 내비 -->
    <nav class="main-nav">
      <a href="/"              id="navHome"  data-i18n="nav_home">Home</a>
      <a href="/membership"    id="navMem"   data-i18n="nav_membership">Membership</a>
      <a href="/hotels.html"   id="navHotel" data-i18n="nav_hotels">Hotels</a>
    </nav>

    <!-- 우측 컨트롤 -->
    <div class="header-ctrls">
      <span data-i18n-langlabel style="opacity:.7;margin-right:6px">Language</span>
      <select id="swLang">
        <option>EN</option><option>KO</option><option>JA</option><option>ZH</option>
        <option>FR</option><option>ES</option><option>DE</option><option>IT</option>
        <option>TR</option><option>AR</option><option>RU</option>
      </select>

      <select id="swCur" style="margin-left:8px">
        <option>USD</option><option>KRW</option><option>JPY</option><option>CNY</option>
        <option>EUR</option><option>TRY</option><option>AED</option><option>GBP</option>
        <option>RUB</option>
      </select>

      <!-- 손님 전용 -->
      <a href="/login.html"  class="btn" data-auth="guest" data-i18n="nav_login">Log in</a>
      <a href="/signup.html" class="btn" data-auth="guest" data-i18n="nav_signup">Sign up</a>
      <a href="/host-login.html" class="btn" data-auth="guest" data-i18n="nav_host" data-host="out">Host login</a>

      <!-- 로그인 전용 -->
      <span class="user" data-auth="user" style="display:none">
        <b id="welcomeUser"></b>
        <a href="#" id="logoutBtn" class="btn">Logout</a>
      </span>

      <!-- 알림: 로그인시에만 표시 -->
      <div id="notifWrap" style="display:none">
        <button id="notifBtn" aria-label="Notifications">🔔</button>
        <div id="notifPanel" hidden></div>
      </div>
    </div>
  </div>
</header>

  <!-- Controls -->
  <div class="controls">
    <div class="chip" id="btnSort">⇅ <span id="sortLabel" data-i18n="controls.sort">Sort</span></div>
    <div class="chip" id="btnFilter">☰ <span data-i18n="controls.filter">Filter</span></div>
    <div class="chip" id="btnMapList">🗺️ <span data-i18n="controls.map">Map</span></div>

    <button class="btn yellow" id="openMapDrawer">🗺️ <span data-i18n="buttons.mapOpen">Open map</span></button>

    <select class="select" id="lang" aria-label="Language"></select>
    <select class="select" id="currency" aria-label="Currency"></select>
    <span class="hint" id="rateHint" data-i18n="controls.rateHint">* Demo rates. Connect a live FX API.</span>
  </div>

  <!-- Filter Drawer -->
  <div class="filter-backdrop" id="filterBackdrop"></div>
  <aside class="filter-panel" id="filterPanel" aria-hidden="true">
    <div class="filter-head">
      <strong data-i18n="filters.title">Filters</strong>
      <button class="btn small reset" id="btnCloseFilter">✕</button>
    </div>
    <div class="filter-body">
      <div class="filter-row">
        <label data-i18n="filters.maxPrice">Max price (converted)</label>
        <div class="range"><input type="range" id="fPrice" min="50" max="1000" step="10" value="1000"/><span id="fPriceVal">—</span></div>
      </div>
      <div class="filter-row">
        <label data-i18n="filters.minRating">Minimum rating</label>
        <div class="range"><input type="range" id="fRating" min="0" max="5" step="0.1" value="0"/><span id="fRatingVal">0.0</span></div>
      </div>
      <div class="filter-row">
        <label data-i18n="filters.maxDistance">Max distance from center (km)</label>
        <div class="range"><input type="range" id="fDistance" min="0" max="30" step="1" value="30"/><span id="fDistanceVal">—</span></div>
      </div>
      <div class="filter-row"><label><input type="checkbox" id="fFreeCancel"> <span data-i18n="filters.freeCancel">Free cancellation only</span></label></div>

      <!-- Stay type -->
      <div class="filter-row">
        <label data-i18n="filters.type">Stay type</label>
        <div class="checks" id="fType">
          <label><input type="checkbox" value="Hotel"><span data-i18n="type.hotel">Hotel</span></label>
          <label><input type="checkbox" value="Motel"><span data-i18n="type.motel">Motel</span></label>
          <label><input type="checkbox" value="Hostel"><span data-i18n="type.hostel">Hostel</span></label>
          <label><input type="checkbox" value="Apartment"><span data-i18n="type.apartment">Apartment</span></label>
          <label><input type="checkbox" value="Villa"><span data-i18n="type.villa">Villa</span></label>
          <label><input type="checkbox" value="Ryokan"><span data-i18n="type.ryokan">Ryokan</span></label>
          <label><input type="checkbox" value="Guesthouse"><span data-i18n="type.guesthouse">Guesthouse</span></label>
          <label><input type="checkbox" value="B&B"><span data-i18n="type.bnb">B&B</span></label>
        </div>
      </div>

      <!-- 20+ categories -->
      <div class="filter-row">
        <label data-i18n="filters.amen">Amenities</label>
        <div class="checks" id="fAmen">
          <label><input type="checkbox" value="Wi-Fi"><span data-i18n="amen.wifi">Wi-Fi</span></label>
          <label><input type="checkbox" value="Kitchen"><span data-i18n="amen.kitchen">Kitchen</span></label>
          <label><input type="checkbox" value="Parking"><span data-i18n="amen.parking">Parking</span></label>
          <label><input type="checkbox" value="Pool"><span data-i18n="amen.pool">Pool</span></label>
          <label><input type="checkbox" value="Air conditioning"><span data-i18n="amen.ac">Air conditioning</span></label>
          <label><input type="checkbox" value="Gym"><span data-i18n="amen.gym">Gym</span></label>
          <label><input type="checkbox" value="Workspace"><span data-i18n="amen.workspace">Workspace</span></label>
          <label><input type="checkbox" value="Washer"><span data-i18n="amen.washer">Washer</span></label>
          <label><input type="checkbox" value="Dryer"><span data-i18n="amen.dryer">Dryer</span></label>
          <label><input type="checkbox" value="Breakfast"><span data-i18n="amen.breakfast">Breakfast</span></label>
        </div>
      </div>

      <div class="filter-row">
        <label data-i18n="filters.booking">Booking</label>
        <div class="checks" id="fBooking">
          <label><input type="checkbox" value="Instant"><span data-i18n="book.instant">Instant book</span></label>
          <label><input type="checkbox" value="Request"><span data-i18n="book.request">Request to book</span></label>
        </div>
      </div>

      <div class="filter-row">
        <label data-i18n="filters.verify">Verification</label>
        <div class="checks" id="fVerify">
          <label><input type="checkbox" value="Verified listings"><span data-i18n="verify.listings">Verified listings only</span></label>
          <label><input type="checkbox" value="Verified reviews"><span data-i18n="verify.reviews">Verified reviews</span></label>
        </div>
      </div>

      <div class="filter-row">
        <label data-i18n="filters.long">Long-stay</label>
        <div class="checks" id="fLong">
          <label><input type="checkbox" value="Long deals"><span data-i18n="long.deals">Show long-stay deals</span></label>
        </div>
      </div>

      <div class="filter-row">
        <label data-i18n="filters.biz">Business</label>
        <div class="checks" id="fBiz">
          <label><input type="checkbox" value="B2B"><span data-i18n="biz.b2b">B2B-ready</span></label>
          <label><input type="checkbox" value="Invoice"><span data-i18n="biz.invoice">Invoice available</span></label>
        </div>
      </div>

      <div class="filter-row">
        <label data-i18n="filters.acc">Accessibility</label>
        <div class="checks" id="fAcc">
          <label><input type="checkbox" value="Step-free"><span data-i18n="acc.stepfree">Step-free access</span></label>
          <label><input type="checkbox" value="Elevator"><span data-i18n="acc.elevator">Elevator</span></label>
          <label><input type="checkbox" value="Wide doorway"><span data-i18n="acc.doorway">Wide doorway</span></label>
          <label><input type="checkbox" value="Accessible bathroom"><span data-i18n="acc.bathroom">Accessible bathroom</span></label>
        </div>
      </div>

      <div class="filter-row">
        <label data-i18n="filters.view">View</label>
        <div class="checks" id="fView">
          <label><input type="checkbox" value="Sea view"><span data-i18n="view.sea">Sea view</span></label>
          <label><input type="checkbox" value="City view"><span data-i18n="view.city">City view</span></label>
          <label><input type="checkbox" value="Mountain view"><span data-i18n="view.mountain">Mountain view</span></label>
          <label><input type="checkbox" value="Garden"><span data-i18n="view.garden">Garden</span></label>
        </div>
      </div>

      <div class="filter-row">
        <label data-i18n="filters.safe">Safety</label>
        <div class="checks" id="fSafe">
          <label><input type="checkbox" value="CO alarm"><span data-i18n="safe.co">Carbon monoxide alarm</span></label>
          <label><input type="checkbox" value="Smoke alarm"><span data-i18n="safe.smoke">Smoke alarm</span></label>
          <label><input type="checkbox" value="First aid kit"><span data-i18n="safe.aid">First aid kit</span></label>
        </div>
      </div>

      <div class="filter-row">
        <label data-i18n="filters.family">Family</label>
        <div class="checks" id="fFamily">
          <label><input type="checkbox" value="Crib"><span data-i18n="family.crib">Crib</span></label>
          <label><input type="checkbox" value="High chair"><span data-i18n="family.chair">High chair</span></label>
          <label><input type="checkbox" value="Stroller friendly"><span data-i18n="family.stroller">Stroller friendly</span></label>
        </div>
      </div>

      <div class="filter-row">
        <label data-i18n="filters.ent">Entertainment</label>
        <div class="checks" id="fEnt">
          <label><input type="checkbox" value="TV"><span data-i18n="ent.tv">TV</span></label>
          <label><input type="checkbox" value="Netflix"><span data-i18n="ent.netflix">Netflix</span></label>
          <label><input type="checkbox" value="Game console"><span data-i18n="ent.console">Game console</span></label>
        </div>
      </div>

      <div class="filter-row">
        <label data-i18n="filters.out">Outdoor</label>
        <div class="checks" id="fOut">
          <label><input type="checkbox" value="BBQ"><span data-i18n="out.bbq">BBQ grill</span></label>
          <label><input type="checkbox" value="Patio"><span data-i18n="out.patio">Patio</span></label>
          <label><input type="checkbox" value="Private garden"><span data-i18n="out.garden">Private garden</span></label>
        </div>
      </div>

      <div class="filter-row">
        <label data-i18n="filters.park">Parking</label>
        <div class="checks" id="fPark">
          <label><input type="checkbox" value="On-site"><span data-i18n="park.onsite">On-site</span></label>
          <label><input type="checkbox" value="Street"><span data-i18n="park.street">Street</span></label>
          <label><input type="checkbox" value="Garage"><span data-i18n="park.garage">Paid garage</span></label>
        </div>
      </div>

      <div class="filter-row">
        <label data-i18n="filters.pets">Pets</label>
        <div class="checks" id="fPets">
          <label><input type="checkbox" value="Pet allowed"><span data-i18n="pets.allowed">Allowed</span></label>
        </div>
      </div>

      <div class="filter-row">
        <label data-i18n="filters.checkin">Check-in</label>
        <div class="checks" id="fCheckin">
          <label><input type="checkbox" value="Self"><span data-i18n="checkin.self">Self check-in</span></label>
        </div>
      </div>

      <div class="filter-row">
        <label data-i18n="filters.exp">Experiences</label>
        <div class="checks" id="fExp">
          <label><input type="checkbox" value="Nature"><span data-i18n="exp.nature">Nature</span></label>
          <label><input type="checkbox" value="Camping"><span data-i18n="exp.camping">Camping</span></label>
          <label><input type="checkbox" value="Traditional"><span data-i18n="exp.traditional">Traditional</span></label>
          <label><input type="checkbox" value="Ski"><span data-i18n="exp.ski">Ski-in/out</span></label>
          <label><input type="checkbox" value="Wine"><span data-i18n="exp.wine">Wine country</span></label>
        </div>
      </div>

      <div class="filter-row">
        <label data-i18n="filters.loc">Location</label>
        <div class="checks" id="fLoc">
          <label><input type="checkbox" value="Near airport"><span data-i18n="loc.airport">Near airport</span></label>
          <label><input type="checkbox" value="Near station"><span data-i18n="loc.station">Near station</span></label>
          <label><input type="checkbox" value="Near beach"><span data-i18n="loc.beach">Near beach</span></label>
          <label><input type="checkbox" value="City center"><span data-i18n="loc.center">City center</span></label>
        </div>
      </div>
    </div>

    <div class="filter-actions">
      <button class="btn small reset" id="btnResetFilters" data-i18n="filters.reset">Reset</button>
      <button class="btn small gold" id="btnApplyFilters" data-i18n="filters.apply">Apply</button>
    </div>
  </aside>

  <!-- List + Map -->
  <div class="wrap">
    <div><div id="list"></div></div>
    <div><div id="map"></div></div>
  </div>

  <!-- Map Drawer -->
  <aside class="map-drawer" id="mapDrawer" aria-hidden="true">
    <div class="map-drawer__head">
      <strong data-i18n="map.title">Hotel map</strong>
      <button id="closeMapDrawer" class="btn yellow">✕ <span data-i18n="buttons.mapClose">Close map</span></button>
    </div>
    <div id="drawerMap" class="map-drawer__body"></div>
  </aside>

  <!-- Footer -->
  <footer class="sw-footer">
    <div class="sw-footer-inner">
      <div class="sw-foot-col"><h4>STAYWORLD</h4><a href="/about.html" data-i18n="foot.about">About</a><a href="/careers.html" data-i18n="foot.careers">Careers</a><a href="/press.html" data-i18n="foot.press">Press</a></div>
      <div class="sw-foot-col"><h4 data-i18n="foot.help">Help</h4><a href="/help.html" data-i18n="foot.center">Help Center</a><a href="/safety.html" data-i18n="foot.protect">Guest Protection</a><a href="/contact.html" data-i18n="foot.contact">Contact</a></div>
      <div class="sw-foot-col"><h4 data-i18n="foot.legal">Legal</h4><a href="/terms.html" data-i18n="foot.terms">Terms</a><a href="/privacy.html" data-i18n="foot.privacy">Privacy</a><a href="/cookies.html" data-i18n="foot.cookies">Cookies</a></div>
    </div>
    <div class="sw-copy">© 2025 STAYWORLD. All rights reserved.</div>
  </footer>

  <!-- i18n -->
  <script>
    const I18N = {
      en:{ "nav.home":"Home","nav.hotels":"Hotels","nav.membership":"Membership","nav.search":"Search","nav.becomeHost":"Become a Host",
        "nav.login":"Log in","nav.signup":"Sign up",
        "controls.sort":"Sort","controls.filter":"Filter","controls.map":"Map","controls.rateHint":"* Demo rates. Connect a live FX API.",
        "map.title":"Hotel map",
        "buttons.mapOpen":"Open map","buttons.mapClose":"Close map","buttons.book":"Book",
        "filters.title":"Filters","filters.maxPrice":"Max price (converted)","filters.minRating":"Minimum rating","filters.maxDistance":"Max distance from center (km)","filters.freeCancel":"Free cancellation only","filters.reset":"Reset","filters.apply":"Apply",
        "filters.type":"Stay type","filters.amen":"Amenities","filters.booking":"Booking","filters.verify":"Verification","filters.long":"Long-stay","filters.biz":"Business","filters.acc":"Accessibility","filters.view":"View","filters.safe":"Safety","filters.family":"Family","filters.ent":"Entertainment","filters.out":"Outdoor","filters.park":"Parking","filters.pets":"Pets","filters.checkin":"Check-in","filters.exp":"Experiences","filters.loc":"Location",
        "type.hotel":"Hotel","type.motel":"Motel","type.hostel":"Hostel","type.apartment":"Apartment","type.villa":"Villa","type.ryokan":"Ryokan","type.guesthouse":"Guesthouse","type.bnb":"B&B",
        "amen.wifi":"Wi-Fi","amen.kitchen":"Kitchen","amen.parking":"Parking","amen.pool":"Pool","amen.ac":"Air conditioning","amen.gym":"Gym","amen.workspace":"Workspace","amen.washer":"Washer","amen.dryer":"Dryer","amen.breakfast":"Breakfast",
        "book.instant":"Instant book","book.request":"Request to book",
        "verify.listings":"Verified listings only","verify.reviews":"Verified reviews",
        "long.deals":"Show long-stay deals",
        "biz.b2b":"B2B-ready","biz.invoice":"Invoice available",
        "acc.stepfree":"Step-free access","acc.elevator":"Elevator","acc.doorway":"Wide doorway","acc.bathroom":"Accessible bathroom",
        "view.sea":"Sea view","view.city":"City view","view.mountain":"Mountain view","view.garden":"Garden",
        "safe.co":"Carbon monoxide alarm","safe.smoke":"Smoke alarm","safe.aid":"First aid kit",
        "family.crib":"Crib","family.chair":"High chair","family.stroller":"Stroller friendly",
        "ent.tv":"TV","ent.netflix":"Netflix","ent.console":"Game console",
        "out.bbq":"BBQ grill","out.patio":"Patio","out.garden":"Private garden",
        "park.onsite":"On-site","park.street":"Street","park.garage":"Paid garage",
        "pets.allowed":"Allowed",
        "checkin.self":"Self check-in",
        "exp.nature":"Nature","exp.camping":"Camping","exp.traditional":"Traditional","exp.ski":"Ski-in/out","exp.wine":"Wine country",
        "loc.airport":"Near airport","loc.station":"Near station","loc.beach":"Near beach","loc.center":"City center",
        "labels.perNight":"/ night",
        "sort.priceAsc":"price↑","sort.priceDesc":"price↓","sort.ratingDesc":"rating","sort.distanceAsc":"distance"
      },
      ko:{ "nav.home":"홈","nav.hotels":"숙소","nav.membership":"멤버십","nav.search":"검색","nav.becomeHost":"호스트 되기",
        "nav.login":"로그인","nav.signup":"가입하기",
        "controls.sort":"정렬","controls.filter":"필터","controls.map":"지도","controls.rateHint":"* 데모 환율입니다. 운영 시 환율 API를 연결하세요.",
        "map.title":"호텔 위치 지도",
        "buttons.mapOpen":"지도 열기","buttons.mapClose":"지도 닫기","buttons.book":"예약하기",
        "filters.title":"필터","filters.maxPrice":"최대 가격(환산)","filters.minRating":"최소 평점","filters.maxDistance":"도심까지 최대 거리(km)","filters.freeCancel":"무료 취소만","filters.reset":"초기화","filters.apply":"적용",
        "filters.type":"숙소 유형","filters.amen":"편의시설","filters.booking":"예약 방식","filters.verify":"검증","filters.long":"장기 숙박","filters.biz":"비즈니스","filters.acc":"접근성","filters.view":"전망","filters.safe":"안전","filters.family":"가족","filters.ent":"엔터테인먼트","filters.out":"아웃도어","filters.park":"주차","filters.pets":"반려동물","filters.checkin":"체크인","filters.exp":"경험","filters.loc":"위치",
        "type.hotel":"호텔","type.motel":"모텔","type.hostel":"호스텔","type.apartment":"아파트","type.villa":"빌라","type.ryokan":"료칸","type.guesthouse":"게스트하우스","type.bnb":"B&B",
        "amen.wifi":"와이파이","amen.kitchen":"주방","amen.parking":"주차","amen.pool":"수영장","amen.ac":"에어컨","amen.gym":"피트니스","amen.workspace":"업무 공간","amen.washer":"세탁기","amen.dryer":"건조기","amen.breakfast":"조식",
        "book.instant":"즉시 예약","book.request":"예약 요청",
        "verify.listings":"검증된 숙소만","verify.reviews":"검증된 리뷰",
        "long.deals":"장기 숙박 특가만 보기",
        "biz.b2b":"B2B 지원","biz.invoice":"인보이스 제공",
        "acc.stepfree":"무단차 출입","acc.elevator":"엘리베이터","acc.doorway":"넓은 출입문","acc.bathroom":"장애인 화장실",
        "view.sea":"바다 전망","view.city":"도시 전망","view.mountain":"산 전망","view.garden":"정원",
        "safe.co":"일산화탄소 감지기","safe.smoke":"연기 감지기","safe.aid":"구급상자",
        "family.crib":"아기 침대","family.chair":"아기의자","family.stroller":"유모차 가능",
        "ent.tv":"TV","ent.netflix":"넷플릭스","ent.console":"게임 콘솔",
        "out.bbq":"바비큐 그릴","out.patio":"파티오","out.garden":"전용 정원",
        "park.onsite":"현장 주차","park.street":"노상 주차","park.garage":"유료 차고",
        "pets.allowed":"가능",
        "checkin.self":"셀프 체크인",
        "exp.nature":"자연","exp.camping":"캠핑","exp.traditional":"전통","exp.ski":"스키 인/아웃","exp.wine":"와인",
        "loc.airport":"공항 인근","loc.station":"역 인근","loc.beach":"해변 인근","loc.center":"도심",
        "labels.perNight":"/ 1박",
        "sort.priceAsc":"가격↑","sort.priceDesc":"가격↓","sort.ratingDesc":"평점","sort.distanceAsc":"거리"
      },
      de:{ "controls.sort":"Sortieren","buttons.mapOpen":"Karte öffnen","buttons.mapClose":"Karte schließen","labels.perNight":"/ Nacht",
           "sort.priceAsc":"Preis↑","sort.priceDesc":"Preis↓","sort.ratingDesc":"Bewertung","sort.distanceAsc":"Entfernung" },
      ja:{ "controls.sort":"並び替え","buttons.mapOpen":"地図を開く","buttons.mapClose":"地図を閉じる","labels.perNight":"/ 泊",
           "sort.priceAsc":"料金↑","sort.priceDesc":"料金↓","sort.ratingDesc":"評価","sort.distanceAsc":"距離" }
    };

    function detectLang(){
      try{
        const saved = localStorage.getItem('sw_lang') || '';
        const nav = (navigator.language||'en').slice(0,2).toLowerCase();
        const guess = saved || nav;
        return I18N[guess] ? guess : 'en';
      }catch(_){ return 'en'; }
    }
    let CURRENT_LANG = detectLang();
    function setLang(l){ CURRENT_LANG = I18N[l] ? l : 'en'; }
    function t(key){ const L = I18N[CURRENT_LANG] || I18N.en; return L[key] || I18N.en[key] || key; }
    function applyLang(){
      document.querySelectorAll("[data-i18n]").forEach(el=>{
        const k=el.getAttribute("data-i18n"); const txt=t(k); if(txt!=null) el.textContent=txt;
      });
      const sortMap = { 'price-asc':'sort.priceAsc','price-desc':'sort.priceDesc','rating-desc':'sort.ratingDesc','distance-asc':'sort.distanceAsc' };
      const key = sortMap[state.sort] || 'sort.priceAsc';
      document.getElementById('sortLabel').textContent = `${t('controls.sort')}: ${t(key)}`;
    }
  </script>

  <!-- App -->
  <script>
    const LANGS={en:'English',ko:'한국어',ja:'日本語',de:'Deutsch'};
    const CURRENCIES={USD:'USD',KRW:'KRW',TRY:'TRY',EUR:'EUR',JPY:'JPY',CNY:'CNY',RUB:'RUB'};
    const LANG_TO_DEFAULT_CURRENCY={en:'USD',ko:'KRW',ja:'JPY',de:'EUR'};
    const RATES={USD:1,KRW:1350,TRY:33,EUR:0.92,JPY:156,RUB:90,CNY:7.2};

    let CITY_CENTER={name:'Istanbul',lat:41.0082,lng:28.9784};
    let map, markersLayer, drawerMap, drawerLayer;

    const state={ lang: CURRENT_LANG, currency:'USD', sort:'price-asc',
      filters:{
        priceMax:1000,ratingMin:0,distanceMax:30,freeCancel:false,
        type:new Set(), amen:new Set(), booking:new Set(), verify:new Set(),
        long:new Set(), biz:new Set(), acc:new Set(), view:new Set(),
        safe:new Set(), family:new Set(), ent:new Set(), out:new Set(),
        park:new Set(), pets:new Set(), checkin:new Set(), exp:new Set(), loc:new Set()
      },
      listings:[], nf:null };
    state.currency=LANG_TO_DEFAULT_CURRENCY[state.lang]||'USD';
    state.nf=new Intl.NumberFormat(state.lang,{style:'currency',currency:state.currency});

    const $=(s,sc)=> (sc||document).querySelector(s);
    const $$=(s,sc)=> Array.from((sc||document).querySelectorAll(s));
    const on=(el,ev,fn)=> el&&el.addEventListener(ev,fn,{passive:false});
    const usdToDisplay=usd=> usd*(RATES[state.currency]||1);
    const formatPriceFromUsd=usd=> state.nf.format(usdToDisplay(usd));

    function buildSelects(){
      const langSel=$('#lang'), curSel=$('#currency');
      const availableLangs=Object.keys(I18N);
      langSel.innerHTML = availableLangs.map(k=>`<option value="${k}">${LANGS[k]||k}</option>`).join('');
      curSel.innerHTML = Object.keys(CURRENCIES).map(k=>`<option value="${k}">${k}</option>`).join('');
      if(!I18N[state.lang]) state.lang='en';
      langSel.value=state.lang; curSel.value=state.currency;

      on(langSel,'change', ()=>{
        state.lang=langSel.value; setLang(state.lang);
        try{ localStorage.setItem('sw_lang', state.lang);}catch(_){}
        if(!CURRENCIES[state.currency]) state.currency=LANG_TO_DEFAULT_CURRENCY[state.lang]||'USD';
        state.nf=new Intl.NumberFormat(state.lang,{style:'currency',currency:state.currency});
        $('#currency').value=state.currency;
        applyLang(); updateFilterLabels(); renderList(); renderMarkers(); renderDrawerMarkers();
      });
      on(curSel,'change', ()=>{
        state.currency=curSel.value; state.nf=new Intl.NumberFormat(state.lang,{style:'currency',currency:state.currency});
        updateFilterLabels(); renderList(); renderMarkers(); renderDrawerMarkers();
      });
    }

    /* Inline Map */
    function initMap(){
      if(map) return;
      map=L.map('map',{scrollWheelZoom:true}).setView([CITY_CENTER.lat,CITY_CENTER.lng],11);
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{attribution:'&copy; OpenStreetMap'}).addTo(map);
      markersLayer=L.layerGroup().addTo(map);
    }
    function makeIcon(h){
      const price=formatPriceFromUsd(h.price_usd||0);
      const emoji=h.emoji||'🏨';
      return L.divIcon({ className:'hotel-marker',
        html:`<div class="wrap"><span class="emoji">${emoji}</span><span>${h.title}</span><span class="price">${price}</span></div>`,
        iconSize:[10,10], iconAnchor:[10,10] });
    }
    function renderMarkers(){
      initMap(); markersLayer.clearLayers();
      const items=getFilteredSorted(state.listings); const pts=[];
      items.forEach(it=>{
        if(typeof it.lat!=='number'||typeof it.lng!=='number') return;
        const mk=L.marker([it.lat,it.lng],{icon:makeIcon(it)}).addTo(markersLayer)
          .bindPopup(`<b>${it.title}</b><br>${it.city}, ${it.country}<br>${formatPriceFromUsd(it.price_usd||0)}${t('labels.perNight')}`);
        pts.push([it.lat,it.lng]); it._mk=mk;
      });
      if(pts.length){
        const group=L.featureGroup(pts.map(([a,b])=>L.marker([a,b])));
        map.fitBounds(group.getBounds().pad(0.2));
      }
    }

    /* Drawer Map */
    const mapDrawer=$('#mapDrawer'), openMapBtn=$('#openMapDrawer'), closeMapBtn=$('#closeMapDrawer');
    function initDrawerMap(){
      if(drawerMap) return;
      drawerMap=L.map('drawerMap',{zoomControl:true}).setView([CITY_CENTER.lat,CITY_CENTER.lng],11);
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:19,attribution:'&copy; OpenStreetMap'}).addTo(drawerMap);
      drawerLayer=L.layerGroup().addTo(drawerMap);
    }
    function openDrawer(){ mapDrawer.classList.add('open'); document.body.classList.add('dim'); setTimeout(()=>drawerMap?.invalidateSize(),220); }
    function closeDrawer(){ mapDrawer.classList.remove('open'); document.body.classList.remove('dim'); }
    on(openMapBtn,'click',()=>{ initDrawerMap(); openDrawer(); renderDrawerMarkers(); });
    on(closeMapBtn,'click',closeDrawer);
    window.addEventListener('keydown',e=>{ if(e.key==='Escape') closeDrawer(); });
    document.addEventListener('click',(e)=>{ if(!mapDrawer.classList.contains('open')) return; const inside=mapDrawer.contains(e.target)||e.target.id==='openMapDrawer'; if(!inside) closeDrawer(); });

    function renderDrawerMarkers(){
      initDrawerMap(); drawerLayer.clearLayers();
      const items=getFilteredSorted(state.listings); const pts=[];
      items.forEach(h=>{
        if(typeof h.lat!=='number'||typeof h.lng!=='number') return;
        const mk=L.marker([h.lat,h.lng],{icon:makeIcon(h)}).addTo(drawerLayer)
          .bindPopup(`<b>${h.title}</b><br>${h.city}, ${h.country}<br>${formatPriceFromUsd(h.price_usd||0)}${t('labels.perNight')}`);
        pts.push([h.lat,h.lng]); h._dmk=mk;
      });
      if(pts.length){
        const group=L.featureGroup(pts.map(([a,b])=>L.marker([a,b])));
        drawerMap.fitBounds(group.getBounds().pad(0.2));
      }
    }

    /* List */
    function card(it){
      const img=(it.images&&it.images[0])?it.images[0]:'https://picsum.photos/800/500?blur=0.2&random='+(it.id||Math.random());
      const rating=it.rating?Number(it.rating).toFixed(1):'—';
      const dist=(typeof it.distance_km==='number')?`${it.distance_km} km`:'—';
      const stayTypeKey='type.'+(it.stayType||'').toLowerCase();
      const typeText=t(stayTypeKey) || it.stayType || '';
      return `
      <article class="card hotel-card"
        data-id="${it.id||''}" data-price-usd="${it.price_usd||0}" data-rating="${it.rating||0}"
        data-distance="${it.distance_km||999}" data-free="${!!it.free_cancel}" data-type="${it.stayType||''}">
        <div class="card-media">
          <img src="${img}" alt="${it.title}">
          <div class="badge-row">
            ${it.stayType?`<span class="badge">${t('filters.type')}: ${typeText}</span>`:''}
            ${it.verified?`<span class="badge">Verified</span>`:''}
          </div>
          <button class="fav fav-btn" data-id="${it.id||''}" title="★">
            <svg width="20" height="20" viewBox="0 0 24 24"><path d="M12 17.27 18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/></svg>
          </button>
        </div>
        <div class="card-body">
          <div>
            <div class="title">${it.title}</div>
            <div class="meta">${it.city}, ${it.country} · <span class="distance">${dist}</span></div>
            <div class="payline">
              <span class="price" data-price-usd="${it.price_usd||0}">${formatPriceFromUsd(it.price_usd||0)}</span>
              <span class="tax" data-i18n="labels.perNight">/ night</span>
            </div>
            <div class="cancel">${it.free_cancel ? t('filters.freeCancel').replace(' only','') : ' '}</div>
            <div class="meta"><button class="btn ghost view-on-map" data-id="${it.id||''}">🗺️ ${t('buttons.mapOpen')}</button></div>
            <a href="/booking.html?id=${encodeURIComponent(it.id||'')}" class="btn gold book" data-i18n="buttons.book">Book</a>
          </div>
          <div class="rating">${rating}</div>
        </div>
      </article>`;
    }

    function renderList(){
      const mount=$('#list'); const items=getFilteredSorted(state.listings);
      mount.innerHTML=items.map(card).join('')||`<div class="hint">No listings yet.</div>`;
      applyLang();
      mount.querySelectorAll('[data-price-usd]').forEach(el=>{
        const usd=parseFloat(el.getAttribute('data-price-usd')||'0'); el.textContent=formatPriceFromUsd(usd);
      });
      $$('.view-on-map',mount).forEach(btn=>{
        btn.addEventListener('click',e=>{
          const id=e.currentTarget.getAttribute('data-id');
          const h=state.listings.find(x=>x.id===id); if(!h) return;
          initDrawerMap(); openDrawer(); renderDrawerMarkers();
          drawerMap.flyTo([h.lat,h.lng],15,{duration:.6}); setTimeout(()=>{ if(h._dmk) h._dmk.openPopup(); },620);
        });
      });
    }

    /* Sort & Filter */
    function setHasAll(set, arr){ // arr에 set의 모든 값이 포함되어야 true (AND)
      if(!set || set.size===0) return true;
      if(!Array.isArray(arr)) return false;
      for(const v of set){ if(!arr.includes(v)) return false; }
      return true;
    }

    function getFilteredSorted(list){
      const f=state.filters;
      const maxUsd=Number((f.priceMax/(RATES[state.currency]||1)).toFixed(2));

      const filtered=list.filter(x=>{
        if((x.price_usd||0)>maxUsd) return false;
        if((x.rating||0)<f.ratingMin) return false;
        if(typeof x.distance_km==='number'&&x.distance_km>f.distanceMax) return false;
        if(f.freeCancel && !x.free_cancel) return false;

        if(f.type.size && !f.type.has(x.stayType)) return false;
        if(!setHasAll(f.amen, x.amenities)) return false;
        if(!setHasAll(f.booking, x.booking)) return false;
        if(!setHasAll(f.verify, x.verify)) return false;
        if(!setHasAll(f.long, x.longstay)) return false;
        if(!setHasAll(f.biz, x.business)) return false;
        if(!setHasAll(f.acc, x.access)) return false;
        if(!setHasAll(f.view, x.view)) return false;
        if(!setHasAll(f.safe, x.safety)) return false;
        if(!setHasAll(f.family, x.family)) return false;
        if(!setHasAll(f.ent, x.entertain)) return false;
        if(!setHasAll(f.out, x.outdoor)) return false;
        if(!setHasAll(f.park, x.parking)) return false;
        if(!setHasAll(f.pets, x.pets)) return false;
        if(!setHasAll(f.checkin, x.checkin)) return false;
        if(!setHasAll(f.exp, x.experiences)) return false;
        if(!setHasAll(f.loc, x.location_tags)) return false;

        return true;
      });

      return filtered.sort((a,b)=>{
        if(state.sort==='price-asc')   return (a.price_usd||0)-(b.price_usd||0);
        if(state.sort==='price-desc')  return (b.price_usd||0)-(a.price_usd||0);
        if(state.sort==='rating-desc') return (b.rating||0)-(a.rating||0);
        if(state.sort==='distance-asc')return (a.distance_km||999)-(b.distance_km||999);
        return 0;
      });
    }

    function openFilters(){ document.body.classList.add('filter-open'); }
    function closeFilters(){ document.body.classList.remove('filter-open'); }
    function updateFilterLabels(){
      $('#fPriceVal').textContent=state.nf.format(state.filters.priceMax);
      $('#fRatingVal').textContent=state.filters.ratingMin.toFixed(1);
      $('#fDistanceVal').textContent=`${state.filters.distanceMax} km`;
      applyLang();
    }
    function readChecks(id,set){ set.clear(); $$('#'+id+' input[type=checkbox]:checked').forEach(i=>set.add(i.value)); }
    function resetAllFilters(){
      const f=state.filters;
      f.priceMax=1000; f.ratingMin=0; f.distanceMax=30; f.freeCancel=false;
      Object.keys(f).forEach(k=>{ if(f[k] instanceof Set) f[k].clear(); });
      $('#fPrice').value=1000; $('#fRating').value=0; $('#fDistance').value=30; $('#fFreeCancel').checked=false;
      $$('aside .checks input[type=checkbox]').forEach(i=>i.checked=false);
      updateFilterLabels();
    }

    /* Data with attributes to support filters */
    async function loadListings(){
      return [
        {
          id:'ist-001', title:'Bosphorus View Suite', city:'Istanbul', country:'Türkiye',
          stayType:'Apartment', price_usd:120, rating:4.6, distance_km:1.2, free_cancel:true,
          lat:41.038, lng:29.01, emoji:'🏨',
          amenities:['Wi-Fi','Kitchen','Washer','Air conditioning','Workspace'],
          booking:['Instant'], verify:['Verified listings'], longstay:['Long deals'],
          business:['Invoice'], access:['Elevator','Wide doorway'], view:['Sea view','City view'],
          safety:['Smoke alarm','First aid kit'], family:['Crib'], entertain:['TV','Netflix'],
          outdoor:['Patio'], parking:['On-site'], pets:['Pet allowed'], checkin:['Self'],
          experiences:['Traditional','Wine'], location_tags:['City center','Near station']
        },
        {
          id:'par-002', title:'Paris Luxury Stay', city:'Paris', country:'France',
          stayType:'Hotel', price_usd:210, rating:4.9, distance_km:0.5, free_cancel:false,
          lat:48.8566, lng:2.3522, emoji:'🏨',
          amenities:['Wi-Fi','Pool','Gym','Breakfast','Air conditioning'],
          booking:['Request'], verify:['Verified reviews'], longstay:[],
          business:['B2B'], access:['Elevator','Accessible bathroom'], view:['City view','Garden'],
          safety:['CO alarm','Smoke alarm'], family:['High chair'], entertain:['TV'],
          outdoor:['Private garden'], parking:['Garage'], pets:[], checkin:[],
          experiences:['Nature'], location_tags:['City center','Near station']
        },
        {
          id:'sel-003', title:'Seoul Riverside Motel', city:'Seoul', country:'Korea',
          stayType:'Motel', price_usd:75, rating:4.2, distance_km:3.5, free_cancel:true,
          lat:37.5665, lng:126.9780, emoji:'🏨',
          amenities:['Wi-Fi','Parking','Air conditioning'], booking:['Instant'], verify:[],
          longstay:['Long deals'], business:[], access:['Step-free'], view:['City view'],
          safety:['Smoke alarm'], family:['Stroller friendly'], entertain:['TV','Game console'],
          outdoor:['BBQ'], parking:['Street'], pets:['Pet allowed'], checkin:['Self'],
          experiences:['Camping'], location_tags:['Near station']
        },
        {
          id:'tok-004', title:'Tokyo Premium Ryokan', city:'Tokyo', country:'Japan',
          stayType:'Ryokan', price_usd:320, rating:5.0, distance_km:0.8, free_cancel:true,
          lat:35.6762, lng:139.6503, emoji:'🏨',
          amenities:['Wi-Fi','Kitchen','Washer','Dryer'], booking:['Request'], verify:['Verified reviews'],
          longstay:[], business:['B2B','Invoice'], access:['Step-free','Elevator'], view:['Mountain view','Garden'],
          safety:['CO alarm','First aid kit'], family:['Crib','High chair'], entertain:['TV','Netflix'],
          outdoor:['Private garden','Patio'], parking:['On-site'], pets:[], checkin:['Self'],
          experiences:['Ski','Traditional'], location_tags:['Near station','City center']
        }
      ];
    }

    /* Hash */
    function parseHashParams(){ const h=(location.hash||'').replace(/^#/,''); const parts=h?h.split('&'):[]; const p={}; for(const x of parts){ if(!x) continue; const [k,vRaw]=x.split('='); const k2=decodeURIComponent(k||'').trim().toLowerCase(); const v=decodeURIComponent((vRaw??'').trim()); p[k2]=v===''?true:v; } return p; }
    function applyHashParams(){
      const q=parseHashParams(); let rer=false, remap=false;
      if(q.filters===true||q.filters==='1'||q.filters==='true') openFilters();
      const allow=new Set(['price-asc','price-desc','rating-desc','distance-asc']); if(q.sort&&allow.has(q.sort)){ state.sort=q.sort; rer=true; }
      if(q.price&&!isNaN(+q.price)){ state.filters.priceMax=+q.price; $('#fPrice').value=+q.price; rer=true; }
      if(q.rating&&!isNaN(+q.rating)){ state.filters.ratingMin=+q.rating; $('#fRating').value=+q.rating; rer=true; }
      if(q.distance&&!isNaN(+q.distance)){ state.filters.distanceMax=+q.distance; $('#fDistance').value=+q.distance; rer=true; }
      if(q.cancel!==undefined){ const on=(q.cancel===true||q.cancel==='1'||q.cancel==='true'); state.filters.freeCancel=on; $('#fFreeCancel').checked=on; rer=true; }
      if(q.lang && I18N[q.lang]){ state.lang=q.lang; setLang(state.lang); $('#lang').value=q.lang; state.currency=LANG_TO_DEFAULT_CURRENCY[state.lang]||state.currency; $('#currency').value=state.currency; state.nf=new Intl.NumberFormat(state.lang,{style:'currency',currency:state.currency}); applyLang(); }
      if(q.cur && CURRENCIES[q.cur]){ state.currency=q.cur; $('#currency').value=q.cur; state.nf=new Intl.NumberFormat(state.lang,{style:'currency',currency:state.currency}); }
      const lat=q.lat!==undefined?+q.lat:NaN, lng=q.lng!==undefined?+q.lng:NaN;
      if(!isNaN(lat)&&!isNaN(lng)){ CITY_CENTER={ name:q.city||CITY_CENTER.name, lat, lng }; remap=true; rer=true; }
      else if(q.city){ CITY_CENTER={ ...CITY_CENTER, name:q.city }; }
      updateFilterLabels(); if(rer){ renderList(); renderMarkers(); renderDrawerMarkers(); } else if(remap){ renderMarkers(); renderDrawerMarkers(); }
    }

    /* Wires */
    function wireFilters(){
      on($('#btnFilter'),'click',openFilters);
      on($('#btnCloseFilter'),'click',closeFilters);
      on($('.filter-backdrop'),'click',closeFilters);
      on($('#fPrice'),'input',e=>{ state.filters.priceMax=+e.target.value; updateFilterLabels(); });
      on($('#fRating'),'input',e=>{ state.filters.ratingMin=+e.target.value; updateFilterLabels(); });
      on($('#fDistance'),'input',e=>{ state.filters.distanceMax=+e.target.value; updateFilterLabels(); });

      on($('#btnResetFilters'),'click',()=>{ resetAllFilters(); renderList(); renderMarkers(); renderDrawerMarkers(); });

      on($('#btnApplyFilters'),'click',()=>{
        const f=state.filters;
        readChecks('fType',f.type);
        f.freeCancel=$('#fFreeCancel').checked;

        readChecks('fAmen',f.amen); readChecks('fBooking',f.booking); readChecks('fVerify',f.verify);
        readChecks('fLong',f.long); readChecks('fBiz',f.biz); readChecks('fAcc',f.acc);
        readChecks('fView',f.view); readChecks('fSafe',f.safe); readChecks('fFamily',f.family);
        readChecks('fEnt',f.ent); readChecks('fOut',f.out); readChecks('fPark',f.park);
        readChecks('fPets',f.pets); readChecks('fCheckin',f.checkin); readChecks('fExp',f.exp);
        readChecks('fLoc',f.loc);

        closeFilters(); renderList(); renderMarkers(); renderDrawerMarkers();
      });
    }
    function wireHeader(){
      on($('#btnSort'),'click',()=>{
        const next={'price-asc':'price-desc','price-desc':'rating-desc','rating-desc':'distance-asc','distance-asc':'price-asc'}[state.sort]||'price-asc';
        state.sort=next; renderList(); renderMarkers(); renderDrawerMarkers(); applyLang();
      });
      on($('#btnMapList'),'click',()=>{ const s=$('#map').style; s.display=(s.display==='none')?'':'none'; });
    }

    window.addEventListener('DOMContentLoaded', async ()=>{
      buildSelects(); applyLang();
      wireFilters(); wireHeader(); updateFilterLabels();
      state.listings = await loadListings();
      renderList(); renderMarkers();
      applyHashParams();
    });
    window.addEventListener('hashchange', applyHashParams);
  </script>
  <script>
/**
 * 로그인 시 localStorage.sw_user 를 기준으로
 * - 게스트용 버튼/링크(Login, Sign up, data-auth="guest") 숨김
 * - 유저용 UI(My Page, Logout, data-auth="user") 표시
 * - Logout 클릭 동작 연결
 */
(function () {
  const user = JSON.parse(localStorage.getItem('sw_user') || 'null');

  const show = (sel) => document.querySelectorAll(sel).forEach(el => el.style.display = '');
  const hide = (sel) => document.querySelectorAll(sel).forEach(el => el.style.display = 'none');

  if (user) {
    // 로그인 상태: 게스트용 숨기고 유저용 보여주기
    hide('a[href="/login.html"], a[href="/signup.html"], [data-auth="guest"]');
    show('[data-auth="user"]');

    // 환영 문구 갱신(있을 때만)
    const welcomeEl = document.getElementById('welcomeUser');
    if (welcomeEl) welcomeEl.textContent = `Welcome, ${user.name} 🎉`;
  } else {
    // 비로그인: 게스트용 보이고 유저용 숨기기
    show('a[href="/login.html"], a[href="/signup.html"], [data-auth="guest"]');
    hide('[data-auth="user"]');
  }

  // 로그아웃 버튼 동작(여러 아이디/속성 지원)
  document.querySelectorAll('#logoutBtn, [data-logout]').forEach(btn => {
    btn.addEventListener('click', (e) => {
      e.preventDefault();
      localStorage.removeItem('sw_user');
      location.href = '/index.html';
    });
  });
})();
</script>
<script src="/auth-visibility.js"></script>
</body>
</html>

</body>
</html>

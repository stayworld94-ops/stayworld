<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>STAYWORLD ‚Äî Hotels</title>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin="anonymous">
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin="anonymous"></script>

  <style>
    :root{
      --bg:#0b0f16;--panel:#101018;--panel-2:#0f131c;--text:#e7e9ee;--muted:#aeb6c8;--line:rgba(255,255,255,.08);
      --chip:#121a26;--gold1:#f4d78c;--gold2:#c9a35b;--accent:#1e5bd8;--green:#2ecc71;--danger:#ff5a5f
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:var(--bg);color:var(--text);font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif}

    /* Header */
    .sw-header{position:sticky;top:0;z-index:100;background:rgba(10,14,20,.85);backdrop-filter:blur(10px);border-bottom:1px solid var(--line)}
    .sw-header-inner{max-width:1200px;margin:0 auto;display:flex;align-items:center;gap:16px;padding:10px 16px}
    .sw-brand{display:flex;align-items:center;gap:10px;color:var(--text);text-decoration:none}
    .sw-logo{width:30px;height:30px;border-radius:50%;background:radial-gradient(circle at 30% 30%,#fff8dd 0,#f4d78c 45%,#c9a35b 70%,#8a6d33 100%)}
    .sw-nav{margin-left:auto;display:flex;gap:14px}
    .sw-nav a{color:var(--muted);text-decoration:none;padding:8px 10px;border-radius:10px}
    .sw-nav a:hover{background:var(--chip);color:var(--text)}
    .sw-nav a.active{color:var(--gold1);border:1px solid var(--line);background:linear-gradient(180deg,rgba(27,27,36,.6),rgba(27,27,36,.2))}
    .sw-cta{display:flex;gap:10px;margin-left:8px}
    .btn{display:inline-flex;align-items:center;gap:8px;padding:10px 14px;border-radius:12px;text-decoration:none;border:1px solid var(--line);color:var(--text);cursor:pointer}
    .btn.gold{background:linear-gradient(180deg,#f4d78c,#c9a35b);color:#121212;border:none;font-weight:800}
    .btn.ghost:hover{background:var(--chip)}
    @media(max-width:880px){.sw-nav,.sw-cta{display:none}}

    /* Top controls */
    .controls{display:flex;gap:10px;flex-wrap:wrap;align-items:center;padding:12px 14px;border-bottom:1px solid var(--line);background:linear-gradient(180deg,rgba(16,16,24,.7),rgba(16,16,24,0))}
    .chip{display:inline-flex;gap:8px;align-items:center;padding:9px 12px;background:var(--chip);border:1px solid var(--line);border-radius:12px;color:var(--text);cursor:pointer}
    .chip:hover{background:#152033}
    .select{padding:8px 10px;border-radius:10px;background:var(--panel);border:1px solid var(--line);color:var(--text)}

    /* Layout */
    .wrap{display:grid;grid-template-columns:1.15fr .85fr;gap:16px;padding:14px}
    @media(max-width:1024px){.wrap{grid-template-columns:1fr}}

    /* Cards */
    .card{background:var(--panel);border:1px solid var(--line);border-radius:16px;overflow:hidden;box-shadow:0 10px 30px rgba(0,0,0,.25);margin-bottom:14px}
    .card-media{position:relative}
    .card-media img{width:100%;height:210px;object-fit:cover;display:block}
    .badge-row{position:absolute;top:10px;left:10px;display:flex;gap:8px}
    .badge{background:rgba(0,0,0,.6);backdrop-filter:blur(6px);border:1px solid var(--line);color:#fff;padding:6px 8px;border-radius:10px;font-size:12px}
    .fav{position:absolute;right:12px;top:12px;width:36px;height:36px;border-radius:12px;background:rgba(0,0,0,.5);display:grid;place-items:center;border:1px solid var(--line);cursor:pointer}
    .fav svg{fill:transparent;stroke:#fff;stroke-width:1.6}
    .fav.active svg{fill:var(--danger);stroke:var(--danger)}
    .card-body{display:grid;grid-template-columns:1fr auto;gap:12px;padding:12px 14px 16px}
    .title{font-weight:700;font-size:18px}
    .rating{justify-self:end;align-self:start;background:#2b6bed;border:1px solid rgba(255,255,255,.15);color:#fff;padding:6px 10px;border-radius:10px;font-weight:700}
    .meta{display:flex;gap:10px;align-items:center;color:var(--muted);font-size:14px}
    .payline{margin-top:6px;display:flex;gap:10px;align-items:baseline}
    .old-price{text-decoration:line-through;color:#8b94a8}
    .price{font-size:20px;font-weight:800;color:var(--gold1)}
    .tax{color:var(--muted);font-size:12px}
    .cancel{margin-top:4px;color:var(--green);font-size:14px}
    .card .book{margin-top:10px;display:inline-flex}

    /* Map */
    #map{height:520px;border:1px solid var(--line);border-radius:16px;overflow:hidden}
    .price-bubble{background:var(--accent);color:#fff;border-radius:10px;padding:4px 8px;font-weight:800;border:2px solid rgba(255,255,255,.8);box-shadow:0 6px 12px rgba(0,0,0,.4)}

    /* Footer */
    footer.sw-footer{margin-top:24px;border-top:1px solid var(--line);background:linear-gradient(180deg,rgba(16,16,24,.7),rgba(16,16,24,0));padding:24px 16px}
    .sw-footer-inner{max-width:1200px;margin:0 auto;display:grid;grid-template-columns:1fr 1fr 1fr;gap:16px}
    .sw-foot-col h4{margin:0 0 10px 0;color:var(--gold1)}
    .sw-foot-col a{display:block;color:var(--muted);text-decoration:none;margin:6px 0}
    .sw-foot-col a:hover{color:var(--text)}
    .sw-copy{max-width:1200px;margin:6px auto 0 auto;color:var(--muted);font-size:12px}

    /* Filter drawer */
    .filter-backdrop{position:fixed;inset:0;background:rgba(0,0,0,.5);backdrop-filter:blur(2px);display:none;z-index:120}
    .filter-panel{position:fixed;right:0;top:0;bottom:0;width:360px;max-width:92vw;background:var(--panel);border-left:1px solid var(--line);box-shadow:-10px 0 30px rgba(0,0,0,.4);z-index:130;transform:translateX(100%);transition:transform .25s ease}
    .filter-open .filter-panel{transform:translateX(0)}
    .filter-open .filter-backdrop{display:block}
    .filter-head{display:flex;align-items:center;justify-content:space-between;padding:14px;border-bottom:1px solid var(--line)}
    .filter-body{padding:14px;display:grid;gap:16px;overflow:auto;height:calc(100% - 150px)}
    .filter-row{display:grid;gap:8px}
    .filter-row label{color:var(--muted);font-size:13px}
    .range{display:flex;gap:10px;align-items:center}
    .range input[type=range]{width:100%}
    .filter-actions{display:flex;gap:10px;padding:12px;border-top:1px solid var(--line);background:linear-gradient(180deg,rgba(16,16,24,.6),rgba(16,16,24,0))}
    .btn.small{padding:8px 10px;border-radius:10px}
    .btn.reset{background:transparent;color:var(--muted)}
  </style>
</head>
<body>
  <!-- Header -->
  <header class="sw-header">
    <div class="sw-header-inner">
      <a href="/index.html" class="sw-brand"><span class="sw-logo"></span><strong>STAYWORLD</strong></a>
      <nav class="sw-nav">
        <a href="/index.html">Home</a>
        <a href="/hotels.html" class="active">Hotels</a>
        <a href="/membership.html">Membership</a>
        <a href="/results.html">Search</a>
        <a href="/host-register.html">Become a Host</a>
      </nav>
      <div class="sw-cta">
        <a href="/login.html" class="btn ghost">Log in</a>
        <a href="/signup.html" class="btn gold">Sign up</a>
      </div>
    </div>
  </header>

  <!-- Controls -->
  <div class="controls">
    <div class="chip" id="btnSort">‚áÖ <span data-i18n="sort">Ï†ïÎ†¨</span></div>
    <div class="chip" id="btnFilter">‚ò∞ <span data-i18n="filter">ÌïÑÌÑ∞</span></div>
    <div class="chip" id="btnMapList">üó∫Ô∏è <span data-i18n="mapView">ÏßÄÎèÑ</span></div>
    <select class="select" id="lang"></select>
    <select class="select" id="currency"></select>
  </div>

  <!-- Filter Drawer -->
  <div class="filter-backdrop" id="filterBackdrop"></div>
  <aside class="filter-panel" id="filterPanel" aria-hidden="true">
    <div class="filter-head">
      <strong>Filters</strong>
      <button class="btn small reset" id="btnCloseFilter">‚úï</button>
    </div>
    <div class="filter-body">
      <div class="filter-row">
        <label>Max price (converted)</label>
        <div class="range">
          <input type="range" id="fPrice" min="50" max="1000" step="10" value="1000"/>
          <span id="fPriceVal">‚Äî</span>
        </div>
      </div>
      <div class="filter-row">
        <label>Minimum rating</label>
        <div class="range">
          <input type="range" id="fRating" min="0" max="10" step="0.1" value="0"/>
          <span id="fRatingVal">0.0</span>
        </div>
      </div>
      <div class="filter-row">
        <label>Max distance from center</label>
        <div class="range">
          <input type="range" id="fDistance" min="200" max="10000" step="100" value="10000"/>
          <span id="fDistanceVal">‚Äî</span>
        </div>
      </div>
      <div class="filter-row">
        <label><input type="checkbox" id="fFreeCancel"> Free cancellation only</label>
      </div>
    </div>
    <div class="filter-actions">
      <button class="btn small reset" id="btnResetFilters">Reset</button>
      <button class="btn small gold" id="btnApplyFilters">Apply</button>
    </div>
  </aside>

  <!-- List + Map -->
  <div class="wrap">
    <div><div id="list"></div></div>
    <div>
      <div id="map"></div>
      <div style="padding:8px 14px;color:var(--muted);font-size:12px" id="rateHint">* Exchange rates are sample for demo. Connect your FX API for live rates.</div>
    </div>
  </div>

  <!-- Footer -->
  <footer class="sw-footer">
    <div class="sw-footer-inner">
      <div class="sw-foot-col"><h4>STAYWORLD</h4><a href="/about.html">About</a><a href="/careers.html">Careers</a><a href="/press.html">Press</a></div>
      <div class="sw-foot-col"><h4>Help</h4><a href="/help.html">Help Center</a><a href="/safety.html">Guest Protection</a><a href="/contact.html">Contact</a></div>
      <div class="sw-foot-col"><h4>Legal</h4><a href="/terms.html">Terms</a><a href="/privacy.html">Privacy</a><a href="/cookies.html">Cookies</a></div>
    </div>
    <div class="sw-copy">¬© 2025 STAYWORLD. All rights reserved.</div>
  </footer>

<script type="module">
  /* =========================
     Firestore, ÏÉÅÌÉú, Ìï®ÏàòÎì§ (ÏÉùÎûµ, ÎÑ§ ÏΩîÎìú Í∑∏ÎåÄÎ°ú Ïú†ÏßÄ)
     ...
  ========================== */

  function openFilters(){ document.body.classList.add('filter-open'); }
  function closeFilters(){ document.body.classList.remove('filter-open'); }
  btnFilter.addEventListener('click',openFilters);
  btnCloseFilter.addEventListener('click',closeFilters);
  filterBackdrop.addEventListener('click',closeFilters);

  // üîë Ï†ÑÏó≠ ÎÖ∏Ï∂ú
  window.openFilters = openFilters;
  window.closeFilters = closeFilters;
</script>

<script>
  // URLÏóê #filters Î∂ôÏñ¥ÏûàÏúºÎ©¥ ÏûêÎèôÏúºÎ°ú ÌïÑÌÑ∞ Ïó¥Í∏∞
  function maybeOpenFiltersFromHash() {
    if (location.hash === '#filters') {
      if (typeof window.openFilters === 'function') {
        window.openFilters();
      } else {
        document.body.classList.add('filter-open');
      }
    }
  }
  window.addEventListener('DOMContentLoaded', maybeOpenFiltersFromHash);
  window.addEventListener('hashchange', maybeOpenFiltersFromHash);
</script>
/* =========================
   Deep-link via location.hash
   Ïòà) /hotels.html#filters&sort=price-desc&rating=8.5&price=300&distance=3000&cancel=1&lang=ko&cur=KRW&lat=37.5665&lng=126.9780&city=Seoul
========================= */

// openFiltersÎ•º Ìï¥ÏãúÏóêÏÑúÎèÑ Ìò∏Ï∂ú Í∞ÄÎä•ÌïòÎèÑÎ°ù Ï†ÑÏó≠ ÎÖ∏Ï∂ú
window.openFilters = openFilters;

function parseHashParams() {
  const h = (location.hash || '').replace(/^#/, '');
  const parts = h ? h.split('&') : [];
  const params = {};
  for (const p of parts) {
    if (!p) continue;
    const [k, vRaw] = p.split('=');
    const k2 = decodeURIComponent(k || '').trim().toLowerCase();
    const v = decodeURIComponent((vRaw ?? '').trim());
    // Í∞í ÏóÜÎäî ÌÇ§(Ïòà: #filters)ÎèÑ trueÎ°ú Ï≤òÎ¶¨
    params[k2] = v === '' ? true : v;
  }
  return params;
}

function applyHashParams() {
  const q = parseHashParams();
  let needRerender = false;
  let needRelayoutMap = false;

  // 1) ÌïÑÌÑ∞ Ìå®ÎÑê ÏûêÎèô Ïó¥Í∏∞
  if (q.filters === true || q.filters === '1' || q.filters === 'true') {
    openFilters?.();
  }

  // 2) Ï†ïÎ†¨
  const sortAllow = new Set(['price-asc','price-desc','rating-desc','distance-asc']);
  if (q.sort && sortAllow.has(q.sort)) {
    state.sort = q.sort;
    needRerender = true;
  }

  // 3) ÌïÑÌÑ∞ Í∞íÎì§: price(ÌÜµÌôîÏóê ÎßûÏ∂ò ÏµúÎåÄÍ∞í), rating(ÏµúÏÜå), distance(ÏµúÎåÄ m), cancel(Î¨¥Î£åÏ∑®ÏÜå)
  // hash ‚Üí Ïä¨ÎùºÏù¥Îçî/Ï≤¥ÌÅ¨ UIÏóêÎèÑ Î∞òÏòÅ
  if (q.price && !isNaN(+q.price)) {
    document.getElementById('fPrice').value = +q.price;
    state.filters.priceMax = +q.price;
    needRerender = true;
  }
  if (q.rating && !isNaN(+q.rating)) {
    document.getElementById('fRating').value = +q.rating;
    state.filters.ratingMin = +q.rating;
    needRerender = true;
  }
  if (q.distance && !isNaN(+q.distance)) {
    document.getElementById('fDistance').value = +q.distance;
    state.filters.distanceMax = +q.distance;
    needRerender = true;
  }
  if (q.cancel !== undefined) {
    const on = (q.cancel === true || q.cancel === '1' || q.cancel === 'true');
    document.getElementById('fFreeCancel').checked = on;
    state.filters.freeCancel = on;
    needRerender = true;
  }

  // 4) Ïñ∏Ïñ¥/ÌÜµÌôî
  if (q.lang && LANGS[q.lang]) {
    state.lang = q.lang;
    document.getElementById('lang').value = q.lang;
    // Ïñ∏Ïñ¥Í∞Ä Î∞îÎÄåÏóàÏúºÎ©¥ Í∏∞Î≥∏ ÌÜµÌôîÎèÑ ÎßûÏ∂∞Ï§ÑÏßÄ ÏòµÏÖò (Ìï¥ÏãúÏóê cur ÏûàÏúºÎ©¥ cur Ïö∞ÏÑ†)
    if (!q.cur && LANG_TO_DEFAULT_CURRENCY[state.lang]) {
      state.currency = LANG_TO_DEFAULT_CURRENCY[state.lang];
      document.getElementById('currency').value = state.currency;
    }
    // ÌÖçÏä§Ìä∏ Í∞±Ïã†ÏùÄ Îß® ÎßàÏßÄÎßâÏóê
  }
  if (q.cur && CURRENCIES[q.cur]) {
    state.currency = q.cur;
    document.getElementById('currency').value = q.cur;
  }

  // 5) Ï§ëÏã¨ÎèÑÏãú/Ï¢åÌëú (ÏÑ†ÌÉù)
  // lat, lngÍ∞Ä ÏûàÏúºÎ©¥ ÏßÄÎèÑÏùò Ï§ëÏã¨ÏùÑ Ìï¥Îãπ Ï¢åÌëúÎ°ú, cityÍ∞Ä ÏûàÏúºÎ©¥ ÎèÑÏãúÎ™ÖÎèÑ ÍµêÏ≤¥
  const latNum = q.lat !== undefined ? +q.lat : NaN;
  const lngNum = q.lng !== undefined ? +q.lng : NaN;
  if (!isNaN(latNum) && !isNaN(lngNum)) {
    CITY_CENTER = {
      name: q.city || CITY_CENTER.name,
      lat: latNum,
      lng: lngNum
    };
    needRelayoutMap = true;
    needRerender = true;
  } else if (q.city) {
    // cityÎßå ÏûàÏúºÎ©¥ Ïù¥Î¶ÑÎßå ÍµêÏ≤¥
    CITY_CENTER = { ...CITY_CENTER, name: q.city };
  }

  // UI ÎùºÎ≤® ÏµúÏã†Ìôî
  updateFilterLabels();

  // ÌÖçÏä§Ìä∏/i18n ÎèôÍ∏∞ÌôîÎäî Ïñ∏Ïñ¥/ÌÜµÌôî Î∞òÏòÅ ÌõÑ Ïã§Ìñâ
  // Îã®, Ïù¥ÎØ∏ Ï¥àÍ∏∞ Î†åÎçîÎßÅÎêú Îí§ÎùºÎ©¥ Ï§ëÎ≥µ Î†åÎçî Î∞©ÏßÄÎ•º ÏúÑÌï¥ ÌîåÎûòÍ∑∏Î°ú Ï†úÏñ¥
  if (q.lang || q.cur) {
    syncUITexts();
    // syncUITextsÏïàÏóêÏÑú renderList/renderMarkers Ìò∏Ï∂úÌïòÎØÄÎ°ú ÏïÑÎûò needRerenderÎäî Í±¥ÎÑàÎõ∏ Ïàò ÏûàÏùå
    needRerender = false;
  }

  if (needRerender) {
    renderList();
    renderMarkers();
  } else if (needRelayoutMap) {
    renderMarkers(); // Ï§ëÏã¨ Î∞îÎÄê Í≤ΩÏö∞ ÎßàÏª§/Î∑∞ Ïû¨Í≥ÑÏÇ∞
  }
}

// Ï≤´ Î°úÎìú & Îí§Î°úÍ∞ÄÍ∏∞/ÏïûÏúºÎ°úÍ∞ÄÍ∏∞ÏóêÎèÑ Î∞òÏùë
window.addEventListener('DOMContentLoaded', applyHashParams);
window.addEventListener('hashchange', applyHashParams);

</body>
</html>

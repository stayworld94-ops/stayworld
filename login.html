<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>STAYWORLD — Login</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
    :root{--bg:#0a0a0c;--panel:#0f0f16;--muted:#a1a7b3;--text:#f1f3f7;--gold:#d4b166;--gold-2:#f0d58d}
    *{box-sizing:border-box} html,body{height:100%}
    body{margin:0;font-family:Inter,system-ui;color:var(--text);background:var(--bg)}
    .container{max-width:960px;margin:0 auto;padding:0 16px}
    header{position:sticky;top:0;z-index:10;background:rgba(10,10,12,.7);backdrop-filter:blur(10px);border-bottom:1px solid #1a1a22}
    .h-inner{display:flex;align-items:center;justify-content:space-between;height:64px}
    nav a{margin:0 10px;color:#a1a7b3;text-decoration:none;font-weight:600}
    nav a:hover{color:#fff}
    select{background:#0d0d14;border:1px solid #262631;color:#fff;border-radius:10px;padding:8px 10px}
    .hero{padding:48px 0;border-bottom:1px solid #1a1a22;background:radial-gradient(700px 400px at 80% -10%, rgba(212,177,102,.08), transparent 60%)}
    .hero h1{font-size:40px;margin:0 0 8px}
    .muted{color:var(--muted)}
    .panel{max-width:520px;margin:24px auto;background:linear-gradient(180deg,#13131c,#0d0d14);border:1px solid #242430;border-radius:16px;padding:18px}
    label{display:block;margin:10px 0 6px;font-weight:600}
    input[type=email],input[type=password]{width:100%;padding:12px;border-radius:10px;border:1px solid #262631;background:#0d0d14;color:#fff}
    .row{display:flex;align-items:center;justify-content:space-between;margin-top:10px}
    .btn{width:100%;margin-top:14px;background:linear-gradient(180deg,var(--gold-2),var(--gold));border:0;color:#111;font-weight:800;border-radius:12px;padding:12px 14px;cursor:pointer}
    .btn-icon{border:1px solid #2a2a34;border-radius:10px;padding:8px 12px}
    .btn-ghost-gold{background:#151520;color:#f1f3f7;border:1px solid rgba(212,177,102,.35)}
    dialog::backdrop{background:rgba(0,0,0,.5)}
    footer{border-top:1px solid #1a1a22;padding:18px 0;margin-top:32px;color:#a1a7b3}
  </style>
</head>
<body>
<header>
  <div class="container h-inner">
    <strong>STAYWORLD</strong>
    <nav>
      <a id="t_nav_home" href="index.html#home">Home</a>
      <a id="t_nav_deals" href="index.html#deals">Deals</a>
      <a id="t_nav_membership" href="membership.html">Membership</a>
      <a id="t_nav_host" href="host-register.html">Host</a>
      <a id="t_nav_support" href="support.html">Support</a>
    </nav>
    <select id="langSelect">
      <option value="en">EN</option><option value="ko">KO</option><option value="fr">FR</option><option value="tr">TR</option><option value="ja">JA</option>
      <option value="de">DE</option><option value="es">ES</option><option value="it">IT</option><option value="zh">ZH</option><option value="ru">RU</option>
    </select>
  </div>
</header>

<section class="hero">
  <div class="container">
    <h1 id="t_login_title">Log in to StayWorld</h1>
    <p class="muted" id="t_login_sub">Welcome back. Access your bookings, points and perks.</p>
  </div>
</section>

<div class="container">
  <div class="panel">
    <label for="i_login_email" id="t_login_email_label">Email</label>
    <input id="i_login_email" type="email" placeholder="you@example.com"/>

    <label for="i_login_password" id="t_login_password_label">Password</label>
    <input id="i_login_password" type="password" placeholder="Enter your password"/>

    <div class="row">
      <label style="display:flex;gap:8px;align-items:center">
        <input id="i_login_remember" type="checkbox"/>
        <span id="t_login_remember">Remember me</span>
      </label>
      <a href="reset.html" class="muted" id="t_login_forgot">Forgot password?</a>
    </div>

    <!-- 일반 로그인 -->
    <button class="btn" id="t_login_btn">Log in</button>
    <!-- 모달로 로그인 열기 버튼 (원하면 숨겨도 됨) -->
    <button class="btn-ghost-gold" style="width:100%;margin-top:10px" onclick="openLogin()">Open login modal</button>

    <!-- Google 로그인(직접 버튼) -->
    <button class="btn" id="googleLoginBtn" style="margin-top:10px">
      <span id="t_login_google_btn">Continue with Google</span>
    </button>

    <p class="muted" style="text-align:center;margin-top:12px" id="t_login_to_signup">No account? Sign up</p>
  </div>
</div>

<!-- ========= [여기부터가 'footer 바로 위' 섹션입니다] ========= -->

<!-- 1) 로그인 모달 템플릿 -->
<template id="loginTpl">
  <div class="rounded-2xl overflow-hidden bg-[#0f0f16] border border-white/10" style="min-width:340px;max-width:420px">
    <div class="p-4 border-b border-white/10 flex items-center justify-between">
      <h3 class="text-lg font-bold">Log in</h3>
      <button type="button" data-login-close class="btn-icon btn-ghost-gold" aria-label="Close">✕</button>
    </div>
    <div class="p-5 space-y-3">
      <input id="loginEmail" class="w-full px-4 py-3 rounded-xl bg-[#0f0f15] border border-white/10" placeholder="Email"/>
      <input id="loginPwd" type="password" class="w-full px-4 py-3 rounded-xl bg-[#0f0f15] border border-white/10" placeholder="Password"/>
      <button data-login-submit class="btn" style="width:100%">Log in</button>
      <button data-login-google class="btn-ghost-gold" style="width:100%;display:flex;gap:8px;align-items:center;justify-content:center">
        <span style="font-size:18px">G</span><span>Continue with Google</span>
      </button>
    </div>
  </div>
</template>

<!-- 2) 모달 다이얼로그 본체 -->
<dialog id="loginModal" style="background:transparent;border:0;padding:0"></dialog>

<!-- 3) ENV & Firebase 로더(원하면 DEMO_MODE=false로 바꾸면 실제 로그인만 동작) -->
<script>
  window.ENV = { DEMO_MODE: true }; // 실제 연결 테스트 때 false
</script>
<script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-auth-compat.js"></script>
<!-- 너의 firebase 설정 파일(이미 레포에 있음) -->
<script src="firebase-config.js"></script>
<script>
  try {
    if (window.firebaseConfig) {
      firebase.initializeApp(window.firebaseConfig);
      window._fbReady = true;
    }
  } catch(e){ console.warn(e); }
</script>

<!-- 4) 페이지 공용 i18n -->
<script src="lang.js"></script>

<!-- 5) 너가 준 "Login Modal Logic" (조금만 손봐서 그대로 붙임) -->
<script>
/* ============================
   STAYWORLD Login Modal Logic
   - Works with existing <dialog id="loginModal"> and <template id="loginTpl">
   - Adds close (✕), ESC & backdrop-click close
   - Demo mode friendly; optional Firebase hooks when DEMO_MODE=false
   ============================ */
(function(){
  const $ = (sel, scope)=> (scope||document).querySelector(sel);

  function ensureCloseBtn(container){
    if (!container) return;
    const hasBtn = container.querySelector('[data-login-close]');
    if (hasBtn) return;
    const header = container.querySelector('.border-b') || container.firstElementChild;
    const btn = document.createElement('button');
    btn.type = 'button';
    btn.dataset.loginClose = '1';
    btn.ariaLabel = 'Close';
    btn.className = 'btn-icon btn-ghost-gold';
    btn.textContent = '✕';
    if (header && header.classList.contains('flex')) {
      header.appendChild(btn);
    } else {
      const bar = document.createElement('div');
      bar.className = 'p-4 border-b border-white/10 flex items-center justify-between';
      const h = document.createElement('h3');
      h.className = 'text-lg font-bold';
      h.textContent = 'Log in';
      bar.appendChild(h);
      bar.appendChild(btn);
      container.prepend(bar);
    }
    btn.addEventListener('click', closeLogin);
  }

  function attachBackdropAndEsc(dlg){
    if (!dlg) return;
    function onClick(e){
      const rect = dlg.getBoundingClientRect();
      const inside = e.clientX >= rect.left && e.clientX <= rect.right &&
                     e.clientY >= rect.top  && e.clientY <= rect.bottom;
      if (!inside) closeLogin();
    }
    dlg.addEventListener('click', onClick, { once:true });
    function onCancel(ev){ ev.preventDefault(); closeLogin(); }
    dlg.addEventListener('cancel', onCancel, { once:true });
  }

  function hydrateActions(container){
    if (!container) return;
    const googleBtn = container.querySelector('[data-login-google]');
    if (googleBtn) googleBtn.addEventListener('click', googleLogin);
    const submitBtn = container.querySelector('[data-login-submit]');
    if (submitBtn) submitBtn.addEventListener('click', doLogin);
    const xBtn = container.querySelector('[aria-label="Close"]');
    if (xBtn) xBtn.addEventListener('click', closeLogin);
  }

  function openLogin(){
    const dlg = $('#loginModal');
    const tpl = $('#loginTpl');
    if (!dlg){ console.warn('loginModal not found'); return; }
    if (tpl){ dlg.innerHTML = tpl.innerHTML; }
    else {
      dlg.innerHTML = [
        '<div class="p-5 space-y-3 rounded-2xl bg-[#0f0f16] border border-white/10">',
        '<h3 class="text-lg font-bold mb-2">Log in</h3>',
        '<input id="loginEmail" class="w-full px-4 py-3 rounded-xl bg-[#0f0f15] border border-white/10" placeholder="Email"/>',
        '<input id="loginPwd" type="password" class="w-full px-4 py-3 rounded-xl bg-[#0f0f15] border border-white/10" placeholder="Password"/>',
        '<button data-login-submit class="btn" style="width:100%">Log in</button>',
        '<button data-login-google class="btn-ghost-gold" style="width:100%"><span style="font-size:18px">G</span> Continue with Google</button>',
        '</div>'
      ].join('');
    }
    ensureCloseBtn(dlg);
    hydrateActions(dlg);
    dlg.showModal();
    attachBackdropAndEsc(dlg);
  }

  function closeLogin(){
    const dlg = $('#loginModal');
    if (dlg && dlg.open) dlg.close();
  }

  function doLogin(){
    if (window.ENV?.DEMO_MODE){
      alert('Logged in (demo mode).');
      closeLogin();
      return;
    }
    if (window._fbReady && window.firebase?.auth){
      const email = $('#loginEmail')?.value || $('#i_login_email')?.value || '';
      const pwd = $('#loginPwd')?.value || $('#i_login_password')?.value || '';
      firebase.auth().signInWithEmailAndPassword(email, pwd)
        .then(()=>{ window.location.href='mypage.html'; })
        .catch(e=> alert(e.message));
    } else {
      alert('Connect your auth backend (Firebase/OAuth) — not initialized.');
    }
  }

  function googleLogin(){
    if (window.ENV?.DEMO_MODE){
      alert('Google login (demo mode).');
      closeLogin();
      return;
    }
    if (window._fbReady && window.firebase?.auth){
      const provider = new firebase.auth.GoogleAuthProvider();
      firebase.auth().signInWithPopup(provider)
        .then(()=>{ window.location.href='mypage.html'; })
        .catch(e=> alert(e.message));
    } else {
      alert('Google OAuth not initialized.');
    }
  }

  // page buttons
  document.getElementById('googleLoginBtn')?.addEventListener('click', googleLogin);
  document.getElementById('t_login_btn')?.addEventListener('click', doLogin);

  // expose
  window.openLogin = openLogin;
  window.closeLogin = closeLogin;
  window.doLogin = doLogin;
  window.googleLogin = googleLogin;
})();
</script>

<!-- ========= [footer 시작] ========= -->
<footer>
  <div class="container">© 2025 StayWorld</div>
</footer>

</body>
</html>
